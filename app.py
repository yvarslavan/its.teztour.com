#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
–ó–∞–º–µ–Ω—è–µ—Ç run_server.py –∏ run_dev.py
"""
import os
import sys
from pathlib import Path
from dotenv import load_dotenv

def setup_development_environment():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"""
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    os.environ['FLASK_ENV'] = 'development'
    os.environ['FLASK_DEBUG'] = '1'

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .flaskenv (–µ—Å–ª–∏ –µ—Å—Ç—å)
    BASE_DIR = Path(__file__).resolve().parent
    flaskenv_path = BASE_DIR / '.flaskenv'

    if flaskenv_path.exists():
        load_dotenv(flaskenv_path)
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ {flaskenv_path}")

    # –ó–∞–≥—Ä—É–∂–∞–µ–º dev –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    env_dev_path = BASE_DIR / '.env.development'
    if env_dev_path.exists():
        load_dotenv(env_dev_path)
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–∑ {env_dev_path}")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞"""
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    setup_development_environment()

    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    from blog import create_app

    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    app = create_app()

    # –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–ø—É—Å–∫–µ
    print("=" * 60)
    print("üöÄ FLASK DEVELOPMENT SERVER")
    print("=" * 60)
    print(f"üìÅ –ü—Ä–æ–µ–∫—Ç: {Path(__file__).resolve().parent}")
    print(f"üîß Debug —Ä–µ–∂–∏–º: {app.debug}")
    print(f"üîß –û–∫—Ä—É–∂–µ–Ω–∏–µ: {os.environ.get('FLASK_ENV', '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ')}")
    print(f"üåê –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å–∞–º:")
    print("   ‚û°Ô∏è  http://localhost:5000")
    print("   ‚û°Ô∏è  http://127.0.0.1:5000")
    print("   ‚û°Ô∏è  http://0.0.0.0:5000 (–≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø)")
    print("üìç –ì–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:")
    print("   ‚û°Ô∏è  http://localhost:5000/tasks/my-tasks")
    print("   ‚û°Ô∏è  http://localhost:5000/users/login")
    print("=" * 60)

    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    try:
        app.run(
            debug=True,              # DEBUG —Ä–µ–∂–∏–º
            host='0.0.0.0',          # –î–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö)
            port=int(os.environ.get('FLASK_RUN_PORT', 5000)),  # –ü–æ—Ä—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ 5000
            use_reloader=True,       # –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
            use_debugger=True,       # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥—á–∏–∫
            threaded=True,           # –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
            load_dotenv=False        # –ú—ã —É–∂–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        )
    except KeyboardInterrupt:
        print("\nüõë –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        sys.exit(0)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {e}")
        sys.exit(1)

if __name__ == '__main__':
    main()
