#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–¥–∞—á
"""

import requests
import json

def clear_cache():
    """–û—á–∏—â–∞–µ—Ç –∫—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
    try:
        # URL –≤–∞—à–µ–≥–æ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        base_url = "http://localhost:5000"  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL

        print("üîß –ü—Ä–æ–±—É–µ–º –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç...")

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –±–µ–∑ CSRF
        response = requests.get(f"{base_url}/admin/debug/clear-cache-no-csrf")

        if response.status_code == 200:
            print("‚úÖ –ö—ç—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç")
            print("   üìã –î–µ—Ç–∞–ª–∏:")
            if 'application/json' in response.headers.get('content-type', ''):
                try:
                    result = response.json()
                    print(f"      ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {result.get('user', 'N/A')}")
                    print(f"      ‚Ä¢ –í—Ä–µ–º—è: {result.get('timestamp', 'N/A')}")
                    print(f"      ‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏–µ: {result.get('message', 'N/A')}")
                except:
                    pass
            else:
                print("      ‚Ä¢ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ HTML")
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞: HTTP {response.status_code}")
            print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}...")

    except requests.exceptions.ConnectionError:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É")
        print("   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ")
        print("   –∏ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

def manual_clear_instructions():
    """–í—ã–≤–æ–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏"""
    print("\n" + "="*60)
    print("üìñ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –°–ü–û–°–û–ë–´ –û–ß–ò–°–¢–ö–ò –ö–≠–®–ê:")
    print("="*60)
    print("1. üåê –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:")
    print("   –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:5000/admin/debug/clear-cache-no-csrf")
    print("   (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ)")
    print()
    print("2. ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:")
    print("   –ö—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç–∏—Ç—Å—è —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç")
    print("   –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")
    print()
    print("3. üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:")
    print("   –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É '–ú–æ–∏ –∑–∞–¥–∞—á–∏' —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç")
    print()
    print("4. üß™ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:")
    print("   –í –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞–∂–º–∏—Ç–µ Ctrl+F5 (–∏–ª–∏ Cmd+Shift+R –Ω–∞ Mac)")
    print("   –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –æ—á–∏—Å—Ç–∫–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞")

if __name__ == "__main__":
    print("üîß –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–¥–∞—á...")
    clear_cache()
    manual_clear_instructions()
    print("\nüí° –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É '–ú–æ–∏ –∑–∞–¥–∞—á–∏' –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
    print("   –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")
