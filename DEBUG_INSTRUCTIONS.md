# Инструкция по отладке функционала удаления уведомлений

## Что было исправлено:

1. **Убрал неправильный заголовок Content-Type** - при использовании FormData браузер автоматически устанавливает нужный тип
2. **Добавил CSRF токен в заголовок X-CSRFToken** - для корректной работы с Flask-WTF
3. **Добавил резервное получение CSRF токена** - из meta тега если не найден в форме
4. **Добавил подробную отладку** - в консоли браузера и в логах сервера

## Как протестировать:

### 1. Откройте браузер
- Перейдите на `http://localhost:5000/notifications`
- Войдите в систему если требуется

### 2. Откройте консоль разработчика (F12)
- Перейдите на вкладку "Console"
- Нажмите на крестик любого уведомления

### 3. Что искать в консоли браузера:
```
CSRF Token from form: [должен быть токен]
CSRF Token final: [должен быть токен]
Form action: [URL маршрута удаления]
Form data entries: [массив с данными формы]
```

### 4. Что искать в логах сервера:
В терминале где запущен Flask должно появиться:
```
[DEBUG] delete_notification_[тип] called with ID: [номер]
[DEBUG] User ID: [ID пользователя]
[DEBUG] Request headers: {заголовки}
[DEBUG] Request form data: {данные формы}
[DEBUG] Is AJAX request: True
```

## Возможные проблемы и решения:

### Ошибка 400 Bad Request:
- **Проверьте CSRF токен** - должен быть не пустой в консоли
- **Проверьте заголовки** - должен быть X-CSRFToken в запросе
- **Проверьте данные формы** - должен быть csrf_token

### Ошибка 404 Not Found:
- **Проверьте URL** - правильно ли формируется action формы
- **Проверьте ID уведомления** - существует ли в базе данных

### Ошибка 403 Forbidden:
- **Проблема с авторизацией** - пользователь не авторизован
- **Проблема с правами** - уведомление не принадлежит пользователю

### Ошибка 500 Internal Server Error:
- **Проблема с базой данных** - смотрите логи сервера
- **Проблема с кодом** - смотрите полный traceback в логах

## Команды для отладки:

### Проверить статус приложения:
```bash
# Если приложение не отвечает
netstat -ano | findstr :5000
```

### Перезапустить приложение:
```bash
# Остановить все процессы Python
taskkill /f /im python.exe

# Запустить заново
python run.py
```

### Проверить базу данных:
```bash
# Подключиться к SQLite
sqlite3 blog.db

# Проверить уведомления пользователя
SELECT * FROM notifications WHERE user_id = [ID];
SELECT * FROM notifications_add_notes WHERE user_id = [ID];
SELECT * FROM redmine_notifications WHERE user_id = [ID];
```

## Успешное выполнение:

При успешном удалении должно произойти:
1. **В консоли браузера**: отладочная информация с корректными токенами
2. **В логах сервера**: информация о вызове маршрута и обработке
3. **На странице**:
   - Уведомление плавно исчезает с анимацией
   - Появляется toast сообщение "Уведомление успешно удалено"
   - Если это было последнее уведомление - показывается пустое состояние

## Если ничего не помогает:

1. **Очистите кеш браузера** (Ctrl+F5)
2. **Проверьте сетевую вкладку** в Developer Tools - какой именно запрос отправляется
3. **Проверьте вкладку Application** - есть ли проблемы с CSRF токенами в cookies
4. **Попробуйте в режиме инкогнито** - исключить проблемы с расширениями

Если проблема остается, пришлите:
- Логи из консоли браузера
- Логи из терминала Flask
- Скриншот Network tab при отправке запроса
