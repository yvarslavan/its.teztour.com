# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å Flask Helpdesk

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–¥–∞—á–∞—Ö Redmine —Å —Å–∏—Å—Ç–µ–º–æ–π Flask Helpdesk. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –≤–∏–¥–∂–µ—Ç–µ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á –Ω–∞ –∏—Ö –≥—Ä—É–ø–ø—É –∏–ª–∏ –ª–∏—á–Ω–æ –Ω–∞ –Ω–∏—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü–∞:** `u_redmine_notifications`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** 10 —Å—Ç–æ–ª–±—Ü–æ–≤, 4 –∏–Ω–¥–µ–∫—Å–∞
- **–°–≤—è–∑–∏:** –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ —Ç–∞–±–ª–∏—Ü—É `users`

### 2. –¢—Ä–∏–≥–≥–µ—Ä MySQL
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** `tr_Update_Status_Priority_Date_Assigned` (–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω)
- **–°–æ–±—ã—Ç–∏–µ:** `AFTER UPDATE` –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `issues`
- **–õ–æ–≥–∏–∫–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—è `assigned_to_id`

### 3. API Endpoints
- `GET /api/notifications/poll` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤–∫–ª—é—á–∞—è Redmine)
- `POST /api/notifications/redmine/mark-read` - –æ—Ç–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
- `POST /api/notifications/redmine/clear` - –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 4. –í–∏–¥–∂–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û—Ä–∞–Ω–∂–µ–≤–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ò–∫–æ–Ω–∫–∞ `fas fa-tasks`
- –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä—è–º—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∑–∞–¥–∞—á–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ –∫–∞–∫ "–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ" –ø—Ä–∏ –∫–ª–∏–∫–µ

## –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–§–æ—Ä–º–∞—Ç:** "–í –≤–∞—à—É –≥—Ä—É–ø–ø—É [–ì–†–£–ü–ü–ê] –ø–æ—Å—Ç—É–ø–∏–ª–∞ –∑–∞–¥–∞—á–∞ #[–ù–û–ú–ï–†] –æ—Ç [–ê–í–¢–û–†]: [–¢–ï–ú–ê]"

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è:** –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –Ω–∞ –≥—Ä—É–ø–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–§–æ—Ä–º–∞—Ç:** "‚òÖ –í—ã –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º –ø–æ –∑–∞–¥–∞—á–µ #[–ù–û–ú–ï–†] ([—Å—Å—ã–ª–∫–∞]) –¢–µ–º–∞: [–¢–ï–ú–ê] –û–ø–∏—Å–∞–Ω–∏–µ: [–¢–ï–ö–°–¢]"

**–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è:** –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞
1. **–î–≤–æ–π–Ω–æ–π UPDATE:** Easy Redmine –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö UPDATE:
   - –ü–µ—Ä–≤—ã–π: —Å–Ω—è—Ç–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (`assigned_to_id = NULL`)
   - –í—Ç–æ—Ä–æ–π: –Ω–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (`assigned_to_id = [USER_ID]`)

2. **–õ–æ–≥–∏–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—Ç–æ—Ä–æ–º UPDATE –∫–æ–≥–¥–∞ `OLD.assigned_to_id = NULL` –∏ `NEW.assigned_to_id != NULL`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
```sql
CREATE TABLE `u_redmine_notifications` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `redmine_issue_id` int(11) NOT NULL,
  `issue_subject` varchar(500) NOT NULL,
  `issue_description` text,
  `author_name` varchar(255) NOT NULL,
  `author_email` varchar(255),
  `group_name` varchar(255),
  `is_read` tinyint(1) NOT NULL DEFAULT 0,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_redmine_notifications_unique` (`user_id`,`redmine_issue_id`),
  KEY `idx_redmine_notifications_user_unread` (`user_id`,`is_read`,`created_at`),
  KEY `idx_redmine_notifications_created` (`created_at`),
  CONSTRAINT `fk_redmine_notifications_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∏–¥–∂–µ—Ç–æ–º

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API response
```json
{
  "success": true,
  "notifications": {
    "status_notifications": [...],
    "comment_notifications": [...],
    "redmine_notifications": [
      {
        "id": 27,
        "redmine_issue_id": 263126,
        "issue_subject": "–¢–µ–º–∞ –∑–∞–¥–∞—á–∏",
        "issue_description": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
        "author_name": "–ê–≤—Ç–æ—Ä –ó–∞–¥–∞—á–∏",
        "group_name": "–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã",
        "created_at": "2024-01-15T10:30:00",
        "issue_url": "https://helpdesk.teztour.com/issues/263126",
        "is_group_notification": true
      }
    ]
  },
  "total_count": 3
}
```

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- **–¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã:** –û—Ä–∞–Ω–∂–µ–≤—ã–π (`#f97316`)
- **–ò–∫–æ–Ω–∫–∞:** `fas fa-tasks` –Ω–∞ –æ—Ä–∞–Ω–∂–µ–≤–æ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–µ
- **Hover —ç—Ñ—Ñ–µ–∫—Ç:** –û—Ä–∞–Ω–∂–µ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
- **–ö—É—Ä—Å–æ—Ä:** `pointer` –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
python test_redmine_notifications.py
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤ Redmine
2. –ù–∞–∑–Ω–∞—á—å—Ç–µ –µ—ë –Ω–∞ –≥—Ä—É–ø–ø—É –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û—Ç–∫—Ä–æ–π—Ç–µ Flask Helpdesk –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –≤–∏–¥–∂–µ—Ç–µ
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∑–∞–¥–∞—á–∞ –≤ Redmine
6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏
- `[ModernWidget] üì° –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞` - –¥–∞–Ω–Ω—ã–µ –æ—Ç API
- `[ModernWidget] üîó –ö–ª–∏–∫ –ø–æ Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é` - –∫–ª–∏–∫–∏ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º
- `[ModernWidget] ‚úÖ Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ X –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ` - –æ—Ç–º–µ—Ç–∫–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º

### –û—Ç–ª–∞–¥–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `trigger_debug_log` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞:
```sql
SELECT * FROM trigger_debug_log ORDER BY log_time DESC LIMIT 10;
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏ (LIMIT 20)
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ JOIN'—ã
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ localStorage –¥–ª—è seen notifications

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ: ~27 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API: <100ms
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ MySQL: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- –í—Å–µ API endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`@login_required`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (`WHERE user_id = current_user.id`)
- CSRF –∑–∞—â–∏—Ç–∞ –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è notification_id
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ prepared statements
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- MySQL 5.7+ (–¥–ª—è JSON –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
- Python 3.8+
- Flask 2.0+
- PyMySQL

### –ë—Ä–∞—É–∑–µ—Ä—ã
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏, –Ω–µ –ø—Ä–∏ –¥—Ä—É–≥–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
2. –ú–∞–∫—Å–∏–º—É–º 20 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –≤–∏–¥–∂–µ—Ç–µ
3. –¢—Ä–µ–±—É–µ—Ç VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Redmine

### –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤ `trigger_debug_log`
2. **–û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MySQL –≤ `config.ini`
3. **–í–∏–¥–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ JavaScript –æ—à–∏–±–∫–∏

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ 27 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã —Ç—Ä–∏–≥–≥–µ—Ä–æ–º
- ‚úÖ API –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –í–∏–¥–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ö–ª–∏–∫–∏ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û—Ç–º–µ—Ç–∫–∞ "–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º" —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

---

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**
