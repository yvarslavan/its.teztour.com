# üöÄ –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ù–ê–°–¢–†–û–ô–ö–ï –î–ï–ü–õ–û–Ø FLASK HELPDESK

## üìã –û–ë–ó–û–†

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π Flask Helpdesk –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ GitLab CI/CD.

## ‚úÖ –°–¢–ê–¢–£–° PIPELINE

- ‚úÖ **build_deployment_package**: –£—Å–ø–µ—à–Ω–æ (—Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å 127MB –¥–æ <20MB)
- ‚úÖ **pre_deploy_checks**: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- ‚úÖ **deploy_to_server**: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- ‚úÖ **post_deploy_verification**: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- ‚úÖ **rollback_deployment**: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ (manual)

## üîß –®–ê–ì 1: –ü–û–î–ì–û–¢–û–í–ö–ê –°–ï–†–í–ï–†–ê

### 1.1 –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏

–ù–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
wget https://your-gitlab.com/your-project/raw/main/server_setup.sh

# –°–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x server_setup.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É (–ù–ï –æ—Ç root!)
./server_setup.sh
```

### 1.2 –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python 3, Nginx, supervisor
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `deploy`
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç firewall
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç systemd —Å–µ—Ä–≤–∏—Å
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Nginx proxy
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîë –®–ê–ì 2: –ù–ê–°–¢–†–û–ô–ö–ê SSH –ö–õ–Æ–ß–ï–ô

### 2.1 –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–∞ –¥–ª—è –¥–µ–ø–ª–æ—è

–ù–∞ –≤–∞—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á
ssh-keygen -t rsa -b 4096 -f ~/.ssh/flask_helpdesk_deploy

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/flask_helpdesk_deploy.pub deploy@YOUR_SERVER_IP
```

### 2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh -i ~/.ssh/flask_helpdesk_deploy deploy@YOUR_SERVER_IP "echo 'SSH —Ä–∞–±–æ—Ç–∞–µ—Ç!'"
```

## ‚öôÔ∏è –®–ê–ì 3: –ù–ê–°–¢–†–û–ô–ö–ê GITLAB CI/CD –ü–ï–†–ï–ú–ï–ù–ù–´–•

### 3.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ GitLab

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitLab: `Project Settings` ‚Üí `CI/CD` ‚Üí `Variables` –∏ –¥–æ–±–∞–≤—å—Ç–µ:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----|----------|----------|
| `SSH_PRIVATE_KEY` | Variable | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `~/.ssh/flask_helpdesk_deploy` | SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| `DEPLOY_SERVER` | Variable | `your-server.com` –∏–ª–∏ IP | –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ |
| `DEPLOY_USER` | Variable | `deploy` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH |
| `DEPLOY_PATH` | Variable | `/var/www/flask_helpdesk` | –ü—É—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| `BACKUP_PATH` | Variable | `/var/backups/flask_helpdesk` | –ü—É—Ç—å –¥–ª—è –±—ç–∫–∞–ø–æ–≤ |
| `SERVICE_NAME` | Variable | `flask-helpdesk` | –ò–º—è systemd —Å–µ—Ä–≤–∏—Å–∞ |

### 3.2 –ü–æ–ª—É—á–µ–Ω–∏–µ SSH –∫–ª—é—á–∞

```bash
# –í—ã–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
cat ~/.ssh/flask_helpdesk_deploy

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ –≤—ã–≤–æ–¥ –≤–∫–ª—é—á–∞—è –∑–∞–≥–æ–ª–æ–≤–∫–∏
-----BEGIN OPENSSH PRIVATE KEY-----
...
-----END OPENSSH PRIVATE KEY-----
```

## üöÄ –®–ê–ì 4: –ü–ï–†–í–´–ô –î–ï–ü–õ–û–ô

### 4.1 –ó–∞–ø—É—Å–∫ pipeline

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

1. –°–¥–µ–ª–∞–π—Ç–µ commit –≤ –≤–µ—Ç–∫—É `main`
2. Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
3. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –≤ GitLab CI/CD

### 4.2 –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
‚úÖ build_deployment_package   (2-3 –º–∏–Ω—É—Ç—ã)
‚úÖ pre_deploy_checks         (30 —Å–µ–∫—É–Ω–¥)
‚úÖ deploy_to_server          (3-5 –º–∏–Ω—É—Ç)
‚úÖ post_deploy_verification  (30 —Å–µ–∫—É–Ω–¥)
üîÑ rollback_deployment       (manual - –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)
```

## üîç –®–ê–ì 5: –ü–†–û–í–ï–†–ö–ê –î–ï–ü–õ–û–Ø

### 5.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i ~/.ssh/flask_helpdesk_deploy deploy@YOUR_SERVER_IP

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl status flask-helpdesk

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u flask-helpdesk -f
```

### 5.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
curl http://localhost:5000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ Nginx
curl http://YOUR_SERVER_IP
```

### 5.3 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart flask-helpdesk

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo systemctl stop flask-helpdesk

# –ó–∞–ø—É—Å–∫
sudo systemctl start flask-helpdesk

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u flask-helpdesk --no-pager -n 50
```

## üõ†Ô∏è TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á
ssh-add ~/.ssh/flask_helpdesk_deploy
ssh -v deploy@YOUR_SERVER_IP
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞
sudo journalctl -u flask-helpdesk --no-pager -n 20

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /var/www/flask_helpdesk/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
sudo -u www-data /var/www/flask_helpdesk/venv/bin/python --version
```

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
sudo nginx -t

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Nginx
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/flask_helpdesk_error.log
```

## üîÑ –û–¢–ö–ê–¢ –í–ï–†–°–ò–ò

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ manual job `rollback_deployment`:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitLab CI/CD ‚Üí Pipelines
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π pipeline
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ manual job `rollback_deployment`
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –õ–æ–≥–∏ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo tail -f /var/log/flask_helpdesk/app.log

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
sudo tail -f /var/log/flask_helpdesk/error.log

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/flask_helpdesk_access.log
sudo tail -f /var/log/nginx/flask_helpdesk_error.log
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏
htop

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –°–µ—Ç–µ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ss -tulpn | grep :5000
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è –¥–µ–ø–ª–æ—è (–Ω–µ root)
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø** —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª—é—á–µ–π
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall** (UFW —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–º)
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** —Å–∏—Å—Ç–µ–º—É
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```bash
# –û—Ç–∫–ª—é—á–∏—Ç–µ SSH –ø–æ –ø–∞—Ä–æ–ª—é
sudo nano /etc/ssh/sshd_config
# PasswordAuthentication no
sudo systemctl reload ssh

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ fail2ban
sudo apt install fail2ban
```

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitLab CI/CD
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

## üéØ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitLab CI/CD
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ (<20MB)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–í–∞—à–µ Flask Helpdesk –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ
