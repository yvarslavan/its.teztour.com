#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ITS TEZ TOUR..."
echo "==============================================="

# 1. –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞ 5000
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞ 5000..."
bash kill_port_5000.sh > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "   ‚úÖ –ü–æ—Ä—Ç 5000 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
else
    echo "   ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç 5000 –∏–ª–∏ –æ–Ω –±—ã–ª —Å–≤–æ–±–æ–¥–µ–Ω"
fi

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–æ–∫—Å–∏
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–∫—Å–∏..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–∞ 443 –ø–æ—Ä—Ç—É (—Å–∞–º—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π)
if ! pgrep -f "python3 proxy.py 443" > /dev/null; then
    echo "   ‚ö†Ô∏è  –ü—Ä–æ–∫—Å–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã. –ó–∞–ø—É—Å–∫–∞–µ–º setup_python_proxy.sh..."
    echo "   üîí –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–æ–¥ –ø–∞—Ä–æ–ª—è sudo –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤ –∏ hosts"
    bash setup_python_proxy.sh
else
    echo "   ‚úÖ –ü—Ä–æ–∫—Å–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç"
    # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    timeout 1 bash -c "</dev/tcp/127.0.0.1/443" && echo "   ‚úÖ HTTPS Proxy (443) –¥–æ—Å—Ç—É–ø–µ–Ω" || echo "   ‚ùå HTTPS Proxy (443) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω! –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–∫—Å–∏: bash setup_python_proxy.sh"
fi

echo "==============================================="
echo "üèÅ –ó–∞–ø—É—Å–∫ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
echo "   –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
echo "==============================================="

python3 app.py

