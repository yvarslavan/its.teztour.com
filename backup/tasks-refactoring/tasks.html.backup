{% extends 'layout.html' %}

{% block head %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–æ–∏ –∑–∞–¥–∞—á–∏ | Helpdesk</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/datatables.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/datatable-modern.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script src="{{ url_for('static', filename='js/datatables.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_stats.css') }}?v=FIXED_2024_FINAL">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_stats_modern.css') }}?v=SUPER_COMPACT_2024">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_pagination.css') }}?v=COUNTER_INDICATOR_2024">
<link rel="stylesheet" href="{{ url_for('static', filename='css/statistics_interactive.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_enhanced.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/project-tree-integration.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/fix_filter_buttons.css') }}?v=1.5">
<link rel="stylesheet" href="{{ url_for('static', filename='css/issues_style_spinner.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='css/card_breakdown_styles.css') }}?v=1.1">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_counter_indicator.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='css/detailed_breakdown.css') }}?v=1.1">
<link rel="stylesheet" href="{{ url_for('static', filename='css/table_styles.css') }}?v=1.2">
<link rel="stylesheet" href="{{ url_for('static', filename='css/dataTables_length_fix.css') }}?v=1.1">
<link rel="stylesheet" href="{{ url_for('static', filename='css/redmine_widget.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='css/filter_results_section.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_header_fix.css') }}?v=1.2">
<!-- Modern Header Redesign Styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern_header_redesign.css') }}?v={{ range(1000, 9999) | random }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern_header_extended.css') }}?v={{ range(1000, 9999) | random }}">
<!-- CRITICAL FIXES - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π JavaScript –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
<script>
console.log('[CriticalFixes] üö® INLINE –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...');

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —Å–ø–∏–Ω–µ—Ä–∞ –∏ –∫–Ω–æ–ø–æ–∫
function applyCriticalStyles() {
  console.log('[CriticalFixes] üé® –ü—Ä–∏–º–µ–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏...');

  // –°–ü–ò–ù–ï–† - –°–ò–ù–ò–ô –¶–í–ï–¢
  const spinnerIcons = document.querySelectorAll('.spinner-icon, .loading-overlay .spinner-icon, #loading-spinner .spinner-icon');
  spinnerIcons.forEach(icon => {
    icon.style.color = '#3b82f6';
    icon.style.fontSize = '4rem';
    icon.style.textShadow = '0 0 20px rgba(59, 130, 246, 0.3)';
    console.log('[CriticalFixes] ‚úÖ –°–ø–∏–Ω–µ—Ä —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω:', icon);
  });

  // –ö–ù–û–ü–ö–ò - –°–¢–ò–õ–¨–ù–´–ï
  const primaryButtons = document.querySelectorAll('.action-button.primary');
  primaryButtons.forEach(btn => {
    btn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%)';
    btn.style.color = 'white';
    btn.style.boxShadow = '0 4px 15px 0 rgba(59, 130, 246, 0.3), 0 2px 10px 0 rgba(59, 130, 246, 0.2)';
    btn.style.border = '2px solid rgba(255, 255, 255, 0.1)';
    btn.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    console.log('[CriticalFixes] ‚úÖ –ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–∞:', btn);
  });

  const secondaryButtons = document.querySelectorAll('.action-button.secondary');
  secondaryButtons.forEach(btn => {
    btn.style.background = 'rgba(255, 255, 255, 0.9)';
    btn.style.color = '#3b82f6';
    btn.style.border = '2px solid rgba(59, 130, 246, 0.2)';
    btn.style.backdropFilter = 'blur(20px)';
    btn.style.webkitBackdropFilter = 'blur(20px)';
    btn.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    console.log('[CriticalFixes] ‚úÖ –í—Ç–æ—Ä–∏—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–∞:', btn);
  });

  // –û–¢–°–¢–£–ü–´ –ó–ê–ì–û–õ–û–í–ö–ê
  const pageHeader = document.querySelector('.tasks-page-container .page-header');
  if (pageHeader) {
    pageHeader.style.padding = '1.25rem 0 1.5rem 0';
    pageHeader.style.marginBottom = '1.5rem';
    console.log('[CriticalFixes] ‚úÖ –û—Ç—Å—Ç—É–ø—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã');
  }

  const content = document.querySelector('.tasks-page-container.content');
  if (content) {
    content.style.paddingTop = '0.5rem';
    console.log('[CriticalFixes] ‚úÖ –û—Ç—Å—Ç—É–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã');
  }
}

// –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
applyCriticalStyles();

// –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
document.addEventListener('DOMContentLoaded', function() {
  console.log('[CriticalFixes] üîß DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ...');
  applyCriticalStyles();

  // –ü–æ–≤—Ç–æ—Ä—è–µ–º —á–µ—Ä–µ–∑ 500ms –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
  setTimeout(applyCriticalStyles, 500);

  // –ò –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(applyCriticalStyles, 2000);
});

// –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —Å–ø–∏–Ω–µ—Ä–∞
let spinnerLockActive = false;
const originalLoadingManager = window.LoadingManager;

window.ImprovedLoadingManager = {
  show() {
    if (spinnerLockActive) {
      console.log('[CriticalFixes] üö´ –°–ø–∏–Ω–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∑–æ–≤');
      return false;
    }

    spinnerLockActive = true;
    const spinner = document.querySelector('.loading-overlay, #loading-spinner');
    if (spinner) {
      spinner.style.display = 'flex';
      spinner.style.visibility = 'visible';
      spinner.style.opacity = '1';
      console.log('[CriticalFixes] üîÑ –°–ø–∏–Ω–µ—Ä –ø–æ–∫–∞–∑–∞–Ω —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è');
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(() => {
      spinnerLockActive = false;
    }, 1000);

    return true;
  },

  hide() {
    spinnerLockActive = false;
    const spinners = document.querySelectorAll('.loading-overlay, #loading-spinner');
    spinners.forEach(spinner => {
      spinner.style.display = 'none';
      spinner.style.visibility = 'hidden';
      spinner.style.opacity = '0';
    });
    console.log('[CriticalFixes] ‚úÖ –°–ø–∏–Ω–µ—Ä —Å–∫—Ä—ã—Ç');
  },

  forceHide() {
    console.log('[CriticalFixes] üö® –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–ø–∏–Ω–µ—Ä–æ–≤');
    this.hide();
  }
};

// –ó–∞–º–µ–Ω—è–µ–º LoadingManager –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if (window.LoadingManager) {
  window.LoadingManager = window.ImprovedLoadingManager;
  console.log('[CriticalFixes] üîÑ LoadingManager –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é');
}

console.log('[CriticalFixes] üöÄ INLINE –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
</script>

<!-- NEW: Tasks Header Improvements -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_header_improvements.css') }}?v={{ range(1000, 9999) | random }}">

<!-- FORCE APPLY STYLES - Inline Critical CSS -->
<style>
/* üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –°–¢–ò–õ–ò –° –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ú –ü–†–ò–û–†–ò–¢–ï–¢–û–ú */

/* –°–ü–ò–ù–ï–† –°–ò–ù–ò–ô –¶–í–ï–¢ */
.tasks-page-container .loading-overlay .spinner-icon,
#loading-spinner .spinner-icon,
.loading-overlay .spinner-icon {
  color: #3b82f6 !important;
  font-size: 4rem !important;
  margin-bottom: 1.5rem !important;
  animation: spin 1s linear infinite, pulse-glow 2s ease-in-out infinite !important;
}

@keyframes pulse-glow {
  0%, 100% {
    text-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    transform: scale(1);
  }
  50% {
    text-shadow: 0 0 30px rgba(59, 130, 246, 0.6);
    transform: scale(1.05);
  }
}

/* –ö–ù–û–ü–ö–ò –°–¢–ò–õ–¨–ù–´–ï */
.tasks-page-container .action-button.primary,
.page-header .action-button.primary {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%) !important;
  color: white !important;
  box-shadow:
    0 4px 15px 0 rgba(59, 130, 246, 0.3),
    0 2px 10px 0 rgba(59, 130, 246, 0.2) !important;
  border: 2px solid rgba(255, 255, 255, 0.1) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.tasks-page-container .action-button.primary:hover,
.page-header .action-button.primary:hover {
  transform: translateY(-3px) scale(1.02) !important;
  box-shadow:
    0 8px 25px 0 rgba(59, 130, 246, 0.4),
    0 4px 15px 0 rgba(59, 130, 246, 0.3) !important;
}

.tasks-page-container .action-button.secondary,
.page-header .action-button.secondary {
  background: rgba(255, 255, 255, 0.9) !important;
  color: #3b82f6 !important;
  border: 2px solid rgba(59, 130, 246, 0.2) !important;
  backdrop-filter: blur(20px) !important;
  -webkit-backdrop-filter: blur(20px) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.tasks-page-container .action-button.secondary:hover,
.page-header .action-button.secondary:hover {
  background: rgba(59, 130, 246, 0.1) !important;
  border-color: #3b82f6 !important;
  transform: translateY(-2px) scale(1.02) !important;
  color: #1d4ed8 !important;
}

/* –û–¢–°–¢–£–ü–´ –ó–ê–ì–û–õ–û–í–ö–ê */
.tasks-page-container .page-header {
  padding: 1.25rem 0 1.5rem 0 !important;
  margin-bottom: 1.5rem !important;
}

.tasks-page-container.content {
  padding-top: 0.5rem !important;
}

/* HOVER –≠–§–§–ï–ö–¢–´ –î–õ–Ø –ö–ù–û–ü–û–ö */
.tasks-page-container .action-button.primary:hover,
.page-header .action-button.primary:hover {
  transform: translateY(-3px) scale(1.02) !important;
  box-shadow:
    0 8px 25px 0 rgba(59, 130, 246, 0.4),
    0 4px 15px 0 rgba(59, 130, 246, 0.3) !important;
}

.tasks-page-container .action-button.secondary:hover,
.page-header .action-button.secondary:hover {
  background: rgba(59, 130, 246, 0.1) !important;
  border-color: #3b82f6 !important;
  transform: translateY(-2px) scale(1.02) !important;
  color: #1d4ed8 !important;
}
</style>

<script src="{{ url_for('static', filename='js/tasks_modern_ui_v2.js') }}?v=inline_fix_2"></script>
<script src="{{ url_for('static', filename='js/filter_buttons_handler.js') }}?v=1.4"></script>
<script src="{{ url_for('static', filename='js/card_breakdown_handler.js') }}?v=1.5"></script>
<script src="{{ url_for('static', filename='js/force_cache_refresh.js') }}?v={{ range(1000, 9999) | random }}"></script>
{% endblock %}

{% block main_page %}
<div class="tasks-page-container content">


  <!-- Loading Spinner - Issues Style -->
  <div id="loading-spinner" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner-icon">
        <i class="fas fa-cog fa-spin"></i>
      </div>
      <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</h3>
      <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–∏—Å—Ç–µ–º–µ Redmine –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</p>
    </div>
  </div>

  <!-- Header Section -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-main">
        <div class="header-icon">
          <i class="fas fa-tasks"></i>
        </div>
        <div class="header-text">
          <h1 class="page-title">–ú–æ–∏ –∑–∞–¥–∞—á–∏ –≤ Redmine</h1>
          <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–∏—Ö –∑–∞–¥–∞—á –≤ Redmine</p>

        </div>
      </div>
      <div class="header-actions">
        <a href="https://helpdesk.teztour.com" target="_blank" class="action-button secondary">
          <i class="fas fa-external-link-alt"></i>
          <span>–ü–µ—Ä–µ–π—Ç–∏ –≤ Redmine</span>
        </a>
        <a href="{{ url_for('main.my_issues') }}" class="action-button primary">
          <i class="fas fa-ticket-alt"></i>
          <span>–ú–æ–∏ –∑–∞—è–≤–∫–∏</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Status Breakdown Dashboard -->
  <section class="status-breakdown-dashboard">
    <div class="breakdown-header">
      <div class="breakdown-title">
        <i class="fas fa-chart-pie"></i>
        <h2>–†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h2>
      </div>
      <div class="breakdown-summary">
        <span class="summary-value" id="total-tasks-summary">-</span>
        <span class="summary-label">–≤—Å–µ–≥–æ –∑–∞–¥–∞—á</span>
        <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ -->
        <button class="global-toggle-btn collapsed-state" id="globalToggleBtn" title="–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫">
          <i class="fas fa-expand-alt"></i>
          <span>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</span>
        </button>
      </div>
    </div>

    <div class="status-breakdown-grid">
      <!-- –í—Å–µ–≥–æ –∑–∞–¥–∞—á -->
      <div class="status-breakdown-card total-card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-list-alt"></i>
          </div>
          <div class="card-title">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
          <button class="card-toggle-btn" data-target="total-breakdown" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="card-content">
          <div class="card-value" id="total-tasks">-</div>
          <div class="card-description">–í—Å–µ –∑–∞–¥–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ</div>
          <div class="card-breakdown collapsed" id="total-breakdown">
            <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>

      <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏ -->
      <div class="status-breakdown-card open-card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-folder-open"></i>
          </div>
          <div class="card-title">–û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</div>
          <button class="card-toggle-btn" data-target="open-breakdown" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="card-content">
          <div class="card-value" id="open-tasks">-</div>
          <div class="card-description">–ù–æ–≤—ã–µ –∏ –æ–∂–∏–¥–∞—é—â–∏–µ</div>
          <div class="card-breakdown collapsed" id="open-breakdown">
            <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>

      <!-- –ó–∞–∫—Ä—ã—Ç—ã–µ –≤ –ë–î -->
      <div class="status-breakdown-card closed-db-card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-database"></i>
          </div>
          <div class="card-title">–ó–∞–∫—Ä—ã—Ç—ã–µ –≤ –ë–î</div>
          <button class="card-toggle-btn" data-target="closed-breakdown" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="card-content">
          <div class="card-value" id="closed-db-tasks">-</div>
          <div class="card-description">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã–µ</div>
          <div class="card-breakdown collapsed" id="closed-breakdown">
            <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>

      <!-- –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ -->
      <div class="status-breakdown-card paused-card">
        <div class="card-header">
          <div class="card-icon">
            <i class="fas fa-pause-circle"></i>
          </div>
          <div class="card-title">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ</div>
          <button class="card-toggle-btn" data-target="paused-breakdown" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
        <div class="card-content">
          <div class="card-value" id="paused-tasks">-</div>
          <div class="card-description">–ù–∞ –ø–∞—É–∑–µ –∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã</div>
          <div class="card-breakdown collapsed" id="paused-breakdown">
            <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
      </div>
    </div>

    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º -->
    <div class="detailed-status-breakdown">
      <div class="breakdown-section-header">
        <h3>–î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞</h3>
        <button class="expand-breakdown-btn" id="expandBreakdownBtn">
          <i class="fas fa-chevron-down"></i>
          <span>–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏</span>
        </button>
      </div>
      <div class="detailed-breakdown-content" id="detailedBreakdownContent">
        <div class="status-items-grid" id="statusItemsGrid">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
        </div>
      </div>
    </div>
  </section>

  <!-- Controls Panel -->
  <section class="controls-panel">
    <div class="controls-content">
      <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π -->
      <div class="left-controls">
        <div class="display-options">
          <div class="display-item">
            <div id="lengthContainer" class="length-container">
              <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π DataTables -->
            </div>
          </div>

        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
      <div class="right-controls">
        <div class="filters-section">
          <div class="filter-group">
            <div class="filter-item">
              <label class="filter-label">
                <i class="fas fa-filter"></i>
                –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
              </label>
              <div id="statusFilterContainer" class="filter-container">
                <select id="status-filter" class="form-control">
                  <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                </select>
                <button type="button" class="filter-clear-btn" id="clear-status-filter" title="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="filter-item">
              <label class="filter-label">
                <i class="fas fa-project-diagram"></i>
                –ü—Ä–æ–µ–∫—Ç
              </label>
              <div id="projectFilterContainer" class="filter-container">
                <select id="project-filter" class="form-control searchable-select">
                  <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
                </select>
                <button type="button" class="filter-clear-btn" id="clear-project-filter" title="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="filter-item">
              <label class="filter-label">
                <i class="fas fa-exclamation-triangle"></i>
                –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
              </label>
              <div id="priorityFilterContainer" class="filter-container">
                <select id="priority-filter" class="form-control">
                  <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
                </select>
                <button type="button" class="filter-clear-btn" id="clear-priority-filter" title="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="search-section">
            <label class="search-label">
              <i class="fas fa-search"></i>
              –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
            </label>
            <div id="searchBoxContainer" class="search-container">
              <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω –ø–æ–∏—Å–∫ DataTables -->
            </div>
          </div>

          <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –±–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
          <div class="filter-results-section">
            <div class="results-badge-bright">
              <div class="results-icon">
                <i class="fas fa-list-alt"></i>
              </div>
              <div class="results-text">
                <span class="results-label">–ù–∞–π–¥–µ–Ω–æ:</span>
                <span id="filtered-tasks-count" class="results-count">0</span>
                <span class="results-suffix">–∑–∞–¥–∞—á</span>
              </div>
              <div class="results-pulse"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tasks Counter Indicator -->
  <div id="tasksCounterIndicator" class="tasks-counter-indicator">
    <div class="counter-content">
      <div class="counter-icon">
        <i class="fas fa-tasks"></i>
      </div>
      <div class="counter-text">
        <span class="counter-value">0</span>
        <span class="counter-label">–∑–∞–¥–∞—á –Ω–∞–π–¥–µ–Ω–æ</span>
      </div>
      <div class="counter-loading">
        <div class="counter-spinner"></div>
        <span class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </div>
  </div>

  <!-- Tasks Table -->
  <section class="tasks-section">
    <div class="table-container">
      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã -->
      <div class="table-loading-overlay">
        <div class="table-loading-content">
          <i class="fas fa-spinner table-spinner-icon"></i>
          <div class="table-loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
      </div>

      <div class="table-wrapper">
        <table id="tasksTable" class="tasks-table">
          <thead>
            <tr>
              <th class="column-id">
                <div class="column-header">
                  <i class="fas fa-hashtag"></i>
                  <span>ID</span>
                </div>
              </th>
              <th class="column-subject">
                <div class="column-header">
                  <i class="fas fa-envelope"></i>
                  <span>–¢–µ–º–∞</span>
                </div>
              </th>
              <th class="column-status">
                <div class="column-header">
                  <i class="fas fa-info-circle"></i>
                  <span>–°—Ç–∞—Ç—É—Å</span>
                </div>
              </th>
              <th class="column-priority">
                <div class="column-header">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                </div>
              </th>
              <th class="column-email-to">
                <div class="column-header">
                  <i class="fas fa-envelope"></i>
                  <span>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</span>
                </div>
              </th>
              <th class="column-updated">
                <div class="column-header">
                  <i class="fas fa-sync-alt"></i>
                  <span>–û–±–Ω–æ–≤–ª–µ–Ω–æ</span>
                </div>
              </th>
              <th class="column-created">
                <div class="column-header">
                  <i class="fas fa-calendar"></i>
                  <span>–°–æ–∑–¥–∞–Ω</span>
                </div>
              </th>
              <th class="column-start-date">
                <div class="column-header">
                  <i class="fas fa-calendar-plus"></i>
                  <span>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="tasks-table-body">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- Table Footer with Info and Pagination -->
      <div class="table-footer">
        <div class="table-info">
          <div id="tasksInfoContainer">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è DataTables -->
          </div>
        </div>
        <div class="table-pagination">
          <div id="tasksPaginationContainer">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è DataTables -->
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock main_page %}

{% block styles %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_pagination.css') }}">

<!-- Force CSS reload with timestamp -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_stats.css') }}?v=CARD_TOGGLE_FIXED_v2">

<!-- Inline Critical Styles -->
<style>
  /* Force immediate styling before JS loads */
  .filter-container select,
  .search-container input,
  .length-container select,
  #status-filter,
  #project-filter,
  #priority-filter,
  #tasksTable_filter input,
  #tasksTable_length select {
    font-size: 16px !important;
    font-weight: 500 !important;
    height: 48px !important;
    padding: 12px !important;
    border: 1px solid #e5e7eb !important;
    border-radius: 8px !important;
    background-color: #ffffff !important;
    color: #374151 !important;
  }

  .filter-label,
  .search-label,
  .display-label,
  .dataTables_length label,
  .dataTables_filter label {
    font-size: 16px !important;
    font-weight: 500 !important;
    color: #374151 !important;
  }

  /* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á */
  #tasksCounterIndicator {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }

  /* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
  .card-toggle-btn {
    z-index: 10 !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
  }

  .card-breakdown {
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    overflow: hidden !important;
  }

  .card-breakdown.collapsed {
    max-height: 0 !important;
    opacity: 0 !important;
    transform: translateY(-10px) !important;
    margin-top: 0 !important;
    padding-top: 0 !important;
    border-top: none !important;
    pointer-events: none !important;
  }

  .card-breakdown.expanded {
    max-height: 200px !important;
    opacity: 1 !important;
    transform: translateY(0) !important;
    margin-top: 8px !important;
    padding-top: 6px !important;
    border-top: 1px solid rgba(100, 116, 139, 0.1) !important;
    overflow-y: auto !important;
    pointer-events: auto !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–Ω–æ–ø–æ–∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ */
  .card-toggle-btn {
    position: absolute !important;
    top: 0.75rem !important;
    right: 0.875rem !important;
    background: rgba(255, 255, 255, 0.95) !important;
    border: 1px solid rgba(100, 116, 139, 0.3) !important;
    color: #3b82f6 !important;
    font-size: 12px !important;
    cursor: pointer !important;
    padding: 8px !important;
    border-radius: 8px !important;
    transition: all 0.3s ease !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 28px !important;
    min-height: 28px !important;
    z-index: 100 !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
    pointer-events: auto !important;
    opacity: 1 !important;
    visibility: visible !important;
  }

  .card-toggle-btn:hover {
    background: #3b82f6 !important;
    color: white !important;
    transform: scale(1.1) !important;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
  }

  .card-toggle-btn i {
    transition: transform 0.3s ease !important;
    display: inline-block !important;
  }

  .card-toggle-btn.expanded i {
    transform: rotate(180deg) !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–π –æ–±–ª–∞—Å—Ç–∏ */
  .card-breakdown {
    overflow: hidden !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    border-top: 1px solid rgba(226, 232, 240, 0.5) !important;
    margin-top: 0.75rem !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
  }

  .card-breakdown.collapsed {
    max-height: 0 !important;
    opacity: 0 !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    margin-top: 0 !important;
    border-top: none !important;
    transform: translateY(-10px) !important;
    pointer-events: none !important;
    display: block !important; /* –í–∞–∂–Ω–æ: –Ω–µ —Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é */
    visibility: hidden !important;
  }

  .card-breakdown.expanded {
    max-height: 150px !important;
    opacity: 1 !important;
    padding-top: 0.75rem !important;
    padding-bottom: 0.75rem !important;
    transform: translateY(0) !important;
    overflow-y: auto !important;
    pointer-events: auto !important;
    display: block !important;
    visibility: visible !important;
  }

  /* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á */
  #tasksCounterIndicator {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }

  /* Import Modern Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap');

  /* CSS Custom Properties */
  :root {
    /* Primary Color Palette */
    --primary-50: #e3f2fd;
    --primary-100: #bbdefb;
    --primary-200: #90caf9;
    --primary-300: #64b5f6;
    --primary-400: #42a5f5;
    --primary-500: #2196f3;
    --primary-600: #1e88e5;
    --primary-700: #1976d2;
    --primary-800: #1565c0;
    --primary-900: #0d47a1;

    /* Secondary Color Palette */
    --secondary-50: #e8f5e8;
    --secondary-100: #c8e6c9;
    --secondary-200: #a5d6a7;
    --secondary-300: #81c784;
    --secondary-400: #66bb6a;
    --secondary-500: #4caf50;
    --secondary-600: #43a047;
    --secondary-700: #388e3c;
    --secondary-800: #2e7d32;
    --secondary-900: #1b5e20;

    /* Status Colors */
    --status-new: #ff9800;
    --status-progress: #2196f3;
    --status-closed: #4caf50;
    --status-rejected: #f44336;

    /* Priority Colors */
    --priority-low: #4caf50;
    --priority-normal: #ff9800;
    --priority-high: #f44336;
    --priority-urgent: #9c27b0;

    /* Surface Colors */
    --surface-0: #ffffff;
    --surface-1: #f8fafc;
    --surface-2: #f1f5f9;
    --surface-3: #e2e8f0;
    --surface-card: rgba(255, 255, 255, 0.95);

    /* Text Colors */
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-muted: #64748b;
    --text-disabled: #94a3b8;

    /* Border & Effects */
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-focus: var(--primary-500);

    /* Shadows */
    --shadow-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
    --shadow-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
    --shadow-3: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
    --shadow-card: 0 8px 25px rgba(33, 150, 243, 0.08);

    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-xxl: 3rem;

    /* Border Radius */
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-xxl: 24px;

    /* Transitions */
    --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
  .global-toggle-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    color: #3b82f6;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .global-toggle-btn:hover {
    background: #f0f9ff;
    border-color: #3b82f6;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
  }

  .global-toggle-btn.expanded-state {
    background: #3b82f6;
    color: white;
  }

  .global-toggle-btn.expanded-state:hover {
    background: #2563eb;
  }

  .global-toggle-btn i {
    transition: transform 0.3s ease;
  }

  .global-toggle-btn.expanded-state i {
    transform: rotate(180deg);
  }
</style>
{% endblock styles %}

{% block scripts %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ -->
<script src="{{ url_for('static', filename='js/tasks_paginated.js') }}?v=FILTER_FIX_FINAL_2"></script>
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<script src="{{ url_for('static', filename='js/filter_buttons_handler.js') }}?v=1.2"></script>
<!-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
<script src="{{ url_for('static', filename='js/card_breakdown_handler.js') }}?v=1.5"></script>
<!-- –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–¥–∞—á -->
<script src="{{ url_for('static', filename='js/tasks_counter_manager.js') }}?v=1.1"></script>
<!-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã -->
<script src="{{ url_for('static', filename='js/table_loading_handler.js') }}?v=1.1"></script>
<!-- –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–ø–∏–Ω–Ω–µ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Å—Ç–∏–ª–µ Issues -->
<script src="{{ url_for('static', filename='js/issues_style_loading_manager.js') }}?v=1.0"></script>
<!-- –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π -->
<script src="{{ url_for('static', filename='js/debug_spinner.js') }}?v=1.1"></script>
<!-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π -->
<script src="{{ url_for('static', filename='js/force_apply_styles.js') }}?v=1.4"></script>
<!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ -->
<script src="{{ url_for('static', filename='js/tasks_paginated_spinner_fix.js') }}?v=1.0"></script>
{% endblock %}
