{% extends "layout.html" %}

{% block content %}
<!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loading-spinner" class="loading-overlay">
    <div class="loading-content">
        <div class="spinner-icon">
            <i class="fas fa-cog fa-spin"></i>
        </div>
        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</h3>
        <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–∏—Å—Ç–µ–º–µ Redmine –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</p>
    </div>
</div>

<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<header class="page-header">
    <div class="header-content">
        <div class="header-main">
            <div class="header-icon">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="header-text">
                <h1 class="page-title">–ú–æ–∏ –∑–∞–¥–∞—á–∏ –≤ Redmine</h1>
                <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–∏—Ö –∑–∞–¥–∞—á –≤ Redmine</p>
            </div>
        </div>
        <div class="header-actions">
            <a href="https://helpdesk.teztour.com" class="action-button secondary" target="_blank">
                <i class="fas fa-external-link-alt"></i>
                <span>–ü–µ—Ä–µ–π—Ç–∏ –≤ Redmine</span>
            </a>
            <a href="{{ url_for('main.my_issues') }}" class="action-button primary">
                <i class="fas fa-ticket-alt"></i>
                <span>–ú–æ–∏ –∑–∞—è–≤–∫–∏</span>
            </a>
        </div>
    </div>
</header>

<!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (Status Breakdown Dashboard) -->
<section class="status-breakdown-dashboard">
    <div class="breakdown-header">
        <div class="breakdown-title">
            <i class="fas fa-chart-pie"></i>
            <h2>–†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h2>
        </div>
        <div class="breakdown-summary">
            <span class="summary-value" id="total-tasks-summary">-</span>
            <span class="summary-label">–≤—Å–µ–≥–æ –∑–∞–¥–∞—á</span>
            <button class="global-toggle-btn" id="globalToggleBtn">
                <i class="fas fa-expand-alt"></i>
                <span>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</span>
            </button>
        </div>
    </div>

    <div class="status-breakdown-grid">
        <!-- –í—Å–µ–≥–æ –∑–∞–¥–∞—á -->
        <div class="status-card" data-type="total">
            <div class="card-header">
                <div class="card-icon total">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="card-title">
                    <h3>–í—Å–µ–≥–æ –∑–∞–¥–∞—á</h3>
                    <span class="card-value" id="total-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</p>
            </div>
            <button class="toggle-details-btn" data-target="total-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="total-details" style="display: none;">
                <div class="details-content" id="total-details-content">
                    <div class="detail-item">
                        <span class="detail-label">–û—Ç–∫—Ä—ã—Ç—ã–µ:</span>
                        <span class="detail-value" id="total-open">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">–í —Ä–∞–±–æ—Ç–µ:</span>
                        <span class="detail-value" id="total-in-progress">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ:</span>
                        <span class="detail-value" id="total-completed">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í —Ä–∞–±–æ—Ç–µ -->
        <div class="status-card" data-type="in-progress">
            <div class="card-header">
                <div class="card-icon paused">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="card-title">
                    <h3>–í —Ä–∞–±–æ—Ç–µ</h3>
                    <span class="card-value" id="in-progress-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</p>
            </div>
            <button class="toggle-details-btn" data-target="in-progress-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="in-progress-details" style="display: none;">
                <div class="details-content" id="in-progress-details-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </div>
            </div>
        </div>

        <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏ -->
        <div class="status-card" data-type="open">
            <div class="card-header">
                <div class="card-icon open">
                    <i class="fas fa-folder-open"></i>
                </div>
                <div class="card-title">
                    <h3>–û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</h3>
                    <span class="card-value" id="open-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–ù–æ–≤—ã–µ –∏ –æ–∂–∏–¥–∞—é—â–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</p>
            </div>
            <button class="toggle-details-btn" data-target="open-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="open-details" style="display: none;">
                <div class="details-content" id="open-details-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </div>
            </div>
        </div>

        <!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
        <div class="status-card" data-type="completed">
            <div class="card-header">
                <div class="card-icon closed">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="card-title">
                    <h3>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</h3>
                    <span class="card-value" id="completed-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</p>
            </div>
            <button class="toggle-details-btn" data-target="completed-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="completed-details" style="display: none;">
                <div class="details-content" id="completed-details-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div class="filters-section">
    <div class="filter-container">
        <label class="filter-label">–°—Ç–∞—Ç—É—Å:</label>
        <select id="status-filter" class="filter-select">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        </select>
        <button class="clear-filter-btn" id="clear-status-filter" style="display: none;">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="filter-container">
        <label class="filter-label">–ü—Ä–æ–µ–∫—Ç:</label>
        <select id="project-filter" class="filter-select">
            <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
        </select>
        <button class="clear-filter-btn" id="clear-project-filter" style="display: none;">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="filter-container">
        <label class="filter-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
        <select id="priority-filter" class="filter-select">
            <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
        </select>
        <button class="clear-filter-btn" id="clear-priority-filter" style="display: none;">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á -->
<div class="table-container">
    <div class="table-header">
        <h3 class="table-title">
            <i class="fas fa-tasks"></i>
            –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
        </h3>
    </div>
    <div class="table-wrapper">
        <table id="tasksTable" class="display modern-datatable-redesigned">
            <thead>
                <tr>
                    <th data-column="id" class="col-id">
                        <div class="th-content">
                            <i class="fas fa-hashtag"></i>
                            <span>ID</span>
                        </div>
                    </th>
                    <th data-column="easy_email_to" class="col-email">
                        <div class="th-content">
                            <i class="fas fa-envelope"></i>
                            <span>Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</span>
                        </div>
                    </th>
                    <th data-column="subject" class="col-subject">
                        <div class="th-content">
                            <i class="fas fa-file-text"></i>
                            <span>–¢–µ–º–∞ –∑–∞–¥–∞—á–∏</span>
                        </div>
                    </th>
                    <th data-column="status" class="col-status">
                        <div class="th-content">
                            <i class="fas fa-flag"></i>
                            <span>–°—Ç–∞—Ç—É—Å</span>
                        </div>
                    </th>
                    <th data-column="priority" class="col-priority">
                        <div class="th-content">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                        </div>
                    </th>
                    <th data-column="created_on" class="col-created">
                        <div class="th-content">
                            <i class="fas fa-calendar-plus"></i>
                            <span>–°–æ–∑–¥–∞–Ω–∞</span>
                        </div>
                    </th>
                    <th data-column="updated_on" class="col-updated">
                        <div class="th-content">
                            <i class="fas fa-calendar-check"></i>
                            <span>–û–±–Ω–æ–≤–ª–µ–Ω–∞</span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </tbody>
        </table>
    </div>
</div>

<!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ DataTables -->
<div class="dt-processing" style="display: none;">
    <div class="processing-content">
        <i class="fas fa-spinner fa-spin"></i>
        <span>–û–±—Ä–∞–±–æ—Ç–∫–∞...</span>
    </div>
</div>

<!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
<div class="empty-state" id="empty-state" style="display: none;">
    <i class="fas fa-inbox empty-icon"></i>
    <h3>–ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
    <p>–ü–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    <button class="btn btn-secondary" id="reset-filters-btn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
</div>

<!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ -->
<div class="error-state" id="error-state" style="display: none;">
    <i class="fas fa-exclamation-triangle error-icon"></i>
    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
    <p id="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–∏—Å—Ç–µ–º–µ Redmine</p>
    <button class="btn btn-primary" id="retry-btn">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

{% endblock %}

{% block scripts %}
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">

<!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ CSS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/my_tasks_modern_ui.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/status_accordion.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern-status-indicators.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_enhanced.css') }}?v={{ cache_buster or '1' }}">
<!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–¥–∏–∑–∞–π–Ω —à–∞–ø–∫–∏ —Ç–∞–±–ª–∏—Ü—ã DataTables -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_table_header_redesign.css') }}?v={{ cache_buster or '1' }}">

<!-- –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è email-—Å—Å—ã–ª–æ–∫ -->
<style>
/* –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Tech-—Å—Ç–∏–ª—å */
.email-link {
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
    font-size: 13px;
    font-weight: 500;
    color: #4f46e5 !important;
    text-decoration: none;
    padding: 4px 8px;
    border-radius: 6px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border: 1px solid #e2e8f0;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-block;
    position: relative;
    letter-spacing: 0.02em;
}

/* –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â—É—é—Å—è –∏–∫–æ–Ω–∫—É - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ FontAwesome –∏–∫–æ–Ω–∫—É –∏–∑ HTML */

.email-link:hover {
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: #ffffff !important;
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 8px 25px rgba(79, 70, 229, 0.15), 0 4px 10px rgba(0, 0, 0, 0.1);
    border-color: #4f46e5;
}

.email-link:active {
    transform: translateY(-1px) scale(1.01);
}

.email-link:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: #ffffff !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è FontAwesome –∏–∫–æ–Ω–∫–∏ –≤ email-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ */
.email-container {
    display: flex;
    align-items: center;
    gap: 6px;
}

.email-container .fa-envelope {
    flex-shrink: 0;
    font-size: 14px;
    opacity: 0.8;
    transition: all 0.2s ease;
}

.email-container:hover .fa-envelope {
    opacity: 1;
    transform: scale(1.1);
}

/* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.email-link.compact {
    font-family: 'Inter', 'Segoe UI', 'Roboto', sans-serif;
    font-size: 12px;
    font-weight: 600;
    padding: 3px 6px;
    background: #f0f9ff;
    border: 1px solid #0ea5e9;
    color: #0ea5e9 !important;
}

.email-link.compact:hover {
    background: #0ea5e9;
    color: #ffffff !important;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π */
.email-style-selector {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.9);
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-size: 12px;
}

.email-style-selector select {
    padding: 4px 8px;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    font-size: 11px;
}
</style>

<!-- –°–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–∏–ª–µ–π –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) -->
<div class="email-style-selector" style="display: none;">
    <label>Email —Å—Ç–∏–ª—å:</label>
    <select id="emailStyleSelector">
        <option value="">Tech (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
        <option value="minimal">–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π</option>
        <option value="glass">Glassmorphism</option>
        <option value="neomorphic">–ù–µ–æ–º–æ—Ä—Ñ–∏–∑–º</option>
    </select>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π email-—Å—Å—ã–ª–æ–∫ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
function switchEmailStyle(newStyle) {
    const emailLinks = document.querySelectorAll('.email-link');
    emailLinks.forEach(link => {
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Å—Ç–∏–ª–µ–π
        link.classList.remove('minimal', 'glass', 'neomorphic');
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Å—Ç–∏–ª—å –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
        if (newStyle) {
            link.classList.add(newStyle);
        }
    });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å—Ç–∏–ª–µ–π
document.addEventListener('DOMContentLoaded', function() {
    const selector = document.getElementById('emailStyleSelector');
    if (selector) {
        selector.addEventListener('change', function() {
            switchEmailStyle(this.value);
        });
    }
});
</script>

<!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ jQuery –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ -->
<script>
if (typeof jQuery === 'undefined') {
    document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"><\/script>');
}
</script>

<!-- DataTables JS -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>

<!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ JS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<script src="{{ url_for('static', filename='js/my_tasks_app.js') }}?v={{ cache_buster or '1' }}"></script>
<script src="{{ url_for('static', filename='js/status_accordion.js') }}?v={{ cache_buster or '1' }}"></script>

<script>
// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
function initializeMyTasksPage() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ú–æ–∏ –∑–∞–¥–∞—á–∏"');
    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...');
    console.log('jQuery –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof $ !== 'undefined');
    console.log('DataTables –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof $.fn.DataTable !== 'undefined');
    console.log('MyTasksApp –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof MyTasksApp !== 'undefined');

    if (typeof $ === 'undefined') {
        console.error('‚ùå jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        showError('jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        return;
    }

    if (typeof $.fn.DataTable === 'undefined') {
        console.error('‚ùå DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        showError('DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        return;
    }

    if (typeof MyTasksApp !== 'undefined') {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        setTimeout(function() {
            MyTasksApp.init();
        }, 100);
    } else {
        console.error('‚ùå MyTasksApp –Ω–µ –Ω–∞–π–¥–µ–Ω');
        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á.');
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
function showError(message) {
    const loadingElement = document.getElementById('loading-overlay');
    const errorElement = document.getElementById('error-state');
    const errorMessageElement = document.getElementById('error-message');

    if (loadingElement) loadingElement.style.display = 'none';

    if (errorElement && errorMessageElement) {
        errorMessageElement.textContent = message;
        errorElement.style.display = 'block';
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
document.addEventListener('DOMContentLoaded', function() {
    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    setTimeout(initializeMyTasksPage, 200);
});

// –†–µ–∑–µ—Ä–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª—É—á–∞—è –µ—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initializeMyTasksPage, 200);
    });
} else {
    setTimeout(initializeMyTasksPage, 200);
}
</script>
{% endblock %}
