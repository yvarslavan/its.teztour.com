{% extends "layout.html" %}

{% block content %}
<!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loading-spinner" class="loading-overlay">
  <div class="loading-content">
    <div class="spinner-icon">
      <i class="fas fa-rocket fa-bounce"></i>
    </div>
    <h3>üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏...</h3>
    <p id="loading-message">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Kanban –¥–æ—Å–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redmine API</p>
    <div class="loading-progress">
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      <span class="progress-text">0%</span>
    </div>
  </div>
</div>



<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<header class="page-header">
  <div class="header-content">
    <div class="header-main">
      <div class="header-icon">
        <i class="fas fa-tasks"></i>
      </div>
      <div class="header-text">
        <h1 class="page-title">–ú–æ–∏ –∑–∞–¥–∞—á–∏ –≤ Redmine</h1>
        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–∏—Ö –∑–∞–¥–∞—á –≤ Redmine</p>
      </div>
    </div>
    <div class="header-actions">
      <a href="https://helpdesk.teztour.com" class="action-button secondary" target="_blank">
        <i class="fas fa-external-link-alt"></i>
        <span>–ü–µ—Ä–µ–π—Ç–∏ –≤ Redmine</span>
      </a>
      <a href="{{ url_for('main.my_issues') }}" class="action-button primary">
        <i class="fas fa-ticket-alt"></i>
        <span>–ú–æ–∏ –∑–∞—è–≤–∫–∏</span>
      </a>
      <div class="theme-switcher-container">
        <button id="theme-switcher" class="theme-switcher" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
          <i class="fas fa-sun theme-icon-light"></i>
          <i class="fas fa-moon theme-icon-dark"></i>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (Status Breakdown Dashboard) -->
<section class="status-breakdown-dashboard">
  <div class="breakdown-header">
    <div class="breakdown-title">
      <i class="fas fa-tachometer-alt"></i>
      <h2>–î–∞—à–±–æ—Ä–¥ –∑–∞–¥–∞—á</h2>
    </div>
    <div class="breakdown-summary">
      <span class="summary-value" id="total-tasks-summary">-</span>
      <span class="summary-label">–≤—Å–µ–≥–æ –∑–∞–¥–∞—á</span>
      <button class="global-toggle-btn" id="globalToggleBtn">
        <i class="fas fa-expand-alt"></i>
        <span>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</span>
      </button>
    </div>
  </div>

  <div class="status-breakdown-grid">
    <!-- –í—Å–µ–≥–æ –∑–∞–¥–∞—á -->
    <div class="status-card" data-type="total">
      <div class="card-header">
        <div class="card-icon total">
          <i class="fas fa-tasks"></i>
        </div>
        <div class="card-title">
          <h3>–í—Å–µ–≥–æ –∑–∞–¥–∞—á</h3>
          <span class="card-value" id="total-tasks">-</span>
        </div>
      </div>
      <div class="card-description">
        <p>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</p>
      </div>
      <button class="toggle-details-btn" data-target="total-details">
        <i class="fas fa-chevron-down"></i>
        <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
      </button>
      <div class="card-details" id="total-details" style="display: none;">
        <div class="details-content" id="total-details-content">
          <div class="detail-item">
            <span class="detail-label">–û—Ç–∫—Ä—ã—Ç—ã–µ:</span>
            <span class="detail-value" id="total-open">-</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">–í —Ä–∞–±–æ—Ç–µ:</span>
            <span class="detail-value" id="total-in-progress">-</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ:</span>
            <span class="detail-value" id="total-completed">-</span>
          </div>
        </div>
      </div>
    </div>

    <!-- –í —Ä–∞–±–æ—Ç–µ -->
    <div class="status-card" data-type="in-progress">
      <div class="card-header">
        <div class="card-icon paused">
          <i class="fas fa-cogs"></i>
        </div>
        <div class="card-title">
          <h3>–í —Ä–∞–±–æ—Ç–µ</h3>
          <span class="card-value" id="in-progress-tasks">-</span>
        </div>
      </div>
      <div class="card-description">
        <p>–í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</p>
      </div>
      <button class="toggle-details-btn" data-target="in-progress-details">
        <i class="fas fa-chevron-down"></i>
        <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
      </button>
      <div class="card-details" id="in-progress-details" style="display: none;">
        <div class="details-content" id="in-progress-details-content">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
        </div>
      </div>
    </div>

    <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏ -->
    <div class="status-card" data-type="open">
      <div class="card-header">
        <div class="card-icon open">
          <i class="fas fa-folder-open"></i>
        </div>
        <div class="card-title">
          <h3>–û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</h3>
          <span class="card-value" id="open-tasks">-</span>
        </div>
      </div>
      <div class="card-description">
        <p>–ù–æ–≤—ã–µ –∏ –æ–∂–∏–¥–∞—é—â–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</p>
      </div>
      <button class="toggle-details-btn" data-target="open-details">
        <i class="fas fa-chevron-down"></i>
        <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
      </button>
      <div class="card-details" id="open-details" style="display: none;">
        <div class="details-content" id="open-details-content">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
        </div>
      </div>
    </div>

    <!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
    <div class="status-card" data-type="completed">
      <div class="card-header">
        <div class="card-icon closed">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="card-title">
          <h3>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</h3>
          <span class="card-value" id="completed-tasks">-</span>
        </div>
      </div>
      <div class="card-description">
        <p>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</p>
      </div>
      <button class="toggle-details-btn" data-target="completed-details">
        <i class="fas fa-chevron-down"></i>
        <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
      </button>
      <div class="card-details" id="completed-details" style="display: none;">
        <div class="details-content" id="completed-details-content">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
        </div>
      </div>
    </div>
  </div>
</section>

<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div class="filters-section">
  <div class="filter-container">
    <label class="filter-label">–°—Ç–∞—Ç—É—Å:</label>
    <select id="status-filter" class="filter-select">
      <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
    </select>
    <button class="clear-filter-btn" id="clear-status-filter" style="display: none;">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="filter-container">
    <label class="filter-label">–ü—Ä–æ–µ–∫—Ç:</label>
    <select id="project-filter" class="filter-select">
      <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
    </select>
    <button class="clear-filter-btn" id="clear-project-filter" style="display: none;">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="filter-container">
    <label class="filter-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
    <select id="priority-filter" class="filter-select">
      <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
    </select>
    <button class="clear-filter-btn" id="clear-priority-filter" style="display: none;">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>

<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–æ–≤ -->
<div class="view-toggle-section">
  <div class="view-toggle-container">
    <button class="view-toggle-btn active" data-view="list">
      <i class="fas fa-list"></i>
      <span>–°–ø–∏—Å–æ–∫</span>
    </button>
    <button class="view-toggle-btn" data-view="kanban">
      <i class="fas fa-columns"></i>
      <span>Kanban</span>
    </button>
  </div>
</div>

<!-- Kanban –¥–æ—Å–∫–∞ -->
<section class="kanban-board" id="kanban-board" style="display: none;">
  <div class="kanban-header">
    <h2><i class="fas fa-columns"></i> Kanban –¥–æ—Å–∫–∞</h2>
    <div class="kanban-summary">
      <div class="kanban-stats">
        <div class="stat-card active">
          <i class="fas fa-play-circle"></i>
          <span class="stat-value" id="kanban-active-count">0</span>
          <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</span>
        </div>
        <div class="stat-card completed">
          <i class="fas fa-check-circle"></i>
          <span class="stat-value" id="kanban-completed-today">0</span>
          <span class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
        </div>
        <div class="stat-card overdue">
          <i class="fas fa-exclamation-triangle"></i>
          <span class="stat-value" id="kanban-overdue-count">0</span>
          <span class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
        </div>
      </div>
    </div>
  </div>

  <div class="kanban-columns" id="kanban-columns">
    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã JavaScript -->
    <div class="kanban-loading">
      <i class="fas fa-spinner fa-spin"></i>
      <span>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–Ω–æ–∫...</span>
    </div>
  </div>
</section>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á -->
<div class="table-container">
  <div class="table-header">
    <h3 class="table-title">
      <i class="fas fa-tasks"></i>
      –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
    </h3>
  </div>
  <div class="table-wrapper">
    <table id="tasksTable" class="display modern-datatable-redesigned">
      <thead>
        <tr>
          <th data-column="id" class="col-id">
            <div class="th-content">
              <i class="fas fa-hashtag"></i>
              <span>ID</span>
            </div>
          </th>
          <th data-column="easy_email_to" class="col-email">
            <div class="th-content">
              <i class="fas fa-envelope"></i>
              <span>Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</span>
            </div>
          </th>
          <th data-column="subject" class="col-subject">
            <div class="th-content">
              <i class="fas fa-file-text"></i>
              <span>–¢–µ–º–∞ –∑–∞–¥–∞—á–∏</span>
            </div>
          </th>
          <th data-column="status" class="col-status">
            <div class="th-content">
              <i class="fas fa-flag"></i>
              <span>–°—Ç–∞—Ç—É—Å</span>
            </div>
          </th>
          <th data-column="priority" class="col-priority">
            <div class="th-content">
              <i class="fas fa-exclamation-triangle"></i>
              <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
            </div>
          </th>
          <th data-column="created_on" class="col-created">
            <div class="th-content">
              <i class="fas fa-calendar-plus"></i>
              <span>–°–æ–∑–¥–∞–Ω–∞</span>
            </div>
          </th>
          <th data-column="updated_on" class="col-updated">
            <div class="th-content">
              <i class="fas fa-calendar-check"></i>
              <span>–û–±–Ω–æ–≤–ª–µ–Ω–∞</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </tbody>
    </table>
  </div>
</div>

<!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ DataTables -->
<div class="dt-processing" style="display: none;">
  <div class="processing-content">
    <i class="fas fa-rocket fa-bounce"></i>
    <span>üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
  </div>
</div>

<!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
<div class="empty-state" id="empty-state" style="display: none;">
  <i class="fas fa-inbox empty-icon"></i>
  <h3>–ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
  <p>–ü–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
  <button class="btn btn-secondary" id="reset-filters-btn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
</div>

<!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ -->
<div class="error-state" id="error-state" style="display: none;">
  <i class="fas fa-exclamation-triangle error-icon"></i>
  <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
  <p id="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–∏—Å—Ç–µ–º–µ Redmine</p>
  <button class="btn btn-primary" id="retry-btn">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

{% endblock %}

{% block scripts %}
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">

<!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ CSS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/my_tasks_modern_ui.css') }}?v={{ cache_buster or '1' }}&force={{ range(1, 999999) | random }}">
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/tasks_modern_ui.css') }}?v={{ cache_buster or '1' }}&force={{ range(1, 999999) | random }}">
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/status_accordion.css') }}?v={{ cache_buster or '1' }}&force={{ range(1, 999999) | random }}">
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/modern-status-indicators.css') }}?v={{ cache_buster or '1' }}&force={{ range(1, 999999) | random }}">
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/tasks_enhanced.css') }}?v={{ cache_buster or '1' }}&force={{ range(1, 999999) | random }}">
<!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–¥–∏–∑–∞–π–Ω —à–∞–ø–∫–∏ —Ç–∞–±–ª–∏—Ü—ã DataTables -->
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/tasks_table_header_redesign.css') }}?v={{ cache_buster or '1' }}&force={{ range(1, 999999) | random }}">
<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–¥–∞—á -->
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/tasks/tasks.css') }}?v={{ cache_buster or '999' }}&t={{ range(1, 1000000) | random }}&force={{ range(1, 999999) | random }}">

<!-- –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è email-—Å—Å—ã–ª–æ–∫ -->
<style>
  /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ Kanban */
  .kanban-stats {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    flex-direction: row !important;
  }

  .stat-card {
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
    padding: 6px 10px !important;
    background: rgba(255, 255, 255, 0.95) !important;
    border-radius: 6px !important;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
    border: 1px solid rgba(0, 0, 0, 0.05) !important;
    transition: all 0.2s ease !important;
    font-size: 12px !important;
    min-width: auto !important;
    flex-direction: row !important;
  }

  .stat-card i {
    font-size: 14px !important;
    color: #6b7280 !important;
    margin-right: 4px !important;
  }

  .stat-card.active i {
    color: #3b82f6 !important;
  }

  .stat-card.completed i {
    color: #10b981 !important;
  }

  .stat-card.overdue i {
    color: #ef4444 !important;
  }

  .stat-value {
    font-size: 14px !important;
    font-weight: 700 !important;
    color: #1f2937 !important;
    margin: 0 4px !important;
  }

  .stat-label {
    font-size: 11px !important;
    font-weight: 500 !important;
    color: #6b7280 !important;
    text-transform: none !important;
    letter-spacing: 0 !important;
  }

  @media (max-width: 768px) {
    .kanban-stats {
      flex-direction: row !important;
      gap: 6px !important;
      flex-wrap: wrap !important;
    }

    .stat-card {
      padding: 4px 8px !important;
      font-size: 11px !important;
    }

    .stat-value {
      font-size: 12px !important;
    }

    .stat-label {
      font-size: 10px !important;
    }
  }

  /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∞ Kanban */
  .kanban-header {
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #1d4ed8 100%) !important;
    padding: 15px 20px !important;
    border-radius: 8px !important;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3) !important;
  }

  .kanban-header h2 {
    color: #ffffff !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
  }

  .kanban-header h2 i {
    color: #ffffff !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
  }

  /* üé¨ –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
  #loading-message {
    transition: opacity 0.3s ease;
    font-size: 14px;
    color: #6b7280;
    margin: 10px 0;
    min-height: 20px;
  }

  .loading-progress {
    margin-top: 20px;
    width: 100%;
    max-width: 300px;
  }

  .progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 8px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #1d4ed8);
    border-radius: 3px;
    transition: width 0.5s ease;
    width: 0%;
  }

  .progress-text {
    font-size: 12px;
    color: #6b7280;
    font-weight: 500;
  }

  /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
  .spinner-icon i {
    font-size: 2.5rem;
    color: #3b82f6;
    animation: rocket-bounce 2s infinite;
  }

  @keyframes rocket-bounce {

    0%,
    20%,
    50%,
    80%,
    100% {
      transform: translateY(0);
    }

    40% {
      transform: translateY(-10px);
    }

    60% {
      transform: translateY(-5px);
    }
  }

  /* –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Tech-—Å—Ç–∏–ª—å */
  .email-link {
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', monospace;
    font-size: 13px;
    font-weight: 500;
    color: #4f46e5 !important;
    text-decoration: none;
    padding: 4px 8px;
    border-radius: 6px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border: 1px solid #e2e8f0;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-block;
    position: relative;
    letter-spacing: 0.02em;
  }

  /* –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â—É—é—Å—è –∏–∫–æ–Ω–∫—É - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ FontAwesome –∏–∫–æ–Ω–∫—É –∏–∑ HTML */

  .email-link:hover {
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: #ffffff !important;
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 8px 25px rgba(79, 70, 229, 0.15), 0 4px 10px rgba(0, 0, 0, 0.1);
    border-color: #4f46e5;
  }

  .email-link:active {
    transform: translateY(-1px) scale(1.01);
  }

  .email-link:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: #ffffff !important;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è FontAwesome –∏–∫–æ–Ω–∫–∏ –≤ email-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ */
  .email-container {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .email-container .fa-envelope {
    flex-shrink: 0;
    font-size: 14px;
    opacity: 0.8;
    transition: all 0.2s ease;
  }

  .email-container:hover .fa-envelope {
    opacity: 1;
    transform: scale(1.1);
  }

  /* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  .email-link.compact {
    font-family: 'Inter', 'Segoe UI', 'Roboto', sans-serif;
    font-size: 12px;
    font-weight: 600;
    padding: 3px 6px;
    background: #f0f9ff;
    border: 1px solid #0ea5e9;
    color: #0ea5e9 !important;
  }

  .email-link.compact:hover {
    background: #0ea5e9;
    color: #ffffff !important;
  }

  /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π */
  .email-style-selector {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.9);
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-size: 12px;
  }

  .email-style-selector select {
    padding: 4px 8px;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    font-size: 11px;
  }

  /* –í—ã–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
  .dataTables_paginate .paginate_button.active-page {
    background: #22c55e !important;
    /* –∑–µ–ª—ë–Ω—ã–π */
    color: #ffffff !important;
    border: 1px solid #16a34a !important;
  }

  /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ */
  tr.return-selected {
    background: rgba(249, 115, 22, 0.25) !important;
    border-left: 4px solid #f97316 !important;
  }

  /* CSS Variables for Theme Support */
  :root {
    --primary-50: #eef2ff;
    --primary-100: #e0e7ff;
    --primary-200: #c7d2fe;
    --primary-300: #a5b4fc;
    --primary-400: #818cf8;
    --primary-500: #6366f1;
    --primary-600: #4f46e5;
    --primary-700: #4338ca;
    --primary-800: #3730a3;
    --primary-900: #312e81;
    --success: #22c55e;
    --success-bg: rgba(34, 197, 94, 0.15);
    --error: #ef4444;
    --error-bg: rgba(239, 68, 68, 0.15);
    --warning: #f97316;
    --info: #06b6d4;
    --surface-0: #111827;
    --surface-1: #1f2937;
    --surface-2: #374151;
    --surface-3: #4b5563;
    --surface-glass: rgba(31, 41, 55, 0.7);
    --surface-card: rgba(55, 65, 81, 0.6);
    --text-primary: #f9fafb;
    --text-secondary: #e5e7eb;
    --text-muted: #9ca3af;
    --text-disabled: #6b7280;
    --text-on-primary: #ffffff;
    --border-light: #374151;
    --border-medium: #4b5563;
    --border-focus: var(--primary-400);
    --shadow-1: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.4);
    --shadow-2: 0 3px 6px rgba(0, 0, 0, 0.3), 0 3px 6px rgba(0, 0, 0, 0.4);
    --shadow-3: 0 10px 20px rgba(0, 0, 0, 0.3), 0 6px 6px rgba(0, 0, 0, 0.4);
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-xxl: 3rem;
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-xxl: 24px;
    --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Light theme overrides */
  body.light-theme {
    --surface-0: #ffffff;
    --surface-1: #f8fafc;
    --surface-2: #e2e8f0;
    --surface-3: #cbd5e1;
    --surface-glass: rgba(248, 250, 252, 0.8);
    --surface-card: rgba(255, 255, 255, 0.9);
    --text-primary: #0f172a;
    --text-secondary: #334155;
    --text-muted: #64748b;
    --text-disabled: #94a3b8;
    --text-on-primary: #ffffff;
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-focus: var(--primary-500);
    --shadow-1: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    --shadow-2: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
    --shadow-3: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
    --success-bg: rgba(34, 197, 94, 0.1);
    --error-bg: rgba(239, 68, 68, 0.1);

    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É */
    background-color: #ffffff !important;
    color: #0f172a !important;
  }

  body.light-theme .page-header {
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #1d4ed8 100%) !important;
    border-bottom: 1px solid #1e40af !important;
    color: #ffffff !important;
  }

  body.light-theme .page-header .page-title {
    color: #ffffff !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
  }

  body.light-theme .page-header .page-subtitle {
    color: #e0e7ff !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
  }

  body.light-theme .page-header .header-icon {
    background: rgba(255, 255, 255, 0.2) !important;
    color: #ffffff !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  }

  body.light-theme .status-breakdown-dashboard {
    background: #f8fafc !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .status-card {
    background: rgba(255, 255, 255, 0.9) !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .status-card h3 {
    color: #0f172a !important;
  }

  body.light-theme .status-card .card-value {
    color: #3b82f6 !important;
  }

  body.light-theme .status-card .card-description p {
    color: #64748b !important;
  }

  body.light-theme .status-card .detail-label {
    color: #64748b !important;
  }

  body.light-theme .status-card .detail-value {
    color: #0f172a !important;
  }

  body.light-theme .filters-section {
    background: #f8fafc !important;
    border: 1px solid #e2e8f0 !important;
  }

  body.light-theme .filter-label {
    color: #0f172a !important;
  }

  body.light-theme .view-toggle-section {
    background: #f8fafc !important;
    border: 1px solid #e2e8f0 !important;
  }

  body.light-theme .kanban-board {
    background: #f8fafc !important;
    border: 1px solid #e2e8f0 !important;
  }

  body.light-theme .kanban-header h2 {
    color: #ffffff !important;
  }

  body.light-theme .kanban-column {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
  }

  body.light-theme .kanban-column-header {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
    color: #ffffff !important;
  }

  body.light-theme .kanban-card {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
  }

  body.light-theme .kanban-card:hover {
    background: #f8fafc !important;
    border-color: #cbd5e1 !important;
  }

  body.light-theme .kanban-card-id {
    color: #3b82f6 !important;
  }

  body.light-theme .kanban-card-subject {
    color: #0f172a !important;
  }

  body.light-theme .kanban-card-date {
    color: #64748b !important;
  }

  body.light-theme .kanban-card-priority {
    color: #ffffff !important;
  }

  body.light-theme .table-container {
    background: #f8fafc !important;
    border: 1px solid #e2e8f0 !important;
  }

  body.light-theme .table-title {
    color: #0f172a !important;
  }

  /* –ö–Ω–æ–ø–∫–∏ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .action-button {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .action-button:hover {
    background: #f8fafc !important;
    border-color: #cbd5e1 !important;
  }

  body.light-theme .action-button.primary {
    background: #3b82f6 !important;
    color: #ffffff !important;
    border-color: #3b82f6 !important;
  }

  body.light-theme .action-button.primary:hover {
    background: #2563eb !important;
    border-color: #2563eb !important;
  }

  body.light-theme .action-button.secondary {
    background: rgba(255, 255, 255, 0.2) !important;
    color: #ffffff !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
  }

  body.light-theme .action-button.secondary:hover {
    background: rgba(255, 255, 255, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.5) !important;
  }

  /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –≤–∏–¥–æ–≤ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .view-toggle-btn {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .view-toggle-btn:hover {
    background: #f8fafc !important;
    border-color: #cbd5e1 !important;
  }

  body.light-theme .view-toggle-btn.active {
    background: #3b82f6 !important;
    color: #ffffff !important;
    border-color: #3b82f6 !important;
  }

  /* –§–∏–ª—å—Ç—Ä—ã –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .filter-select {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .filter-select:focus {
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }

  /* –ö–Ω–æ–ø–∫–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .toggle-details-btn {
    background: #3b82f6 !important;
    color: #ffffff !important;
    border: 1px solid #3b82f6 !important;
  }

  body.light-theme .toggle-details-btn:hover {
    background: #2563eb !important;
    border-color: #2563eb !important;
  }

  /* –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ */
  body.light-theme .global-toggle-btn {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .global-toggle-btn:hover {
    background: #f8fafc !important;
    border-color: #cbd5e1 !important;
  }

  /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .summary-value {
    color: #3b82f6 !important;
  }

  body.light-theme .summary-label {
    color: #64748b !important;
  }

  ight-theme .summary-label {
    color: #64748b !important;
  }

  /* –ò–∫–æ–Ω–∫–∏ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .card-icon {
    background: #f1f5f9 !important;
    color: #3b82f6 !important;
  }

  body.light-theme .card-icon.total {
    background: #dbeafe !important;
    color: #3b82f6 !important;
  }

  body.light-theme .card-icon.paused {
    background: #fef3c7 !important;
    color: #d97706 !important;
  }

  body.light-theme .card-icon.open {
    background: #d1fae5 !important;
    color: #059669 !important;
  }

  body.light-theme .card-icon.closed {
    background: #e0e7ff !important;
    color: #6366f1 !important;
  }

  /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
  body {
    background-color: var(--surface-0);
    color: var(--text-primary);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  body:not(.light-theme) {
    background-color: #111827 !important;
    color: #f9fafb !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º–Ω—É—é —Ç–µ–º—É –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ JavaScript */
  body {
    background-color: #111827 !important;
    color: #f9fafb !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã –≤ –Ω–∞—á–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ */
  .theme-switcher .theme-icon-light {
    display: block !important;
    color: #fbbf24 !important;
  }

  .theme-switcher .theme-icon-dark {
    display: none !important;
    color: #60a5fa !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
  body.light-theme .theme-switcher .theme-icon-light {
    display: none !important;
    color: #fbbf24 !important;
  }

  body.light-theme .theme-switcher .theme-icon-dark {
    display: block !important;
    color: #ffffff !important;
  }

  body:not(.light-theme) .page-header {
    background: #1f2937;
    border-bottom: 1px solid #374151;
  }

  body:not(.light-theme) .status-breakdown-dashboard {
    background: #1f2937;
    border: 1px solid #374151;
  }

  body:not(.light-theme) .status-card {
    background: rgba(55, 65, 81, 0.6);
    border: 1px solid #374151;
  }

  body:not(.light-theme) .status-card .detail-label {
    font-weight: 500 !important;
    color: #e5e7eb !important;
  }

  body:not(.light-theme) .status-card .detail-value {
    color: #f9fafb !important;
  }

  body:not(.light-theme) .card-details {
    background: rgba(31, 41, 55, 0.8) !important;
    border: 1px solid #4b5563 !important;
    color: #f9fafb !important;
  }

  body:not(.light-theme) .details-content {
    background: rgba(31, 41, 55, 0.9) !important;
    border: 1px solid #4b5563 !important;
    color: #f9fafb !important;
  }

  body:not(.light-theme) .detail-item {
    color: #f9fafb !important;
    border-bottom: 1px solid #4b5563 !important;
  }

  body:not(.light-theme) .detail-item:last-child {
    border-bottom: none !important;
  }

  /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
  body:not(.light-theme) .status-card .card-details {
    background: #1f2937 !important;
    border: 1px solid #4b5563 !important;
    border-radius: 8px !important;
    margin-top: 10px !important;
    padding: 15px !important;
  }

  body:not(.light-theme) .status-card .details-content {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
    border: 1px solid #cbd5e1 !important;
    border-radius: 12px !important;
    padding: 16px !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
  }

  body:not(.light-theme) .status-card .detail-item {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 8px 0 !important;
    color: #f9fafb !important;
    border-bottom: 1px solid #374151 !important;
  }

  body:not(.light-theme) .status-card .detail-item:last-child {
    border-bottom: none !important;
    padding-bottom: 0 !important;
  }



  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
  body:not(.light-theme) .card-details .detail-item .detail-label,
  body:not(.light-theme) .details-content .detail-item .detail-label,
  body:not(.light-theme) .status-card .card-details .detail-label,
  body:not(.light-theme) .status-card .details-content .detail-label {
    color: #ffffff !important;
    font-weight: 600 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
  }

  body:not(.light-theme) .status-card .detail-value {
    font-weight: 600 !important;
    color: #ffffff !important;
    background: linear-gradient(135deg, #1f2937 0%, #374151 100%) !important;
    padding: 6px 12px !important;
    border-radius: 8px !important;
    min-width: 40px !important;
    text-align: center !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
    border: 1px solid #4b5563 !important;
  }

  /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ */
  body:not(.light-theme) .detail-label,
  body:not(.light-theme) .status-card .detail-label,
  body:not(.light-theme) .card-details .detail-label,
  body:not(.light-theme) .details-content .detail-label,
  body:not(.light-theme) .status-card .card-details .detail-label,
  body:not(.light-theme) .status-card .details-content .detail-label,
  body:not(.light-theme) .status-card .card-details .detail-item .detail-label,
  body:not(.light-theme) .status-card .details-content .detail-item .detail-label {
    color: #ffffff !important;
    font-weight: 600 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
    opacity: 1 !important;
    visibility: visible !important;
  }

  body:not(.light-theme) .filters-section {
    background: #1f2937;
    border: 1px solid #374151;
  }

  body:not(.light-theme) .view-toggle-section {
    background: #1f2937;
    border: 1px solid #374151;
  }

  body:not(.light-theme) .kanban-board {
    background: #1f2937;
    border: 1px solid #374151;
  }

  body:not(.light-theme) .kanban-card {
    background: #374151 !important;
    border: 1px solid #4b5563 !important;
    color: #f9fafb !important;
  }

  body:not(.light-theme) .kanban-card:hover {
    background: #4b5563 !important;
    border-color: #6b7280 !important;
  }

  body:not(.light-theme) .kanban-card-id {
    color: #60a5fa !important;
  }

  body:not(.light-theme) .kanban-card-subject {
    color: #f9fafb !important;
  }

  body:not(.light-theme) .kanban-card-date {
    color: #d1d5db !important;
  }

  body:not(.light-theme) .kanban-card-priority {
    color: #ffffff !important;
  }

  body:not(.light-theme) .table-container {
    background: #1f2937;
    border: 1px solid #374151;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  .page-header {
    background: var(--surface-1);
    border-bottom: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .status-breakdown-dashboard {
    background: var(--surface-1);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .status-card {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .status-card:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
  }

  .filters-section {
    background: var(--surface-1);
    border: 1px solid var(--border-light);
  }

  .filter-select {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .filter-select:focus {
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .view-toggle-section {
    background: var(--surface-1);
    border: 1px solid var(--border-light);
  }

  .view-toggle-btn {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .view-toggle-btn:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
  }

  .view-toggle-btn.active {
    background: var(--primary-500);
    color: var(--text-on-primary);
    border-color: var(--primary-500);
  }

  .kanban-board {
    background: var(--surface-1);
    border: 1px solid var(--border-light);
  }

  .kanban-column {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
  }

  .kanban-card {
    background: var(--surface-0);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .kanban-card:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
  }

  .table-container {
    background: var(--surface-1);
    border: 1px solid var(--border-light);
  }

  .table-title {
    color: var(--text-primary);
  }

  /* DataTables —Å—Ç–∏–ª–∏ */
  .modern-datatable-redesigned {
    background: var(--surface-card);
    color: var(--text-primary);
  }

  .modern-datatable-redesigned thead th {
    background: var(--surface-2);
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-light);
  }

  .modern-datatable-redesigned tbody tr {
    background: var(--surface-card);
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-light);
  }

  .modern-datatable-redesigned tbody tr:hover {
    background: var(--surface-2);
  }

  .modern-datatable-redesigned tbody tr:nth-child(even) {
    background: var(--surface-1);
  }

  .modern-datatable-redesigned tbody tr:nth-child(even):hover {
    background: var(--surface-2);
  }

  /* –ö–Ω–æ–ø–∫–∏ */
  .action-button {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .action-button:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
  }

  .action-button.primary {
    background: var(--primary-500);
    color: var(--text-on-primary);
    border-color: var(--primary-500);
  }

  .action-button.primary:hover {
    background: var(--primary-600);
    border-color: var(--primary-600);
  }

  .action-button.secondary {
    background: var(--surface-card);
    color: var(--text-primary);
    border-color: var(--border-light);
  }

  .action-button.secondary:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
  }

  /* –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫ */
  .loading-overlay {
    background: var(--surface-glass);
    color: var(--text-primary);
  }

  .empty-state,
  .error-state {
    background: var(--surface-card);
    color: var(--text-primary);
  }

  .empty-icon,
  .error-icon {
    color: var(--text-muted);
  }

  /* –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .loading-overlay {
    background: rgba(248, 250, 252, 0.8) !important;
    color: #0f172a !important;
  }

  body.light-theme .empty-state,
  body.light-theme .error-state {
    background: #ffffff !important;
    color: #0f172a !important;
  }

  body.light-theme .empty-icon,
  body.light-theme .error-icon {
    color: #64748b !important;
  }

  body.light-theme .empty-state h3,
  body.light-theme .error-state h3 {
    color: #0f172a !important;
  }

  body.light-theme .empty-state p,
  body.light-theme .error-state p {
    color: #64748b !important;
  }

  /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è DataTables */
  .dataTables_wrapper .dataTables_paginate .paginate_button {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button.current {
    background: var(--primary-500);
    color: var(--text-on-primary);
    border-color: var(--primary-500);
  }

  /* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */
  .dataTables_wrapper .dataTables_filter input {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  .dataTables_wrapper .dataTables_length select {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
  }

  /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø–∏—Å—è—Ö */
  .dataTables_wrapper .dataTables_info {
    color: var(--text-muted);
  }

  /* DataTables –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .modern-datatable-redesigned {
    background: #ffffff !important;
    color: #0f172a !important;
  }

  body.light-theme .modern-datatable-redesigned thead th {
    background: #f8fafc !important;
    color: #0f172a !important;
    border-bottom: 1px solid #e2e8f0 !important;
  }

  body.light-theme .modern-datatable-redesigned tbody tr {
    background: #ffffff !important;
    color: #0f172a !important;
    border-bottom: 1px solid #e2e8f0 !important;
  }

  body.light-theme .modern-datatable-redesigned tbody tr:hover {
    background: #f8fafc !important;
  }

  body.light-theme .modern-datatable-redesigned tbody tr:nth-child(even) {
    background: #f8fafc !important;
  }

  body.light-theme .modern-datatable-redesigned tbody tr:nth-child(even):hover {
    background: #f1f5f9 !important;
  }

  /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è DataTables –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .dataTables_wrapper .dataTables_paginate .paginate_button {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background: #f8fafc !important;
    border-color: #cbd5e1 !important;
  }

  body.light-theme .dataTables_wrapper .dataTables_paginate .paginate_button.current {
    background: #3b82f6 !important;
    color: #ffffff !important;
    border-color: #3b82f6 !important;
  }

  /* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ DataTables –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .dataTables_wrapper .dataTables_filter input {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  body.light-theme .dataTables_wrapper .dataTables_length select {
    background: #ffffff !important;
    border: 1px solid #e2e8f0 !important;
    color: #0f172a !important;
  }

  /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø–∏—Å—è—Ö –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .dataTables_wrapper .dataTables_info {
    color: #64748b !important;
  }

  /* Theme Switcher Styles */
  .theme-switcher-container {
    flex-shrink: 0;
    margin-left: var(--spacing-md);
  }

  .theme-switcher {
    background: var(--surface-card);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    padding: var(--spacing-sm);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-normal);
    position: relative;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .theme-switcher:hover {
    background: var(--surface-2);
    border-color: var(--border-medium);
    transform: translateY(-1px);
    box-shadow: var(--shadow-1);
  }

  .theme-switcher:active {
    transform: translateY(0);
  }

  .theme-switcher * {
    pointer-events: none;
  }

  .theme-switcher .theme-icon-light,
  .theme-switcher i.theme-icon-light,
  .theme-switcher .fas.theme-icon-light {
    display: block !important;
    color: #fbbf24 !important;
    opacity: 1 !important;
    visibility: visible !important;
    font-size: 1.1rem;
    transition: all var(--transition-normal);
    position: absolute;
  }

  .theme-switcher .theme-icon-dark,
  .theme-switcher i.theme-icon-dark,
  .theme-switcher .fas.theme-icon-dark {
    display: none !important;
    color: #60a5fa !important;
    font-size: 1.1rem;
    transition: all var(--transition-normal);
    position: absolute;
  }

  /* –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã (–¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è JavaScript) */
  body.light-theme .theme-switcher .theme-icon-light,
  body.light-theme .theme-switcher i.theme-icon-light,
  body.light-theme .theme-switcher .fas.theme-icon-light {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
  }

  body.light-theme .theme-switcher .theme-icon-dark,
  body.light-theme .theme-switcher i.theme-icon-dark,
  body.light-theme .theme-switcher .fas.theme-icon-dark {
    display: block !important;
    color: #ffffff !important;
    opacity: 1 !important;
    visibility: visible !important;
  }

  body.light-theme .theme-switcher {
    background: rgba(255, 255, 255, 0.2) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
  }

  body.light-theme .theme-switcher:hover {
    background: rgba(255, 255, 255, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.5) !important;
  }

  body.light-theme .theme-switcher .theme-icon-light,
  body.light-theme .theme-switcher i.theme-icon-light,
  body.light-theme .theme-switcher .fas.theme-icon-light {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
  }

  body.light-theme .theme-switcher .theme-icon-dark,
  body.light-theme .theme-switcher i.theme-icon-dark,
  body.light-theme .theme-switcher .fas.theme-icon-dark {
    display: block !important;
    color: #ffffff !important;
    opacity: 1 !important;
    visibility: visible !important;
  }

  /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  body.light-theme .theme-switcher-container .theme-switcher {
    background: rgba(255, 255, 255, 0.2) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
  }

  body.light-theme .theme-switcher-container .theme-switcher:hover {
    background: rgba(255, 255, 255, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.5) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
  }

  body.light-theme .theme-switcher-container .theme-switcher * {
    color: #ffffff !important;
  }

  body.light-theme .theme-switcher-container .theme-switcher .fa-moon {
    color: #ffffff !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
  }

  /* –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ù–ê–ó–í–ê–ù–ò–ô –°–¢–ê–¢–£–°–û–í –í –¢–ï–ú–ù–û–ô –¢–ï–ú–ï */
  body:not(.light-theme) .detail-label {
    color: #000000 !important;
    font-weight: 600 !important;
    text-shadow: none !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å—Ç–∏–ª–µ–π */
  body:not(.light-theme) * .detail-label {
    color: #000000 !important;
    font-weight: 600 !important;
    text-shadow: none !important;
  }

  /* –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ï –°–¢–ò–õ–ò */
  body:not(.light-theme) .detail-label,
  body:not(.light-theme) .status-card .detail-label,
  body:not(.light-theme) .card-details .detail-label,
  body:not(.light-theme) .details-content .detail-label,
  body:not(.light-theme) .status-card .card-details .detail-label,
  body:not(.light-theme) .status-card .details-content .detail-label,
  body:not(.light-theme) .status-card .card-details .detail-item .detail-label,
  body:not(.light-theme) .status-card .details-content .detail-item .detail-label,
  body:not(.light-theme) .status-card .card-details .detail-item span.detail-label,
  body:not(.light-theme) .status-card .details-content .detail-item span.detail-label {
    color: #000000 !important;
    font-weight: 700 !important;
    text-shadow: none !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: inline-block !important;
  }
</style>





<!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ jQuery –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ -->
<script>
  if (typeof jQuery === 'undefined') {
    document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"><\/script>');
  }
</script>

<!-- DataTables JS -->
<script type="text/javascript" charset="utf8"
  src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8"
  src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" charset="utf8"
  src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" charset="utf8"
  src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>

<!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ JS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ -->
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/tasks/kanban-tips.css') }}?v={{ cache_buster or '1753017000' }}">
<link rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/tasks/kanban-tooltips.css') }}?v={{ cache_buster or '1753017000' }}">

<script src="{{ url_for('static', filename='js/my_tasks_app.js') }}?v={{ cache_buster or '1753017000' }}"></script>
<script src="{{ url_for('static', filename='js/status_accordion.js') }}?v={{ cache_buster or '1753017000' }}"></script>
<script
  src="{{ url_for('static', filename='js/pages/tasks/components/KanbanOnboarding.js') }}?v={{ cache_buster or '1753017000' }}"></script>
<script
  src="{{ url_for('static', filename='js/pages/tasks/components/KanbanTips.js') }}?v={{ cache_buster or '1753017000' }}"></script>
<script
  src="{{ url_for('static', filename='js/pages/tasks/components/KanbanTooltips.js') }}?v={{ cache_buster or '1753017000' }}"></script>
<script
  src="{{ url_for('static', filename='js/pages/tasks/components/KanbanManager.js') }}?v={{ cache_buster or '1753017000' }}&force={{ range(1, 999999) | random }}"></script>
<script
  src="{{ url_for('static', filename='js/pages/tasks/components/DashboardManager.js') }}?v={{ cache_buster or '1753017000' }}&force={{ range(1, 999999) | random }}"></script>

<!-- Theme Manager -->
<script
  src="{{ url_for('static', filename='js/theme-manager.js') }}?v={{ cache_buster or '1753018000' }}&force={{ range(1, 999999) | random }}"></script>

<script>
  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø–æ–∫–∞–∑–∞ –±–∞–Ω–Ω–µ—Ä–∞ Kanban
  if (typeof window.showKanbanTips === 'undefined') window.showKanbanTips = false;
  // –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
  window.checkKanbanTipsStatus = function () {
    console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê KANBAN –ü–û–î–°–ö–ê–ó–û–ö ===');
    console.log('üîß showKanbanTips:', window.showKanbanTips);
    console.log('üîß kanbanTooltipsDisabled:', window.kanbanTooltipsDisabled);
    console.log('üîß KanbanTooltips –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.KanbanTooltips !== 'undefined');
    console.log('üîß disableAllKanbanTooltips –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.disableAllKanbanTooltips === 'function');
    console.log('üîß enableAllKanbanTooltips –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.enableAllKanbanTooltips === 'function');

    const existingTooltips = document.querySelectorAll('.kanban-tooltip');
    console.log('üîß –ê–∫—Ç–∏–≤–Ω—ã—Ö tooltips –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', existingTooltips.length);

    const banner = document.getElementById('kanban-tips-banner');
    console.log('üîß –ë–∞–Ω–Ω–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', banner ? '–¥–∞' : '–Ω–µ—Ç');

    console.log('=== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
  };

  // –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–ª–∏–∫–æ–≤
  window.checkClickHandlers = function () {
    console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –ö–õ–ò–ö–û–í ===');
    console.log('üîß KanbanManager –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.kanbanManager !== 'undefined');

    if (window.kanbanManager) {
      console.log('üîß KanbanManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', window.kanbanManager.isInitialized);
      console.log('üîß –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:', window.kanbanManager.eventListenersInitialized);
    }

    const kanbanCards = document.querySelectorAll('.kanban-card');
    console.log('üîß –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Kanban –∫–∞—Ä—Ç–æ—á–µ–∫:', kanbanCards.length);

    const kanbanCardIds = document.querySelectorAll('.kanban-card-id');
    console.log('üîß –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ .kanban-card-id:', kanbanCardIds.length);

    console.log('‚ÑπÔ∏è –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–¥–∞—á–∏ (.kanban-card-id)');
    console.log('‚ÑπÔ∏è –ö–ª–∏–∫–∏ –ø–æ –æ—Å—Ç–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è');

    console.log('=== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
  };

  // –£–î–ê–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è saveViewAndOpenTask –±—ã–ª–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∞
  // –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞–¥–∞—á –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ KanbanManager.js

  // üé¨ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
  function initLoadingAnimation() {
    const loadingMessages = [
      "üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Kanban –¥–æ—Å–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redmine API",
      "üìä –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫",
      "üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è—Ö",
      "‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ",
      "üéØ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
      "‚ú® –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –∞–Ω–∏–º–∞—Ü–∏–π"
    ];

    const progressSteps = [15, 30, 45, 60, 80, 95];
    let currentStep = 0;

    const messageElement = document.getElementById('loading-message');
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');

    if (!messageElement || !progressFill || !progressText) return;

    const updateProgress = () => {
      if (currentStep < progressSteps.length) {
        const progress = progressSteps[currentStep];
        const message = loadingMessages[currentStep];

        // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        progressFill.style.width = progress + '%';
        progressText.textContent = progress + '%';

        // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        messageElement.style.opacity = '0';
        setTimeout(() => {
          messageElement.textContent = message;
          messageElement.style.opacity = '1';
        }, 200);

        currentStep++;

        if (currentStep < progressSteps.length) {
          setTimeout(updateProgress, 800);
        }
      }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(updateProgress, 500);
  }

  // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  function initializeMyTasksPage() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ú–æ–∏ –∑–∞–¥–∞—á–∏"');

    if (typeof $ === 'undefined') {
      console.error('‚ùå jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
      showError('jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      return;
    }

    if (typeof $.fn.DataTable === 'undefined') {
      console.error('‚ùå DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
      showError('DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      return;
    }

    if (typeof MyTasksApp === 'undefined') {
      console.error('‚ùå MyTasksApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
      showError('MyTasksApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
      return;
    }

    // –û—á–∏—â–∞–µ–º sessionStorage —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—Ç –æ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ URL –ø–∞—Ä–∞–º–µ—Ç—Ä, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç
    const urlParams = new URLSearchParams(window.location.search);
    const isReturnFromTask = urlParams.has('return') || document.referrer.includes('/tasks/');

    if (!isReturnFromTask) {
      // –≠—Ç–æ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ - –æ—á–∏—â–∞–µ–º sessionStorage
      sessionStorage.removeItem('return_from_task_id');
      sessionStorage.removeItem('return_from_task_page');
      console.log('üßπ –û—á–∏—â–µ–Ω sessionStorage (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)');
    } else {
      console.log('üîÑ –í–æ–∑–≤—Ä–∞—Ç –æ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º sessionStorage –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏');
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
    initLoadingAnimation();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    MyTasksApp.init();
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
  function showError(message) {
    if (typeof showNotification === 'function') {
      showNotification(message, 'error');
    } else {
      alert(message);
    }
  }

  $(document).ready(function () {
    console.log('üìÑ DOM –≥–æ—Ç–æ–≤');

    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    setTimeout(function () {
      initializeMyTasksPage();
    }, 100);
  });

  // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ThemeManager —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('themeChanged', function (event) {
    const theme = event.detail.theme;
    console.log(`üé® –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${theme}`);

    // –û–±–Ω–æ–≤–ª—è–µ–º DataTables –µ—Å–ª–∏ –æ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    if (typeof $.fn.DataTable !== 'undefined' && $('#tasksTable').length && $('#tasksTable').hasClass('dataTable')) {
      try {
        $('#tasksTable').DataTable().draw();
      } catch (e) {
        console.log('DataTables –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
      }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º Kanban –¥–æ—Å–∫—É –µ—Å–ª–∏ –æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
    if (window.kanbanManager && window.kanbanManager.isInitialized) {
      try {
        window.kanbanManager.refreshKanbanBoard();
      } catch (e) {
        console.log('Kanban –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
      }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—à–±–æ—Ä–¥ –µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω
    if (window.dashboardManager && window.dashboardManager.isInitialized) {
      try {
        window.dashboardManager.refreshDashboard();
      } catch (e) {
        console.log('Dashboard –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
      }
    }
  });

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö)
  window.getCurrentTheme = function () {
    return window.themeManager ? window.themeManager.getCurrentTheme() : 'light';
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º—ã (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö)
  window.setTheme = function (theme) {
    if (window.themeManager) {
      window.themeManager.setTheme(theme);
    }
  };
</script>


{% endblock %}
