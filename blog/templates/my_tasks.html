{% extends "layout.html" %}

{% block content %}
<!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loading-spinner" class="loading-overlay">
    <div class="loading-content">
        <div class="spinner-icon">
            <i class="fas fa-rocket fa-bounce"></i>
        </div>
        <h3>üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏...</h3>
        <p id="loading-message">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Kanban –¥–æ—Å–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redmine API</p>
        <div class="loading-progress">
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <span class="progress-text">0%</span>
        </div>
    </div>
</div>


<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<header class="page-header" data-kanban-tips="{% if show_kanban_tips | default(false) %}true{% else %}false{% endif %}">
    <div class="header-content">
        <div class="header-main">
            <div class="header-icon">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="header-text">
                <h1 class="page-title">–ú–æ–∏ –∑–∞–¥–∞—á–∏ –≤ Redmine</h1>
                <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–∏—Ö –∑–∞–¥–∞—á –≤ Redmine</p>
            </div>
        </div>
        <div class="header-actions">
            <a href="https://helpdesk.teztour.com" class="action-button secondary" target="_blank" rel="noopener">
                <i class="fas fa-external-link-alt"></i>
                <span>–ü–µ—Ä–µ–π—Ç–∏ –≤ Redmine</span>
            </a>
            <a href="{{ url_for('main.my_issues') }}" class="action-button primary">
                <i class="fas fa-ticket-alt"></i>
                <span>–ú–æ–∏ –∑–∞—è–≤–∫–∏</span>
            </a>
        </div>
    </div>
</header>

<!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (Status Breakdown Dashboard) -->
<section class="status-breakdown-dashboard">
    <div class="breakdown-header">
        <div class="breakdown-title">
            <i class="fas fa-tachometer-alt"></i>
            <h2>–î–∞—à–±–æ—Ä–¥ –∑–∞–¥–∞—á</h2>
        </div>
        <div class="breakdown-summary">
            <span class="summary-value" id="total-tasks-summary">-</span>
            <span class="summary-label">–≤—Å–µ–≥–æ –∑–∞–¥–∞—á</span>
            <button class="global-toggle-btn" id="globalToggleBtn">
                <i class="fas fa-expand-alt"></i>
                <span>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</span>
            </button>
        </div>
    </div>

    <div class="status-breakdown-grid">
        <!-- –í—Å–µ–≥–æ –∑–∞–¥–∞—á -->
        <div class="status-card" data-type="total">
            <div class="card-header">
                <div class="card-icon total">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="card-title">
                    <h3>–í—Å–µ–≥–æ –∑–∞–¥–∞—á</h3>
                    <span class="card-value" id="total-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</p>
            </div>
            <button class="toggle-details-btn" data-target="total-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="total-details" style="display: none;">
                <div class="details-content" id="total-details-content">
                    <div class="detail-item">
                        <span class="detail-label">–û—Ç–∫—Ä—ã—Ç—ã–µ:</span>
                        <span class="detail-value" id="total-open">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">–í —Ä–∞–±–æ—Ç–µ:</span>
                        <span class="detail-value" id="total-in-progress">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ:</span>
                        <span class="detail-value" id="total-completed">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í —Ä–∞–±–æ—Ç–µ -->
        <div class="status-card" data-type="in-progress">
            <div class="card-header">
                <div class="card-icon paused">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="card-title">
                    <h3>–í —Ä–∞–±–æ—Ç–µ</h3>
                    <span class="card-value" id="in-progress-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</p>
            </div>
            <button class="toggle-details-btn" data-target="in-progress-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="in-progress-details" style="display: none;">
                <div class="details-content" id="in-progress-details-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </div>
            </div>
        </div>

        <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏ -->
        <div class="status-card" data-type="open">
            <div class="card-header">
                <div class="card-icon open">
                    <i class="fas fa-folder-open"></i>
                </div>
                <div class="card-title">
                    <h3>–û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</h3>
                    <span class="card-value" id="open-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–ù–æ–≤—ã–µ –∏ –æ–∂–∏–¥–∞—é—â–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</p>
            </div>
            <button class="toggle-details-btn" data-target="open-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="open-details" style="display: none;">
                <div class="details-content" id="open-details-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </div>
            </div>
        </div>

        <!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
        <div class="status-card" data-type="completed">
            <div class="card-header">
                <div class="card-icon closed">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="card-title">
                    <h3>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</h3>
                    <span class="card-value" id="completed-tasks">-</span>
                </div>
            </div>
            <div class="card-description">
                <p>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏</p>
            </div>
            <button class="toggle-details-btn" data-target="completed-details">
                <i class="fas fa-chevron-down"></i>
                <span>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</span>
            </button>
            <div class="card-details" id="completed-details" style="display: none;">
                <div class="details-content" id="completed-details-content">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div class="filters-section">
    <div class="filter-container">
        <label class="filter-label" for="status-filter">–°—Ç–∞—Ç—É—Å:</label>
        <select id="status-filter" class="filter-select" name="status" title="–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        </select>
        <button class="clear-filter-btn" id="clear-status-filter" style="display: none;" type="button" aria-label="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="filter-container">
        <label class="filter-label" for="project-filter">–ü—Ä–æ–µ–∫—Ç:</label>
        <select id="project-filter" class="filter-select" name="project" title="–§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ–µ–∫—Ç—É">
            <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
        </select>
        <button class="clear-filter-btn" id="clear-project-filter" style="display: none;" type="button" aria-label="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø—Ä–æ–µ–∫—Ç–∞">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="filter-container">
        <label class="filter-label" for="priority-filter">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
        <select id="priority-filter" class="filter-select" name="priority" title="–§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É">
            <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
        </select>
        <button class="clear-filter-btn" id="clear-priority-filter" style="display: none;" type="button" aria-label="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–æ–≤ -->
<div class="view-toggle-section">
    <div class="view-toggle-container">
        <button class="view-toggle-btn active" data-view="list">
            <i class="fas fa-list"></i>
            <span>–°–ø–∏—Å–æ–∫</span>
        </button>
        <button class="view-toggle-btn" data-view="kanban">
            <i class="fas fa-columns"></i>
            <span>Kanban</span>
        </button>
    </div>
</div>

<!-- Kanban –¥–æ—Å–∫–∞ -->
<section class="kanban-board" id="kanban-board" style="display: none;">
    <div class="kanban-header">
        <h2><i class="fas fa-columns"></i> Kanban –¥–æ—Å–∫–∞</h2>
        <div class="kanban-summary">
            <div class="kanban-stats">
                <div class="stat-card active">
                    <i class="fas fa-play-circle"></i>
                    <span class="stat-value" id="kanban-active-count">0</span>
                    <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</span>
                </div>
                <div class="stat-card completed">
                    <i class="fas fa-check-circle"></i>
                    <span class="stat-value" id="kanban-completed-today">0</span>
                    <span class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                </div>
                <div class="stat-card overdue">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span class="stat-value" id="kanban-overdue-count">0</span>
                    <span class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                </div>
            </div>
        </div>
    </div>

    <div class="kanban-columns" id="kanban-columns">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã JavaScript -->
        <div class="kanban-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <span>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–Ω–æ–∫...</span>
        </div>
    </div>
</section>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á -->
<div class="table-container">
    <div class="table-header">
        <h3 class="table-title">
            <i class="fas fa-tasks"></i>
            –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
        </h3>
    </div>
    <div class="table-wrapper">
        <table id="tasksTable" class="display modern-datatable-redesigned">
            <thead>
                <tr>
                    <th data-column="id" class="col-id">
                        <div class="th-content">
                            <span>ID</span>
                        </div>
                    </th>
                    <th data-column="easy_email_to" class="col-email">
                        <div class="th-content">
                            <span>Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</span>
                        </div>
                    </th>
                    <th data-column="subject" class="col-subject">
                        <div class="th-content">
                            <span>–¢–µ–º–∞ –∑–∞–¥–∞—á–∏</span>
                        </div>
                    </th>
                    <th data-column="status" class="col-status">
                        <div class="th-content">
                            <span>–°—Ç–∞—Ç—É—Å</span>
                        </div>
                    </th>
                    <th data-column="priority" class="col-priority">
                        <div class="th-content">
                            <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                        </div>
                    </th>
                    <th data-column="created_on" class="col-created">
                        <div class="th-content">
                            <span>–°–æ–∑–¥–∞–Ω–∞</span>
                        </div>
                    </th>
                    <th data-column="updated_on" class="col-updated">
                        <div class="th-content">
                            <span>–û–±–Ω–æ–≤–ª–µ–Ω–∞</span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </tbody>
        </table>
    </div>
</div>

<!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ DataTables -->
<div class="dt-processing" style="display: none;">
    <div class="processing-content">
        <i class="fas fa-rocket fa-bounce"></i>
        <span>üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
    </div>
</div>

<!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
<div class="empty-state" id="empty-state" style="display: none;">
    <i class="fas fa-inbox empty-icon"></i>
    <h3>–ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
    <p>–ü–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    <button class="btn btn-secondary" id="reset-filters-btn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
</div>

<!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ -->
<div class="error-state" id="error-state" style="display: none;">
    <i class="fas fa-exclamation-triangle error-icon"></i>
    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
    <p id="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–∏—Å—Ç–µ–º–µ Redmine</p>
    <button class="btn btn-primary" id="retry-btn">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

{% endblock %}

{% block styles %}
<!-- DataTables CSS (–ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã) -->
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dataTables.bootstrap4.min.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/responsive.bootstrap4.min.css') }}">

<!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ CSS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/my_tasks_modern_ui.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_modern_ui.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/status_accordion.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern-status-indicators.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_enhanced.css') }}?v={{ cache_buster or '1' }}">
<!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–¥–∏–∑–∞–π–Ω —à–∞–ø–∫–∏ —Ç–∞–±–ª–∏—Ü—ã DataTables -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/tasks_table_header_redesign.css') }}?v={{ cache_buster or '1' }}">
<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–¥–∞—á -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/tasks/tasks.css') }}?v={{ cache_buster or '1' }}">

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≤—ã–Ω–µ—Å–µ–Ω—ã –∏–∑ inline –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è) -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/tasks/my_tasks_page_overrides.css') }}?v={{ cache_buster or '1' }}">
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/tasks/kanban-tips.css') }}?v={{ cache_buster or '1' }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/tasks/kanban-tooltips.css') }}?v={{ cache_buster or '1' }}">
{% endblock %}

{% block scripts %}
<!-- DataTables JS (–ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã) -->
<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/dataTables.bootstrap4.min.js') }}"></script>
<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/responsive.bootstrap4.min.js') }}"></script>

<!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ JS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<script defer src="{{ url_for('static', filename='js/my_tasks_app.js') }}?v={{ cache_buster or '1' }}"></script>
<script defer src="{{ url_for('static', filename='js/status_accordion.js') }}?v={{ cache_buster or '1' }}"></script>
<script defer src="{{ url_for('static', filename='js/pages/tasks/components/KanbanOnboarding.js') }}?v={{ cache_buster or '1' }}"></script>
<script defer src="{{ url_for('static', filename='js/pages/tasks/components/KanbanTips.js') }}?v={{ cache_buster or '1' }}"></script>
<script defer src="{{ url_for('static', filename='js/pages/tasks/components/KanbanTooltips.js') }}?v={{ cache_buster or '1' }}"></script>
<script defer src="{{ url_for('static', filename='js/pages/tasks/components/KanbanManager.js') }}?v={{ cache_buster or '1' }}"></script>
<script defer src="{{ url_for('static', filename='js/pages/tasks/components/DashboardManager.js') }}?v={{ cache_buster or '1' }}"></script>

<script type="text/javascript">
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø–æ–∫–∞–∑–∞ –±–∞–Ω–Ω–µ—Ä–∞ Kanban
(function() {
    'use strict';
    window.__TASKS_DEBUG__ = false;
    const __inlineTasksDebugLog = (...args) => { if (window.__TASKS_DEBUG__) console.log(...args); };
    const pageHeader = document.querySelector('.page-header');
    const tipsValue = pageHeader ? pageHeader.getAttribute('data-kanban-tips') : 'false';
    window.showKanbanTips = tipsValue === 'true';
})();

// –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
window.checkKanbanTipsStatus = function() {
    __inlineTasksDebugLog('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê KANBAN –ü–û–î–°–ö–ê–ó–û–ö ===');
    __inlineTasksDebugLog('üîß showKanbanTips:', window.showKanbanTips);
    __inlineTasksDebugLog('üîß kanbanTooltipsDisabled:', window.kanbanTooltipsDisabled);
    __inlineTasksDebugLog('üîß KanbanTooltips –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.KanbanTooltips !== 'undefined');
    __inlineTasksDebugLog('üîß disableAllKanbanTooltips –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.disableAllKanbanTooltips === 'function');
    __inlineTasksDebugLog('üîß enableAllKanbanTooltips –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.enableAllKanbanTooltips === 'function');

    const existingTooltips = document.querySelectorAll('.kanban-tooltip');
    __inlineTasksDebugLog('üîß –ê–∫—Ç–∏–≤–Ω—ã—Ö tooltips –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', existingTooltips.length);

    const banner = document.getElementById('kanban-tips-banner');
    __inlineTasksDebugLog('üîß –ë–∞–Ω–Ω–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:', banner ? '–¥–∞' : '–Ω–µ—Ç');

    __inlineTasksDebugLog('=== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
};

//
// –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–ª–∏–∫–æ–≤
//
window.checkClickHandlers = function() {
    __inlineTasksDebugLog('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –ö–õ–ò–ö–û–í ===');

    __inlineTasksDebugLog('üîß KanbanManager –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof window.kanbanManager !== 'undefined');

    if (window.kanbanManager) {
        __inlineTasksDebugLog('üîß KanbanManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', window.kanbanManager.isInitialized);
        __inlineTasksDebugLog('üîß –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:', window.kanbanManager.eventListenersInitialized);
    }

    const kanbanCards = document.querySelectorAll('.kanban-card');
    __inlineTasksDebugLog('üîß –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Kanban –∫–∞—Ä—Ç–æ—á–µ–∫:', kanbanCards.length);

    const kanbanCardIds = document.querySelectorAll('.kanban-card-id');
    __inlineTasksDebugLog('üîß –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ .kanban-card-id:', kanbanCardIds.length);

    __inlineTasksDebugLog('‚ÑπÔ∏è –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–¥–∞—á–∏ (.kanban-card-id)');
    __inlineTasksDebugLog('‚ÑπÔ∏è –ö–ª–∏–∫–∏ –ø–æ –æ—Å—Ç–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è');

    __inlineTasksDebugLog('=== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
};


// üé¨ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
function initLoadingAnimation() {
    const loadingMessages = [
        "üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Kanban –¥–æ—Å–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redmine API",
        "üìä –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫",
        "üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è—Ö",
        "‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "üéØ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
        "‚ú® –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –∞–Ω–∏–º–∞—Ü–∏–π"
    ];

    const progressSteps = [15, 30, 45, 60, 80, 95];
    let currentStep = 0;

    const messageElement = document.getElementById('loading-message');
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');

    if (!messageElement || !progressFill || !progressText) return;

    const updateProgress = () => {
        if (currentStep < progressSteps.length) {
            const progress = progressSteps[currentStep];
            const message = loadingMessages[currentStep];

            // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            progressFill.style.width = progress + '%';
            progressText.textContent = progress + '%';

            // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            messageElement.style.opacity = '0';
            setTimeout(() => {
                messageElement.textContent = message;
                messageElement.style.opacity = '1';
            }, 200);

            currentStep++;

            if (currentStep < progressSteps.length) {
                setTimeout(updateProgress, 800);
            }
        }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(updateProgress, 500);
}

// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
function initializeMyTasksPage() {
    __inlineTasksDebugLog('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ú–æ–∏ –∑–∞–¥–∞—á–∏"');

    if (typeof $ === 'undefined' && typeof jQuery === 'undefined') {
        console.error('‚ùå jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        showError('jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        return;
    }

    if (typeof $ === 'undefined') {
        // –ï—Å–ª–∏ jQuery –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–æ $ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º jQuery
        window.$ = window.jQuery;
        __inlineTasksDebugLog('üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º jQuery –≤–º–µ—Å—Ç–æ $');
    }

    if (typeof $.fn.DataTable === 'undefined') {
        console.error('‚ùå DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        showError('DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        return;
    }

    if (typeof MyTasksApp === 'undefined') {
        console.error('‚ùå MyTasksApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        showError('MyTasksApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        return;
    }

    // –û—á–∏—â–∞–µ–º sessionStorage —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—Ç –æ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ URL –ø–∞—Ä–∞–º–µ—Ç—Ä, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç
    const urlParams = new URLSearchParams(window.location.search);
    const isReturnFromTask = urlParams.has('return') || document.referrer.includes('/tasks/');

    if (!isReturnFromTask) {
        // –≠—Ç–æ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ - –æ—á–∏—â–∞–µ–º sessionStorage
        sessionStorage.removeItem('return_from_task_id');
        sessionStorage.removeItem('return_from_task_page');
        __inlineTasksDebugLog('üßπ –û—á–∏—â–µ–Ω sessionStorage (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)');
    } else {
        __inlineTasksDebugLog('üîÑ –í–æ–∑–≤—Ä–∞—Ç –æ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º sessionStorage –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏');
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
    initLoadingAnimation();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    MyTasksApp.init();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
function showError(message) {
    if (typeof showNotification === 'function') {
        showNotification(message, 'error');
    } else {
        alert(message);
    }
}

$(document).ready(function() {
    __inlineTasksDebugLog('üìÑ DOM –≥–æ—Ç–æ–≤');

    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    setTimeout(function() {
        initializeMyTasksPage();
    }, 100);
});
</script>

{% endblock %}


