{% extends 'layout.html' %}
{% block content %}

<div class="users-page-wrapper">
    <!-- Background Elements -->
    <div class="background-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <div class="container users-container">
        <!-- Header Section -->
        <div class="page-header">
            <div class="header-content">
                <div class="title-section">
                    <div class="icon-wrapper">
                        <i class="fas fa-users"></i>
                        <div class="icon-glow"></div>
                    </div>
                    <div class="title-content">
                        <h1 class="page-title">Пользователи системы</h1>
                        <p class="page-subtitle">Управление учетными записями TEZ Navigator</p>
                    </div>
                    <div class="user-count-container">
                        <div class="count-badge">
                            <span class="count-number">{{ users|length }}</span>
                            <span class="count-label">пользователей</span>
                        </div>
                    </div>
                </div>

                <!-- Search Section -->
                <div class="search-section">
                    <div class="search-container">
                        <div class="search-input-group">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text"
                                   id="search-input"
                                   class="search-input"
                                   placeholder="Поиск по имени, email, ФИО...">
                            <button type="button" id="clear-search-btn" class="clear-search-btn">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="search-focus-line"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Grid -->
        <div class="users-grid" id="user-cards-container">
            {% if users %}
                {% for user in users %}
                <div class="user-card-wrapper">
                    <div class="user-card">
                        <!-- Online Status Indicator -->
                        {% if user.online %}
                            <div class="online-status">
                                <div class="online-dot"></div>
                                <span class="online-text">Online</span>
                            </div>
                        {% endif %}

                        <!-- User Avatar -->
                        <div class="user-avatar-section">
                            <div class="avatar-container">
                                {% if user.image_file and user.image_file != 'default.jpg' %}
                                    <img src="{{ url_for('static', filename='profile_pics/' + user.username + '/account_img/' + user.image_file) }}"
                                         alt="{{ user.username }}"
                                         class="user-avatar"
                                         loading="lazy"
                                         decoding="async"
                                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='profile_pics/default.jpg') }}'; this.classList.add('avatar-error');">
                                {% else %}
                                    <img src="{{ url_for('static', filename='profile_pics/default.jpg') }}"
                                         alt="{{ user.username }}"
                                         class="user-avatar"
                                         loading="lazy"
                                         decoding="async">
                                {% endif %}
                                <div class="avatar-overlay">
                                    <i class="fas fa-eye"></i>
                                </div>
                            </div>
                        </div>

                        <!-- User Info -->
                        <div class="user-info">
                            <div class="user-name-section">
                                <h3 class="user-name">{{ user.username }}</h3>
                                <a href="mailto:{{ user.email }}" class="user-email" title="Написать письмо">
                                    <i class="fas fa-envelope"></i>
                                    {{ user.email }}
                                </a>
                            </div>

                            <div class="user-details">
                                {% if user.full_name %}
                                    <div class="detail-item" data-search-fio="{{ user.full_name }}">
                                        <div class="detail-icon">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="detail-content">
                                            <span class="detail-label">ФИО</span>
                                            <span class="detail-value">{{ user.full_name }}</span>
                                        </div>
                                    </div>
                                {% endif %}

                                {% if user.position %}
                                    <div class="detail-item">
                                        <div class="detail-icon">
                                            <i class="fas fa-briefcase"></i>
                                        </div>
                                        <div class="detail-content">
                                            <span class="detail-label">Должность</span>
                                            <span class="detail-value">{{ user.position }}</span>
                                        </div>
                                    </div>
                                {% endif %}

                                {% if user.department %}
                                    <div class="detail-item">
                                        <div class="detail-icon">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div class="detail-content">
                                            <span class="detail-label">Отдел</span>
                                            <span class="detail-value">{{ user.department }}</span>
                                        </div>
                                    </div>
                                {% endif %}

                                {% if user.office %}
                                    <div class="detail-item">
                                        <div class="detail-icon">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div class="detail-content">
                                            <span class="detail-label">Офис</span>
                                            <span class="detail-value">{{ user.office }}</span>
                                        </div>
                                    </div>
                                {% endif %}

                                {% if user.phone %}
                                    <div class="detail-item">
                                        <div class="detail-icon">
                                            <i class="fas fa-phone"></i>
                                        </div>
                                        <div class="detail-content">
                                            <span class="detail-label">Телефон</span>
                                            <span class="detail-value">{{ user.phone }}</span>
                                        </div>
                                    </div>
                                {% endif %}

                                {% if user.last_seen %}
                                    <div class="detail-item">
                                        <div class="detail-icon">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div class="detail-content">
                                            <span class="detail-label">Последний вход</span>
                                            <span class="detail-value">{{ user.last_seen.strftime('%d.%m.%Y %H:%M') }}</span>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="user-actions">
                            <a href="{{ url_for('users.user_profile', user_id=user.id) }}"
                               class="profile-btn">
                                <span class="btn-content">
                                    <i class="fas fa-eye"></i>
                                    <span>Просмотр профиля</span>
                                </span>
                                <div class="btn-ripple"></div>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-users-message">
                    <div class="no-users-icon">
                        <i class="fas fa-users-slash"></i>
                    </div>
                    <h3>Пользователи не найдены</h3>
                    <p>В системе пока нет зарегистрированных пользователей</p>
                </div>
            {% endif %}
        </div>

        <!-- No Results Message -->
        <div id="no-results-message" class="no-results-message" style="display: none;">
            <div class="no-results-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3>Ничего не найдено</h3>
            <p>По вашему запросу пользователи не найдены</p>
            <button type="button" class="clear-filters-btn" onclick="clearSearch()">
                <i class="fas fa-undo"></i>
                Сбросить фильтры
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block styles %}
<style>
    /* Import Modern Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;600&display=swap');

    /* CSS Custom Properties - только для страницы users */
    .users-page-wrapper {
        /* TEZ TOUR Brand Colors */
        --primary-50: #e0f7fa;
        --primary-100: #b2ebf2;
        --primary-200: #80deea;
        --primary-300: #4dd0e1;
        --primary-400: #26c6da;
        --primary-500: #00798C;
        --primary-600: #00696a;
        --primary-700: #005f73;
        --primary-800: #003440;
        --primary-900: #001f26;

        /* Status Colors */
        --success: #10b981;
        --success-bg: #ecfdf5;
        --error: #ef4444;
        --error-bg: #fef2f2;
        --warning: #f59e0b;
        --info: #3b82f6;
        --online: #22c55e;

        /* Surface Colors */
        --surface-0: #ffffff;
        --surface-1: #f8fafc;
        --surface-2: #f1f5f9;
        --surface-3: #e2e8f0;
        --surface-glass: rgba(255, 255, 255, 0.95);
        --surface-card: rgba(255, 255, 255, 0.9);

        /* Text Colors */
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --text-muted: #64748b;
        --text-disabled: #94a3b8;
        --text-on-primary: #ffffff;

        /* Border & Effects */
        --border-light: #e2e8f0;
        --border-medium: #cbd5e1;
        --border-focus: var(--primary-500);

        /* Shadows */
        --shadow-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        --shadow-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
        --shadow-3: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
        --shadow-card: 0 8px 25px rgba(0, 121, 140, 0.08);
        --shadow-header: 0 4px 20px rgba(0, 121, 140, 0.1);

        /* Spacing */
        --spacing-xs: 0.25rem;
        --spacing-sm: 0.5rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-xxl: 3rem;

        /* Border Radius */
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --radius-xxl: 24px;

        /* Transitions */
        --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);

        /* Typography */
        --font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --font-family-mono: 'JetBrains Mono', 'Courier New', monospace;

        /* Base Styles */
        font-family: var(--font-family-primary);
        background: linear-gradient(135deg, var(--surface-1) 0%, var(--surface-2) 100%);
        min-height: 100vh;
        padding: var(--spacing-xl) 0;
        position: relative;
        overflow: hidden;
    }

    /* Background Shapes */
    .users-page-wrapper .background-shapes {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
    }

    .users-page-wrapper .shape {
        position: absolute;
        background: rgba(0, 121, 140, 0.05);
        border-radius: 50%;
        animation: float 12s ease-in-out infinite;
    }

    .users-page-wrapper .shape-1 {
        width: 300px;
        height: 300px;
        top: 10%;
        left: -5%;
        animation-delay: 0s;
    }

    .users-page-wrapper .shape-2 {
        width: 200px;
        height: 200px;
        top: 60%;
        right: -3%;
        animation-delay: 4s;
    }

    .users-page-wrapper .shape-3 {
        width: 150px;
        height: 150px;
        bottom: 20%;
        left: 15%;
        animation-delay: 8s;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        33% { transform: translateY(-30px) rotate(5deg); }
        66% { transform: translateY(15px) rotate(-5deg); }
    }

    /* Container */
    .users-page-wrapper .users-container {
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
        padding: 0 var(--spacing-lg);
    }

    /* Page Header */
    .users-page-wrapper .page-header {
        background: var(--surface-glass);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-xxl);
        box-shadow: var(--shadow-header);
        padding: var(--spacing-lg) var(--spacing-xl);
        margin-bottom: var(--spacing-xl);
        position: sticky;
        top: 90px;
        z-index: 100;
        animation: slideDown 0.8s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .users-page-wrapper .header-content {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    /* Title Section */
    .users-page-wrapper .title-section {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex-wrap: wrap;
    }

    .users-page-wrapper .icon-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, var(--primary-500), var(--primary-400));
        border-radius: var(--radius-xl);
        color: var(--text-on-primary);
        font-size: 1.75rem;
        box-shadow: var(--shadow-2);
        z-index: 2;
    }

    .users-page-wrapper .icon-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 130%;
        height: 130%;
        background: radial-gradient(circle, rgba(0, 121, 140, 0.3) 0%, transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: pulse 3s ease-in-out infinite;
        z-index: 1;
    }

    @keyframes pulse {
        0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
        50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    }

    .users-page-wrapper .title-content {
        flex: 1;
    }

    .users-page-wrapper .page-title {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: var(--spacing-xs);
        letter-spacing: -0.025em;
        line-height: 1.2;
    }

    .users-page-wrapper .page-subtitle {
        font-size: 1.125rem;
        color: var(--text-secondary);
        margin: 0;
        font-weight: 400;
    }

    .users-page-wrapper .user-count-container {
        display: flex;
        align-items: center;
        margin-left: auto;
    }

    .users-page-wrapper .count-badge {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: var(--spacing-md) var(--spacing-lg);
        background: linear-gradient(135deg, var(--success), #059669);
        border-radius: var(--radius-lg);
        color: var(--text-on-primary);
        box-shadow: var(--shadow-1);
        min-width: 80px;
    }

    .users-page-wrapper .count-number {
        font-size: 1.5rem;
        font-weight: 800;
        line-height: 1;
    }

    .users-page-wrapper .count-label {
        font-size: 0.75rem;
        font-weight: 500;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Search Section */
    .users-page-wrapper .search-section {
        width: 100%;
    }

    .users-page-wrapper .search-container {
        max-width: 600px;
        margin: 0 auto;
    }

    .users-page-wrapper .search-input-group {
        position: relative;
        display: flex;
        align-items: center;
        background: var(--surface-0);
        border: 2px solid var(--border-light);
        border-radius: var(--radius-xl);
        padding: var(--spacing-sm);
        transition: all var(--transition-normal);
        box-shadow: var(--shadow-1);
    }

    .users-page-wrapper .search-input-group:focus-within {
        border-color: var(--primary-500);
        box-shadow: 0 0 0 4px rgba(0, 121, 140, 0.1);
    }

    .users-page-wrapper .search-icon {
        color: var(--text-muted);
        font-size: 1.125rem;
        margin: 0 var(--spacing-md);
        transition: color var(--transition-normal);
    }

    .users-page-wrapper .search-input-group:focus-within .search-icon {
        color: var(--primary-500);
    }

    .users-page-wrapper .search-input {
        flex: 1;
        border: none;
        outline: none;
        background: transparent;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        padding: var(--spacing-md) 0;
        font-family: var(--font-family-primary);
    }

    .users-page-wrapper .search-input::placeholder {
        color: var(--text-muted);
        font-weight: 400;
    }

    .users-page-wrapper .clear-search-btn {
        display: none;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        background: var(--surface-2);
        border: none;
        border-radius: 50%;
        color: var(--text-muted);
        cursor: pointer;
        transition: all var(--transition-normal);
        margin-right: var(--spacing-sm);
    }

    .users-page-wrapper .clear-search-btn:hover {
        background: var(--error-bg);
        color: var(--error);
        transform: scale(1.1);
    }

    .users-page-wrapper .search-focus-line {
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--primary-500), var(--primary-400));
        border-radius: 1px;
        transition: all var(--transition-normal);
        transform: translateX(-50%);
    }

    .users-page-wrapper .search-input-group:focus-within .search-focus-line {
        width: 100%;
    }

    /* Users Grid */
    .users-page-wrapper .users-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--spacing-lg);
        margin-top: var(--spacing-xl);
        animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* User Card Animations */
    .users-page-wrapper .user-card-wrapper {
        animation: slideInCard 0.6s ease-out both;
    }

    .users-page-wrapper .user-card-wrapper:nth-child(1) { animation-delay: 0.1s; }
    .users-page-wrapper .user-card-wrapper:nth-child(2) { animation-delay: 0.2s; }
    .users-page-wrapper .user-card-wrapper:nth-child(3) { animation-delay: 0.3s; }
    .users-page-wrapper .user-card-wrapper:nth-child(4) { animation-delay: 0.4s; }
    .users-page-wrapper .user-card-wrapper:nth-child(5) { animation-delay: 0.5s; }
    .users-page-wrapper .user-card-wrapper:nth-child(6) { animation-delay: 0.6s; }

    @keyframes slideInCard {
        from {
            opacity: 0;
            transform: translateY(30px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* User Cards */
    .users-page-wrapper .user-card {
        background: var(--surface-card);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-card);
        padding: var(--spacing-lg);
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
        min-height: 380px;
        display: flex;
        flex-direction: column;
    }

    .users-page-wrapper .user-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-3);
    }

    .users-page-wrapper .user-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(0, 121, 140, 0.02), rgba(0, 121, 140, 0.05));
        opacity: 0;
        transition: opacity var(--transition-normal);
        pointer-events: none;
    }

    .users-page-wrapper .user-card:hover::before {
        opacity: 1;
    }

    /* Online Status */
    .users-page-wrapper .online-status {
        position: absolute;
        top: var(--spacing-md);
        right: var(--spacing-md);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
        background: var(--success-bg);
        border: 1px solid var(--success);
        border-radius: var(--radius-xl);
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--success);
        z-index: 10;
    }

    .users-page-wrapper .online-dot {
        width: 8px;
        height: 8px;
        background: var(--success);
        border-radius: 50%;
        animation: onlinePulse 2s infinite;
    }

    @keyframes onlinePulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .users-page-wrapper .online-text {
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* User Avatar Section */
    .users-page-wrapper .user-avatar-section {
        display: flex;
        justify-content: center;
        margin-bottom: var(--spacing-lg);
        position: relative;
    }

    .users-page-wrapper .avatar-container {
        position: relative;
        width: 80px;
        height: 80px;
    }

    .users-page-wrapper .user-avatar {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--border-light);
        transition: all var(--transition-normal);
        box-shadow: var(--shadow-1);
        background: var(--surface-2);
        opacity: 0;
        transform: scale(0.9);
    }

    .users-page-wrapper .user-avatar.avatar-loaded {
        opacity: 1;
        transform: scale(1);
    }

    /* Avatar loading and error states */
    .users-page-wrapper .user-avatar.avatar-error {
        opacity: 0.7;
        filter: grayscale(1);
    }

    .users-page-wrapper .avatar-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--surface-2);
        border-radius: 50%;
        z-index: -1;
    }

    /* Avatar loading animation */
    .users-page-wrapper .user-avatar:not([src]) {
        background: linear-gradient(90deg, var(--surface-2) 25%, var(--surface-3) 50%, var(--surface-2) 75%);
        background-size: 200% 100%;
        animation: loading-shimmer 1.5s infinite;
    }

    .users-page-wrapper .user-avatar.avatar-loaded {
        opacity: 1;
        transform: scale(1);
    }

    /* Performance optimizations */
    .users-page-wrapper .user-avatar {
        will-change: opacity, transform;
        backface-visibility: hidden;
        transform: translateZ(0);
    }

    @keyframes loading-shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }

    .users-page-wrapper .avatar-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 121, 140, 0.8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        opacity: 0;
        transition: all var(--transition-normal);
        cursor: pointer;
    }

    .users-page-wrapper .user-card:hover .avatar-overlay {
        opacity: 1;
    }

    .users-page-wrapper .user-card:hover .user-avatar {
        transform: scale(1.05);
        border-color: var(--primary-300);
    }

    /* User Info */
    .users-page-wrapper .user-info {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .users-page-wrapper .user-name-section {
        text-align: center;
        margin-bottom: var(--spacing-md);
        padding-bottom: var(--spacing-md);
        border-bottom: 1px solid var(--border-light);
    }

    .users-page-wrapper .user-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--spacing-xs);
        line-height: 1.3;
    }

    .users-page-wrapper .user-email {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.8rem;
        font-weight: 500;
        padding: var(--spacing-xs) var(--spacing-sm);
        background: var(--surface-1);
        border-radius: var(--radius-sm);
        transition: all var(--transition-normal);
        word-break: break-all;
    }

    .users-page-wrapper .user-email:hover {
        color: var(--primary-500);
        background: var(--primary-50);
        transform: translateY(-1px);
    }

    /* User Details */
    .users-page-wrapper .user-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .users-page-wrapper .detail-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm);
        background: var(--surface-1);
        border-radius: var(--radius-sm);
        transition: all var(--transition-normal);
    }

    .users-page-wrapper .detail-item:hover {
        background: var(--surface-2);
        transform: translateX(2px);
    }

    .users-page-wrapper .detail-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        background: var(--primary-50);
        border: 1px solid var(--primary-200);
        border-radius: var(--radius-sm);
        color: var(--primary-600);
        font-size: 0.75rem;
        flex-shrink: 0;
    }

    .users-page-wrapper .detail-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
    }

    .users-page-wrapper .detail-label {
        font-size: 0.65rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .users-page-wrapper .detail-value {
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-primary);
        line-height: 1.3;
        word-break: break-word;
    }

    /* User Actions */
    .users-page-wrapper .user-actions {
        margin-top: var(--spacing-md);
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--border-light);
    }

    .users-page-wrapper .profile-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: var(--spacing-md) var(--spacing-lg);
        background: linear-gradient(135deg, var(--primary-500), var(--primary-400));
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-on-primary);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
    }

    .users-page-wrapper .profile-btn:hover {
        background: linear-gradient(135deg, var(--primary-600), var(--primary-500));
        transform: translateY(-2px);
        box-shadow: var(--shadow-2);
        color: var(--text-on-primary);
    }

    .users-page-wrapper .btn-content {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        position: relative;
        z-index: 2;
    }

    .users-page-wrapper .btn-ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.6);
        transform: scale(0);
        pointer-events: none;
    }

    /* No Users/Results Messages */
    .users-page-wrapper .no-users-message,
    .users-page-wrapper .no-results-message {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: var(--spacing-xxl);
        background: var(--surface-card);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-card);
        margin: var(--spacing-xxl) auto;
        max-width: 500px;
    }

    .users-page-wrapper .no-users-icon,
    .users-page-wrapper .no-results-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--text-muted), var(--text-disabled));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: var(--text-on-primary);
        margin-bottom: var(--spacing-lg);
    }

    .users-page-wrapper .no-users-message h3,
    .users-page-wrapper .no-results-message h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--spacing-md);
    }

    .users-page-wrapper .no-users-message p,
    .users-page-wrapper .no-results-message p {
        color: var(--text-secondary);
        margin-bottom: var(--spacing-lg);
        line-height: 1.6;
    }

    .users-page-wrapper .clear-filters-btn {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-md) var(--spacing-lg);
        background: linear-gradient(135deg, var(--primary-500), var(--primary-400));
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-on-primary);
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-normal);
    }

    .users-page-wrapper .clear-filters-btn:hover {
        background: linear-gradient(135deg, var(--primary-600), var(--primary-500));
        transform: translateY(-2px);
        box-shadow: var(--shadow-2);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .users-page-wrapper .users-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .users-page-wrapper .users-container {
            padding: 0 var(--spacing-md);
        }

        .users-page-wrapper .page-header {
            padding: var(--spacing-md) var(--spacing-lg);
            top: 70px;
        }

        .users-page-wrapper .title-section {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .users-page-wrapper .page-title {
            font-size: 2rem;
        }

        .users-page-wrapper .users-grid {
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }

        .users-page-wrapper .user-card {
            min-height: auto;
        }

        .users-page-wrapper .user-count-container {
            margin-left: 0;
            align-self: flex-start;
        }
    }

    @media (max-width: 480px) {
        .users-page-wrapper .page-title {
            font-size: 1.75rem;
        }

        .users-page-wrapper .icon-wrapper {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }

        .users-page-wrapper .user-card {
            padding: var(--spacing-md);
        }

        .users-page-wrapper .user-avatar {
            width: 60px;
            height: 60px;
        }

        .users-page-wrapper .avatar-container {
            width: 60px;
            height: 60px;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const userCardsContainer = document.getElementById('user-cards-container');
    const noResultsMessage = document.getElementById('no-results-message');
    const clearSearchBtn = document.getElementById('clear-search-btn');

    // Preload critical images
    function preloadUserAvatars() {
        const avatarImages = document.querySelectorAll('.user-avatar');
        avatarImages.forEach(img => {
            if (img.src && !img.complete) {
                img.addEventListener('load', function() {
                    this.classList.add('avatar-loaded');
                });
                img.addEventListener('error', function() {
                    this.classList.add('avatar-error');
                    // Fallback to default avatar
                    if (!this.src.includes('default.jpg')) {
                        this.src = this.src.replace(/profile_pics\/[^\/]+\/account_img\/[^\/]+/, 'profile_pics/default.jpg');
                    }
                });
            } else if (img.complete) {
                // Если изображение уже загружено
                img.classList.add('avatar-loaded');
            }
        });
    }

    // Optimize image loading with intersection observer
    function setupImageLazyLoading() {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                }
            });
        }, {
            rootMargin: '50px 0px',
            threshold: 0.01
        });

        // Observe all avatar images
        document.querySelectorAll('.user-avatar').forEach(img => {
            imageObserver.observe(img);
        });
    }

    // Initialize avatar preloading
    preloadUserAvatars();
    setupImageLazyLoading();

    // Handle already loaded images
    setTimeout(() => {
        const avatarImages = document.querySelectorAll('.user-avatar');
        avatarImages.forEach(img => {
            if (img.complete && !img.classList.contains('avatar-loaded')) {
                img.classList.add('avatar-loaded');
            }
        });
    }, 100);

    // Search functionality
    if (searchInput && userCardsContainer && noResultsMessage && clearSearchBtn) {
        searchInput.addEventListener('input', function() {
            const searchText = this.value.toLowerCase().trim();
            const cards = userCardsContainer.querySelectorAll('.user-card-wrapper');
            let foundCards = 0;

            // Show/hide clear button
            if (searchText.length > 0) {
                clearSearchBtn.classList.add('visible');
            } else {
                clearSearchBtn.classList.remove('visible');
            }

            // Filter cards
            cards.forEach(cardWrapper => {
                const card = cardWrapper.querySelector('.user-card');
                if (!card) return;

                // Get search content
                const userName = card.querySelector('.user-name')?.textContent.toLowerCase() || '';
                const userEmail = card.querySelector('.user-email')?.textContent.toLowerCase() || '';
                const fioElement = card.querySelector('[data-search-fio]');
                const fio = fioElement ? fioElement.dataset.searchFio.toLowerCase() : '';

                // Get all detail values
                let detailsText = '';
                card.querySelectorAll('.detail-value').forEach(detail => {
                    detailsText += detail.textContent.toLowerCase() + ' ';
                });

                // Check if search text matches any content
                const isMatch = userName.includes(searchText) ||
                              userEmail.includes(searchText) ||
                              fio.includes(searchText) ||
                              detailsText.includes(searchText);

                if (isMatch) {
                    cardWrapper.style.display = '';
                    foundCards++;
                } else {
                    cardWrapper.style.display = 'none';
                }
            });

            // Show/hide no results message
            if (foundCards === 0 && searchText !== '') {
                noResultsMessage.style.display = 'flex';
                userCardsContainer.style.display = 'none';
            } else {
                noResultsMessage.style.display = 'none';
                userCardsContainer.style.display = 'grid';
            }
        });

        // Clear search
        clearSearchBtn.addEventListener('click', function() {
            clearSearch();
        });
    }

    // Ripple effect for buttons
    const profileBtns = document.querySelectorAll('.profile-btn');
    profileBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            createRipple(e, this);
        });
    });

    // Enhanced focus effects for search
    searchInput.addEventListener('focus', function() {
        this.parentElement.classList.add('focused');
    });

    searchInput.addEventListener('blur', function() {
        this.parentElement.classList.remove('focused');
    });

    // Force apply padding styles to search input field
    if (searchInput) {
        searchInput.style.paddingLeft = window.innerWidth <= 480 ? '4.5rem' : '6rem';
        searchInput.style.paddingRight = '3rem';
        searchInput.style.paddingTop = '1.5rem';
        searchInput.style.paddingBottom = '1.5rem';
    }

    // Force apply margin-top to users grid to prevent overlap with header
    if (userCardsContainer) {
        if (window.innerWidth <= 480) {
            userCardsContainer.style.marginTop = '3rem';
        } else if (window.innerWidth <= 768) {
            userCardsContainer.style.marginTop = '4rem';
        } else {
            userCardsContainer.style.marginTop = '6rem';
        }
    }

    // Re-apply on window resize
    window.addEventListener('resize', function() {
        if (searchInput) {
            searchInput.style.paddingLeft = window.innerWidth <= 480 ? '4.5rem' : '6rem';
        }

        if (userCardsContainer) {
            if (window.innerWidth <= 480) {
                userCardsContainer.style.marginTop = '3rem';
            } else if (window.innerWidth <= 768) {
                userCardsContainer.style.marginTop = '4rem';
            } else {
                userCardsContainer.style.marginTop = '6rem';
            }
        }
    });

    // Staggered animation for cards
    const cards = document.querySelectorAll('.user-card-wrapper');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
            }
        });
    }, {
        threshold: 0.1
    });

    cards.forEach(card => {
        observer.observe(card);
    });
});

// Global functions
function clearSearch() {
    const searchInput = document.getElementById('search-input');
    const clearSearchBtn = document.getElementById('clear-search-btn');
    const userCardsContainer = document.getElementById('user-cards-container');
    const noResultsMessage = document.getElementById('no-results-message');

    if (searchInput) {
        searchInput.value = '';
        searchInput.focus();
    }

    if (clearSearchBtn) {
        clearSearchBtn.classList.remove('visible');
    }

    // Show all cards
    const cards = document.querySelectorAll('.user-card-wrapper');
    cards.forEach(card => {
        card.style.display = '';
    });

    // Hide no results message
    if (noResultsMessage) {
        noResultsMessage.style.display = 'none';
    }

    if (userCardsContainer) {
        userCardsContainer.style.display = 'grid';
    }
}

function createRipple(event, element) {
    const btn = element;
    const ripple = btn.querySelector('.btn-ripple');
    const rect = btn.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = event.clientX - rect.left - size / 2;
    const y = event.clientY - rect.top - size / 2;

    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    ripple.style.transform = 'scale(0)';
    ripple.style.opacity = '1';

    // Trigger animation
    requestAnimationFrame(() => {
        ripple.style.transform = 'scale(2)';
        ripple.style.opacity = '0';
    });

    // Clean up
    setTimeout(() => {
        ripple.style.transform = 'scale(0)';
        ripple.style.opacity = '0';
    }, 600);
}
</script>
{% endblock %}
