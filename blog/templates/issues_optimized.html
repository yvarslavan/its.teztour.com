{% extends 'layout.html' %}

<!-- Optimized resource loading -->
<link rel="preload" href="{{ url_for('static', filename='css/my_issues_optimized.css') }}" as="style">
<link rel="preload" href="{{ url_for('static', filename='js/my_issues_optimized.js') }}" as="script">

{% block main_page %}
<div class="issues-optimized-container">
  <!-- Loading Spinner - Optimized -->
  <div id="loading-spinner" class="loading-overlay" style="display: none;">
    <div class="loading-content">
      <div class="spinner-icon">
        <i class="fas fa-cog fa-spin"></i>
      </div>
      <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...</h3>
      <p>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</p>
    </div>
  </div>

  <!-- Error Container -->
  <div id="error-container" class="error-container" style="display: none;"></div>

  <!-- Header Section - Optimized -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-main">
        <div class="header-icon">
          <i class="fas fa-ticket-alt"></i>
        </div>
        <div class="header-text">
          <h1 class="page-title">–ú–æ–∏ –∑–∞—è–≤–∫–∏ –≤ –ò–¢-–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</h1>
          <p class="page-subtitle">
            –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∞—à–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
          </p>
        </div>
      </div>
      <div class="header-actions">
        <a href="{{ url_for('main.new_issue') }}" class="action-button primary">
          <i class="fas fa-plus"></i>
          <span>–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</span>
        </a>
        <button id="refresh-btn" class="action-button secondary" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ">
          <i class="fas fa-sync-alt"></i>
        </button>
        <button id="clear-cache-btn" class="action-button secondary" title="–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Search and Filters - Optimized -->
  <section class="search-filters-section">
    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          id="issue-search"
          class="search-input"
          placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞—è–≤–∫–∏ –∏–ª–∏ —Ç–µ–º–µ..."
          autocomplete="off"
        >
        <button id="clear-search" class="clear-search-btn" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="filters-container">
      <select id="status-filter" class="filter-select" title="–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <!-- Populated by JavaScript -->
      </select>

      <select id="priority-filter" class="filter-select" title="–§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É">
        <option value="">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
        <option value="1">–ù–∏–∑–∫–∏–π</option>
        <option value="2">–û–±—ã—á–Ω—ã–π</option>
        <option value="3">–í—ã—Å–æ–∫–∏–π</option>
        <option value="4">–°—Ä–æ—á–Ω—ã–π</option>
      </select>

      <select id="sort-select" class="filter-select" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞—è–≤–æ–∫">
        <option value="updated_on_desc">–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
        <option value="updated_on_asc">–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
        <option value="created_on_desc">–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ)</option>
        <option value="created_on_asc">–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)</option>
        <option value="subject_asc">–ü–æ —Ç–µ–º–µ (–ê-–Ø)</option>
        <option value="subject_desc">–ü–æ —Ç–µ–º–µ (–Ø-–ê)</option>
      </select>
    </div>
  </section>

  <!-- Statistics Dashboard - Optimized -->
  <section class="stats-dashboard">
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-header">
          <div class="stat-icon">
            <i class="fas fa-chart-pie"></i>
          </div>
          <div class="stat-content">
            <span class="stat-value" id="totalIssues">-</span>
            <span class="stat-label">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</span>
          </div>
        </div>
      </div>

      <div class="stat-card open">
        <div class="stat-header">
          <div class="stat-icon">
            <i class="fas fa-rocket"></i>
          </div>
          <div class="stat-content">
            <span class="stat-value" id="openIssues">-</span>
            <span class="stat-label">–ù–æ–≤—ã—Ö</span>
          </div>
        </div>
      </div>

      <div class="stat-card progress">
        <div class="stat-header">
          <div class="stat-icon">
            <i class="fas fa-cogs"></i>
          </div>
          <div class="stat-content">
            <span class="stat-value" id="progressIssues">-</span>
            <span class="stat-label">–í —Ä–∞–±–æ—Ç–µ</span>
          </div>
        </div>
      </div>

      <div class="stat-card closed">
        <div class="stat-header">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <span class="stat-value" id="closedIssues">-</span>
            <span class="stat-label">–ó–∞–∫—Ä—ã—Ç—ã—Ö</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Issues List - Optimized -->
    <section class="issues-section">
      <div class="section-header">
        <h2>–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h2>
        <div class="view-controls">
          <button id="view-list" class="view-btn active" title="–°–ø–∏—Å–æ–∫">
            <i class="fas fa-list"></i>
          </button>
          <button id="view-grid" class="view-btn" title="–°–µ—Ç–∫–∞">
            <i class="fas fa-th"></i>
          </button>
        </div>
      </div>

      <div id="issues-container" class="issues-container">
        <!-- Issues will be loaded here by JavaScript -->
      </div>

      <!-- Pagination - Optimized -->
      <div id="pagination" class="pagination">
        <!-- Pagination will be generated by JavaScript -->
      </div>
    </section>

    <!-- Issue Details Sidebar - Lazy Loaded -->
    <aside id="issue-details" class="issue-details-sidebar" style="display: none;">
      <!-- Issue details will be loaded here -->
    </aside>
  </div>

  <!-- Performance Info -->
  <div class="performance-info">
    <small>
      <i class="fas fa-info-circle"></i>
      –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
    </small>
  </div>
</div>

<!-- Optimized CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/my_issues_optimized.css') }}">

<!-- Optimized JavaScript -->
<script src="{{ url_for('static', filename='js/my_issues_optimized.js') }}" defer></script>

<!-- Performance monitoring script -->
<script>
// Performance monitoring
window.addEventListener('load', function() {
  if ('performance' in window) {
    const perfData = performance.getEntriesByType('navigation')[0];
    console.log('üìä Page Performance:', {
      'DOM Ready': `${perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart}ms`,
      'Page Load': `${perfData.loadEventEnd - perfData.loadEventStart}ms`,
      'Total Time': `${perfData.loadEventEnd - perfData.fetchStart}ms`
    });
  }
});

// Service Worker for caching
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js')
      .then(function(registration) {
        console.log('‚úÖ Service Worker registered successfully');
      })
      .catch(function(error) {
        console.log('‚ùå Service Worker registration failed:', error);
      });
  });
}
</script>

{% endblock %}
