<!-- Modern Notifications Widget -->
<!-- –≠–ö–°–¢–†–ï–ù–ù–û–ï –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï: —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ –µ—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∞–π—Ç -->
<!-- <script>console.log('üö® –í–ò–î–ñ–ï–¢ –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –≠–ö–°–¢–†–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù'); if(true) throw new Error('Widget disabled');</script> -->



<div id="modern-notifications-widget" class="modern-notifications-widget initial-hidden">
            <div class="notifications-header">
        <div class="header-content">
            <div class="header-icon">
                <i class="fas fa-bell" id="notification-bell-icon"></i>
                <span class="notification-badge" id="notification-count-badge">0</span>
            </div>
            <div class="header-text">
                <h3 class="header-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                <p class="header-subtitle" id="notification-subtitle">–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
            </div>
        </div>
        <div class="header-actions">
            <button class="action-btn minimize-btn" id="minimize-notifications" title="–°–≤–µ—Ä–Ω—É—Ç—å">
                <i class="fas fa-chevron-up"></i>
            </button>
            <button class="action-btn settings-btn" id="notification-settings" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                <i class="fas fa-cog"></i>
            </button>
            <button class="action-btn close-btn" id="close-notifications" title="–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–∂–µ—Ç">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <div class="notifications-body" id="notifications-body">
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–ª–∞—Å—Ç–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è -->
        <div class="resize-handle"></div>
        <div class="notifications-list" id="notifications-list">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
            <div class="empty-state" id="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-inbox"></i>
                </div>
                <p class="empty-text">–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω—ã</p>
                <small class="empty-subtitle">–ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
            </div>
        </div>

        <div class="notifications-footer">
            <button class="footer-btn view-all-btn" id="view-all-notifications">
                <i class="fas fa-list"></i>
                <span>–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</span>
            </button>
            <button class="footer-btn clear-btn" id="clear-notifications-modern">
                <i class="fas fa-check-double"></i>
                <span>–û—á–∏—Å—Ç–∏—Ç—å</span>
            </button>
        </div>
    </div>
</div>

<!-- Floating button to restore widget when closed -->
<div id="notifications-restore-btn" class="notifications-restore-btn">
    <button onclick="showNotificationsWidget()" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–∂–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" class="restore-button">
        <i class="fas fa-bell"></i>
    </button>
</div>

<style>
/* –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ Montserrat */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');

/* Modern Notifications Widget Styles - Glassmorphism SaaS Style */
.modern-notifications-widget {
    position: fixed !important;
    top: 120px !important;
    right: 20px !important;
    width: 480px;
    min-width: 400px;
    max-width: min(600px, calc(100vw - 40px));
    max-height: min(600px, calc(100vh - 140px));
    /* Glassmorphism - —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
    background: rgba(20, 30, 60, 0.85) !important;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    border-radius: 20px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4), 0 12px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    z-index: 999999 !important;
    display: flex;
    flex-direction: column;
    pointer-events: auto;
    /* –ò—Å–ø–æ–ª—å–∑—É–µ–º Montserrat */
    font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    animation: slideInFromRight 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    resize: horizontal;
    overflow: hidden;
}

/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ */
.modern-notifications-widget.initial-hidden {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–∏–≥–∞–Ω–∏—è */
.modern-notifications-widget.closed {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    transform: translateX(200%) !important; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 200% –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è */
    right: -200px !important; /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ */
    position: fixed !important;
    clip-path: inset(0 100% 0 0) !important; /* –û–±—Ä–µ–∑–∞–µ–º –≤–∏–¥–∂–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é */
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –º–∏–≥–∞–Ω–∏—è */
.modern-notifications-widget.initial-hidden {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}

.modern-notifications-widget.show {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

@keyframes slideInFromRight {
    from {
        transform: translateX(200%) scale(0.9); /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 200% */
        opacity: 0;
    }
    50% {
        transform: translateX(20%) scale(1.02);
        opacity: 0.8;
    }
    to {
        transform: translateX(0) scale(1);
        opacity: 1;
    }
}

.modern-notifications-widget.minimized {
    max-height: 70px !important;
    overflow: hidden !important;
    transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.modern-notifications-widget.minimized .notifications-body {
    opacity: 0 !important;
    transform: translateY(-10px) !important;
    pointer-events: none !important;
    max-height: 0 !important;
    overflow: hidden !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.modern-notifications-widget.minimized .notifications-footer {
    opacity: 0 !important;
    transform: translateY(-10px) !important;
    pointer-events: none !important;
    max-height: 0 !important;
    overflow: hidden !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.modern-notifications-widget.hidden {
    transform: translateX(200%) !important; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 200% */
    opacity: 0 !important;
    pointer-events: none !important;
    right: -200px !important; /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ */
    clip-path: inset(0 100% 0 0) !important; /* –û–±—Ä–µ–∑–∞–µ–º –≤–∏–¥–∂–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é */
}

.modern-notifications-widget.closed {
    display: none;
}

/* Header */
.notifications-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
    border-radius: 20px 20px 0 0;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
}

.header-content {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    min-width: 0;
}

.header-icon {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    border-radius: 14px;
    color: white !important;
    font-size: 20px;
    box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
    animation: pulse 2s infinite;
    flex-shrink: 0;
}

.header-icon i,
.header-icon .fas,
.header-icon .fa-bell {
    color: white !important;
    font-size: 18px !important;
    display: block !important;
}

/* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–∫–∏ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ */
#notification-bell-icon {
    color: white !important;
    font-size: 18px !important;
    display: block !important;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
    50% { box-shadow: 0 8px 24px rgba(59, 130, 246, 0.5); }
}

.notification-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    min-width: 20px;
    height: 20px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid rgba(20, 30, 60, 0.85);
    animation: bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    font-family: 'Montserrat', sans-serif;
}

@keyframes bounce {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.header-text {
    flex: 1;
    min-width: 0;
    overflow: hidden;
}

.header-title {
    font-size: 18px;
    font-weight: 700;
    margin: 0 0 4px 0;
    color: #ffffff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    letter-spacing: -0.02em;
    font-family: 'Montserrat', sans-serif;
}

.header-subtitle {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.6);
    margin: 0;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: 'Montserrat', sans-serif;
}

.header-actions {
    display: flex;
    gap: 6px;
    margin-left: 12px;
    flex-shrink: 0;
}

.action-btn {
    width: 34px;
    height: 34px;
    border: none;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.08);
    color: rgba(255, 255, 255, 0.6) !important;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 14px !important;
    position: relative;
    z-index: 10;
    flex-shrink: 0;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
}

.action-btn i,
.action-btn .fas,
.action-btn .fa-times,
.action-btn .fa-chevron-up,
.action-btn .fa-cog {
    color: inherit !important;
    font-size: 12px !important;
    display: block !important;
}

/* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è */
#close-notifications {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

#close-notifications i {
    color: #6b7280 !important;
    font-size: 12px !important;
}

.action-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    color: white !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.close-btn:hover {
    background: rgba(239, 68, 68, 0.25);
    color: #fca5a5 !important;
}

.minimize-btn:hover {
    background: rgba(59, 130, 246, 0.25);
    color: #93c5fd !important;
}

.settings-btn:hover {
    background: rgba(16, 185, 129, 0.25);
    color: #6ee7b7 !important;
}

/* Body */
.notifications-body {
    display: flex;
    flex-direction: column;
    max-height: 500px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.notifications-list {
    flex: 1;
    overflow-y: auto;
    padding: 16px 20px;
    scrollbar-width: thin;
    scrollbar-color: rgba(99, 102, 241, 0.3) transparent;
}

.notifications-list::-webkit-scrollbar {
    width: 6px;
}

.notifications-list::-webkit-scrollbar-thumb {
    background: rgba(99, 102, 241, 0.3);
    border-radius: 3px;
}

/* Notification Item - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ */
.notification-item {
    padding: 16px !important;
    margin-bottom: 12px;
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 14px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: slideInFromBottom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

/* Swipe –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
.notification-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.1), transparent);
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.notification-item::after {
    content: '';
    position: absolute;
    top: 0;
    right: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.1), transparent);
    transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

@keyframes slideInFromBottom {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.notification-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
    background: rgba(255, 255, 255, 0.08) !important;
    border-color: rgba(255, 255, 255, 0.15);
}

.notification-item.status-change {
    border-left: 4px solid #10b981;
}

.notification-item.comment-added {
    border-left: 4px solid #3b82f6;
}

.notification-item.redmine-task {
    border-left: 4px solid #f97316;
}

.notification-item.redmine-task:hover {
    background: rgba(249, 115, 22, 0.05);
}

.notification-content {
    display: flex;
    align-items: flex-start;
    gap: 14px;
}

/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∫–æ–Ω–æ–∫ - –±–æ–ª–µ–µ –∏–∑—è—â–Ω—ã–µ */
.notification-icon {
    width: 36px !important;
    height: 36px !important;
    border-radius: 12px !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px !important;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.notification-icon.status-change {
    background: linear-gradient(135deg, #34d399, #10b981) !important;
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25) !important;
}

.notification-icon.comment-added {
    background: linear-gradient(135deg, #60a5fa, #3b82f6) !important;
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25) !important;
}

.notification-icon.redmine-task {
    /* –ë–æ–ª–µ–µ –º—è–≥–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç */
    background: linear-gradient(135deg, #fb923c, #f97316) !important;
    color: white;
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.25) !important;
}

.notification-text {
    flex: 1;
}

.notification-title {
    font-size: 14px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.95);
    margin: 0 0 6px 0;
    line-height: 1.5;
    font-family: 'Montserrat', sans-serif;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∑–∞–¥–∞—á–∏ #ID - –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –∏ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–∏–Ω–∏–π —Ü–≤–µ—Ç */
.notification-description {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
    margin: 0 0 8px 0;
    line-height: 1.5;
    font-family: 'Montserrat', sans-serif;
}

/* –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–¥–∞—á (#269879) –∂–∏—Ä–Ω—ã–º –∏ —Å–∏–Ω–∏–º —Ü–≤–µ—Ç–æ–º */
.notification-description .issue-id,
.notification-description b,
.notification-description strong {
    font-weight: 700 !important;
    color: #3b82f6 !important;
    background: rgba(59, 130, 246, 0.15);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
}

.notification-time {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.5);
    font-weight: 500;
    font-family: 'Montserrat', sans-serif;
}

/* –£–õ–£–ß–®–ï–ù–û: –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ */
.notification-actions {
    display: flex;
    gap: 10px;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
}

.notification-action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 14px;
    border: 1px solid transparent;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    white-space: nowrap;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    font-family: 'Montserrat', sans-serif;
}

.notification-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.notification-action-btn i {
    margin-right: 6px;
    font-size: 11px;
}

/* –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫—Ä—ã—Ç—å –≤ Redmine" - —Å–∏–Ω—è—è */
.redmine-link-btn {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white !important;
    border-color: #1d4ed8;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}
.redmine-link-btn:hover {
    background: linear-gradient(135deg, #60a5fa, #3b82f6);
    color: white !important;
    border-color: #2563eb;
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
}

/* –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" - –≤—Ç–æ—Ä–∏—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ */
.mark-read-btn {
    background: rgba(255, 255, 255, 0.08);
    color: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.15);
}
.mark-read-btn:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.25);
    color: white;
}

.mark-read-btn i {
    color: rgba(255, 255, 255, 0.7);
}


/* Empty State - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è —Ç–µ–º–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: rgba(255, 255, 255, 0.5);
}

.empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.4;
}

.empty-text {
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: rgba(255, 255, 255, 0.7);
    font-family: 'Montserrat', sans-serif;
}

.empty-subtitle {
    font-size: 13px;
    margin: 0;
    color: rgba(255, 255, 255, 0.5);
    font-family: 'Montserrat', sans-serif;
}

/* Footer - –æ–±–Ω–æ–≤–ª–µ–Ω–æ */
.notifications-footer {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    padding: 12px 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    gap: 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 0 0 20px 20px;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    margin: 0;
    box-sizing: border-box;
    min-height: 72px;
}

/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ —Ñ—É—Ç–µ—Ä–∞ */
.footer-btn {
    flex: 1;
    padding: 12px 16px;
    border: none;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 44px;
    max-width: 100%;
    box-sizing: border-box;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: 'Montserrat', sans-serif;
}
.footer-btn span {
    opacity: 1 !important;
    visibility: visible !important;
    color: inherit;
}

/* –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ" - –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è */
.view-all-btn {
    background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
    color: white !important;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.view-all-btn:hover {
    background: linear-gradient(135deg, #60a5fa, #3b82f6) !important;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

/* –ö–Ω–æ–ø–∫–∞ "–û—á–∏—Å—Ç–∏—Ç—å" - –º–µ–Ω–µ–µ –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è */
.clear-btn {
    background: rgba(255, 255, 255, 0.08) !important;
    color: rgba(255, 255, 255, 0.6) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.clear-btn:hover {
    background: rgba(255, 255, 255, 0.12) !important;
    color: rgba(255, 255, 255, 0.8) !important;
    transform: translateY(-2px);
}

/* Responsive - –£–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
@media (max-width: 320px) {
    /* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
    .modern-notifications-widget {
        width: calc(100vw - 20px) !important;
        right: 10px !important;
        left: 10px !important;
        top: 100px !important;
        max-height: calc(100vh - 120px) !important;
        min-width: 280px !important;
    }

    .notifications-header {
        padding: 16px 18px 12px !important;
    }

    .header-icon {
        width: 40px !important;
        height: 40px !important;
        font-size: 18px !important;
    }

    .header-title {
        font-size: 18px !important;
    }

    .header-subtitle {
        font-size: 12px !important;
    }

    .action-btn {
        width: 32px !important;
        height: 32px !important;
    }

    .notifications-footer {
        padding: 8px 12px !important;
        gap: 6px !important;
        min-height: 56px !important;
    }

    .footer-btn {
        padding: 10px 8px !important;
        font-size: 10px !important;
        min-height: 40px !important;
        gap: 3px !important;
    }

    .footer-btn span {
        display: none !important;
    }

    .footer-btn i {
        font-size: 16px !important;
    }
}

@media (max-width: 480px) {
    .modern-notifications-widget {
        width: calc(100vw - 30px) !important;
        right: 15px !important;
        left: 15px !important;
        top: 105px !important;
        max-height: calc(100vh - 125px) !important;
        min-width: 320px !important;
    }

    .notifications-header {
        padding: 18px 20px 14px !important;
    }

    .header-icon {
        width: 44px !important;
        height: 44px !important;
        font-size: 19px !important;
    }

    .header-title {
        font-size: 19px !important;
    }

    .header-subtitle {
        font-size: 13px !important;
    }

    .action-btn {
        width: 34px !important;
        height: 34px !important;
    }

    .notifications-footer {
        padding: 10px 16px !important;
        gap: 8px !important;
        min-height: 60px !important;
    }

    .footer-btn {
        padding: 12px 10px !important;
        font-size: 11px !important;
        min-height: 40px !important;
        gap: 4px !important;
    }

    .footer-btn span {
        display: none !important;
    }

    .footer-btn i {
        font-size: 15px !important;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .notification-item {
        padding: 16px !important;
        margin-bottom: 10px !important;
    }

    .notification-icon {
        width: 36px !important;
        height: 36px !important;
        font-size: 16px !important;
    }

    .notification-title {
        font-size: 14px !important;
    }

    .notification-description {
        font-size: 12px !important;
    }

    .notification-time {
        font-size: 11px !important;
    }
}

@media (max-width: 768px) {
    .modern-notifications-widget {
        width: calc(100vw - 40px) !important;
        right: 20px !important;
        left: 20px !important;
        top: 110px !important;
        max-height: calc(100vh - 130px) !important;
        min-width: 360px !important;
    }

    .notifications-header {
        padding: 20px 22px 16px !important;
    }

    .notifications-footer {
        padding: 12px 18px !important;
        gap: 10px !important;
        min-height: 66px !important;
    }

    .footer-btn {
        padding: 12px 14px !important;
        font-size: 12px !important;
        min-height: 42px !important;
        gap: 5px !important;
    }

    .footer-btn span {
        display: inline !important;
    }

    .footer-btn i {
        font-size: 13px !important;
    }
}

@media (max-width: 1024px) {
    .modern-notifications-widget {
        width: 420px !important;
        max-width: calc(100vw - 40px) !important;
    }
}

/* –î–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –æ—Ç—Å—Ç—É–ø */
@media (min-width: 1200px) {
    .modern-notifications-widget {
        top: 130px !important; /* –ë–æ–ª—å—à–∏–π –æ—Ç—Å—Ç—É–ø –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
    }
}

/* Touch-friendly —É–ª—É—á—à–µ–Ω–∏—è */
@media (hover: none) and (pointer: coarse) {
    /* –°—Ç–∏–ª–∏ –¥–ª—è touch-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    .action-btn {
        min-width: 44px !important;
        min-height: 44px !important;
        padding: 12px !important;
    }

    .footer-btn {
        min-height: 48px !important;
        padding: 14px 16px !important;
    }

    .notification-item {
        padding: 20px !important;
        margin-bottom: 16px !important;
        cursor: pointer !important;
        user-select: none !important;
        -webkit-user-select: none !important;
        -webkit-touch-callout: none !important;
    }

    .notification-action-btn {
        min-height: 44px !important;
        padding: 12px 18px !important;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–∞ touch-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
    .notifications-list {
        -webkit-overflow-scrolling: touch !important;
        overscroll-behavior: contain !important;
    }

    /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ swipe */
    .notifications-list * {
        -webkit-user-select: none !important;
        -moz-user-select: none !important;
        -ms-user-select: none !important;
        user-select: none !important;
    }
}

/* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è landscape –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) and (orientation: landscape) {
    .modern-notifications-widget {
        max-height: calc(100vh - 80px) !important;
        top: 60px !important;
    }

    .notifications-header {
        padding: 12px 20px 10px !important;
    }

    .header-icon {
        width: 40px !important;
        height: 40px !important;
    }

    .header-title {
        font-size: 18px !important;
    }
}

/* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (min-height: 800px) {
    .modern-notifications-widget {
        max-height: 700px !important;
    }
}

/* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (min-width: 1400px) {
    .modern-notifications-widget {
        width: 520px !important;
        max-width: 520px !important;
    }
}



/* Floating Restore Button */
.notifications-restore-btn {
    position: fixed !important;
    bottom: 2rem !important;
    right: 2rem !important;
    z-index: 999998 !important;
    animation: restoreButtonPulse 2s ease-in-out infinite;
    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –±–µ–ª—ã–µ —Ñ–æ–Ω—ã */
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
}

@keyframes restoreButtonPulse {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
    }
    50% {
        transform: scale(1.05);
        box-shadow: 0 12px 32px rgba(59, 130, 246, 0.6);
    }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è notifications-restore-btn (—É–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) */
@media (max-width: 1024px) {
  .notifications-restore-btn {
    right: 1.5rem !important;
    bottom: 1.5rem !important;
  }

  .notifications-restore-btn .restore-button {
    width: 56px !important;
    height: 56px !important;
  }

  .notifications-restore-btn .restore-button i {
    font-size: 18px !important;
  }
}

@media (max-width: 768px) {
  .notifications-restore-btn {
    right: 1.25rem !important;
    bottom: 1.25rem !important;
  }

  .notifications-restore-btn .restore-button {
    width: 52px !important;
    height: 52px !important;
  }

  .notifications-restore-btn .restore-button i {
    font-size: 17px !important;
  }
}

@media (max-width: 480px) {
  .notifications-restore-btn {
    right: 1rem !important;
    bottom: 1rem !important;
  }

  .notifications-restore-btn .restore-button {
    width: 48px !important;
    height: 48px !important;
  }

  .notifications-restore-btn .restore-button i {
    font-size: 16px !important;
  }
}

@media (max-width: 320px) {
  .notifications-restore-btn {
    right: 0.75rem !important;
    bottom: 0.75rem !important;
  }

  .notifications-restore-btn .restore-button {
    width: 44px !important;
    height: 44px !important;
  }

  .notifications-restore-btn .restore-button i {
    font-size: 15px !important;
  }
}

.notifications-restore-btn .restore-button {
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6) !important;
    cursor: pointer !important;
    box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border: none !important;
    outline: none !important;
    padding: 0 !important;
    margin: 0 !important;
    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –±–µ–ª—ã–µ —Ñ–æ–Ω—ã */
    background-color: transparent !important;
    background-image: linear-gradient(135deg, #3b82f6, #8b5cf6) !important;
    background-repeat: no-repeat !important;
    background-position: center !important;
    background-size: cover !important;
    /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã */
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
    padding: 0 !important;
    margin: 0 !important;
    /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–æ–Ω—ã */
    background-attachment: scroll !important;
    background-clip: border-box !important;
    background-origin: padding-box !important;
}

.notifications-restore-btn .restore-button i {
    color: white !important;
    font-size: 20px !important;
    display: block !important;
    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –±–µ–ª—ã–µ —Ñ–æ–Ω—ã */
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
}

.notifications-restore-btn .restore-button:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 12px 32px rgba(59, 130, 246, 0.6) !important;
    background: linear-gradient(135deg, #2563eb, #7c3aed) !important;
    background-image: linear-gradient(135deg, #2563eb, #7c3aed) !important;
    background-color: transparent !important;
}

.notifications-restore-btn .restore-button:active {
    transform: translateY(0) !important;
    box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4) !important;
    background-color: transparent !important;
}

/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –±–µ–ª—ã–π —Ñ–æ–Ω —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è */
.notifications-restore-btn * {
    background-color: transparent !important;
    background: transparent !important;
    background-image: none !important;
}

.notifications-restore-btn .restore-button * {
    background-color: transparent !important;
    background: transparent !important;
    background-image: none !important;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –±–µ–ª–æ–≥–æ —Ñ–æ–Ω–∞ */
.notifications-restore-btn,
.notifications-restore-btn *,
.notifications-restore-btn .restore-button,
.notifications-restore-btn .restore-button * {
    background-color: transparent !important;
    background: transparent !important;
    background-image: none !important;
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
}

/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç */
.notifications-restore-btn .restore-button {
    background: linear-gradient(135deg, #6366f1, #a855f7) !important;
    background-image: linear-gradient(135deg, #6366f1, #a855f7) !important;
    background-color: transparent !important;
}

/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –±–µ–ª—ã–π —Ñ–æ–Ω —É –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
button.restore-button,
span.restore-button,
.restore-button,
.notifications-restore-btn button,
.notifications-restore-btn span {
    background: linear-gradient(135deg, #6366f1, #a855f7) !important;
    background-image: linear-gradient(135deg, #6366f1, #a855f7) !important;
    background-color: transparent !important;
    border: none !important;
    outline: none !important;
    box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4) !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ –ø—Ä–∏ –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö */
@keyframes bellShake {
    0%, 100% { transform: rotate(0deg); }
    10%, 30%, 50%, 70%, 90% { transform: rotate(-10deg); }
    20%, 40%, 60%, 80% { transform: rotate(10deg); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ */
.header-icon .fas.fa-bell.has-notifications {
    color: #ff6b6b;
    filter: drop-shadow(0 0 8px rgba(255, 107, 107, 0.6));
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è badge */
.notification-badge {
    animation: badgePulse 2s ease-in-out infinite;
}

@keyframes badgePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ */
.header-actions .action-btn {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 36px !important;
    height: 36px !important;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.header-actions .action-btn:hover {
    background: rgba(255, 255, 255, 0.15) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
}

/* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ */
#minimize-notifications {
    display: flex !important;
    visibility: visible !important;
}

#notification-settings {
    display: flex !important;
    visibility: visible !important;
}

#close-notifications {
    display: flex !important;
    visibility: visible !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–æ–∫ –≤ –∫–Ω–æ–ø–∫–∞—Ö */
#minimize-notifications i {
    color: #94a3b8 !important;
    font-size: 14px !important;
}

#notification-settings i {
    color: #94a3b8 !important;
    font-size: 14px !important;
}

#close-notifications i {
    color: #94a3b8 !important;
    font-size: 14px !important;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.modern-notifications-widget .header-actions {
    display: flex !important;
    gap: 8px !important;
}

.modern-notifications-widget .header-actions button {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.modern-notifications-widget .header-icon {
    display: flex !important;
    visibility: visible !important;
}

.modern-notifications-widget .header-icon i {
    color: white !important;
    font-size: 20px !important;
    display: block !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –º–∏–≥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞ */
@keyframes widgetBlink {
    0%, 50% {
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 12px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    25%, 75% {
        box-shadow: 0 25px 50px rgba(59, 130, 246, 0.4), 0 12px 24px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    100% {
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 12px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
}

.modern-notifications-widget.blink {
    animation: widgetBlink 0.5s ease-in-out;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è */
.notifications-restore-btn {
    position: fixed !important;
    bottom: 20px !important;
    right: 20px !important;
    z-index: 999999 !important;
    display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞ */
}

.notifications-restore-btn .restore-button {
    width: 56px !important;
    height: 56px !important;
    border: none !important;
    border-radius: 50% !important;
    background: linear-gradient(135deg, #6366f1, #a855f7) !important;
    color: white !important;
    font-size: 20px !important;
    cursor: pointer !important;
    box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4) !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    outline: none !important;
    padding: 0 !important;
    margin: 0 !important;
    position: relative !important;
    overflow: hidden !important;
}

/* ===== Widget Redesign: Minimal + Modern + High Readability ===== */
.modern-notifications-widget,
.notifications-restore-btn {
    --widget-brand-primary: #00798c;
    --widget-brand-primary-dark: #005f73;
    --widget-brand-primary-light: #26c6da;
    --widget-brand-accent: #f59e0b;
    --widget-brand-accent-dark: #d97706;
    --widget-brand-surface: #f4fcfd;
}

.modern-notifications-widget {
    position: fixed !important;
    top: 102px !important;
    right: 20px !important;
    width: min(420px, calc(100vw - 28px)) !important;
    min-width: 340px !important;
    max-width: 520px !important;
    max-height: min(620px, calc(100vh - 120px)) !important;
    background: linear-gradient(180deg, rgba(251, 255, 255, 0.98) 0%, rgba(244, 252, 253, 0.96) 100%) !important;
    border: 1px solid rgba(0, 121, 140, 0.22) !important;
    border-radius: 18px !important;
    box-shadow: 0 16px 34px rgba(0, 95, 115, 0.17), 0 6px 12px rgba(15, 23, 42, 0.08) !important;
    color: #0f172a !important;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    -webkit-backdrop-filter: blur(14px);
    backdrop-filter: blur(14px);
}

.notifications-header {
    padding: 14px 16px 12px !important;
    border-bottom: 1px solid rgba(0, 121, 140, 0.2) !important;
    background: linear-gradient(135deg, rgba(0, 121, 140, 0.13), rgba(38, 198, 218, 0.07)) !important;
    border-radius: 18px 18px 0 0 !important;
}

.header-content {
    gap: 10px !important;
}

.header-icon {
    width: 38px !important;
    height: 38px !important;
    border-radius: 11px !important;
    background: linear-gradient(135deg, var(--widget-brand-primary), var(--widget-brand-primary-light)) !important;
    box-shadow: 0 8px 18px rgba(0, 121, 140, 0.3) !important;
    animation: none !important;
}

.header-icon i,
#notification-bell-icon {
    color: #ffffff !important;
    font-size: 15px !important;
}

.notification-badge {
    background: linear-gradient(135deg, var(--widget-brand-accent), var(--widget-brand-accent-dark)) !important;
    border: 2px solid #f8fbff !important;
    color: #ffffff !important;
}

.header-title {
    margin: 0 0 2px 0 !important;
    font-size: 15px !important;
    font-weight: 700 !important;
    color: #0f172a !important;
    letter-spacing: 0 !important;
}

.header-subtitle {
    margin: 0 !important;
    font-size: 12px !important;
    color: #64748b !important;
    font-weight: 500 !important;
}

.header-actions {
    gap: 6px !important;
}

.action-btn {
    width: 30px !important;
    height: 30px !important;
    border: 1px solid rgba(0, 121, 140, 0.24) !important;
    border-radius: 9px !important;
    background: rgba(255, 255, 255, 0.88) !important;
    color: #475569 !important;
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
}

.action-btn i,
#minimize-notifications i,
#notification-settings i,
#close-notifications i {
    color: #475569 !important;
    font-size: 12px !important;
}

.action-btn:hover {
    background: rgba(0, 121, 140, 0.08) !important;
    border-color: rgba(0, 121, 140, 0.44) !important;
    color: var(--widget-brand-primary-dark) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 6px 14px rgba(0, 121, 140, 0.17) !important;
}

.action-btn:hover i {
    color: var(--widget-brand-primary-dark) !important;
}

.close-btn:hover {
    background: #fef2f2 !important;
    border-color: rgba(239, 68, 68, 0.42) !important;
    color: #dc2626 !important;
}

.close-btn:hover i {
    color: #dc2626 !important;
}

.notifications-body {
    display: flex;
    flex-direction: column;
    max-height: 500px;
    background: transparent !important;
    position: relative !important;
}

.resize-handle {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 8px !important;
    height: 100% !important;
    cursor: ew-resize !important;
    background: linear-gradient(90deg, rgba(0, 121, 140, 0.24) 0%, rgba(0, 121, 140, 0.06) 55%, transparent 100%) !important;
    border-right: 1px solid rgba(0, 121, 140, 0.18) !important;
    z-index: 10 !important;
}

.notifications-list {
    flex: 1;
    overflow-y: auto;
    padding: 12px 14px 20px !important;
    scrollbar-width: thin;
    scrollbar-color: rgba(100, 116, 139, 0.45) transparent;
}

.notifications-list::-webkit-scrollbar {
    width: 6px;
}

.notifications-list::-webkit-scrollbar-thumb {
    background: rgba(100, 116, 139, 0.45);
    border-radius: 999px;
}

.notification-item {
    padding: 12px !important;
    margin-bottom: 10px !important;
    background: rgba(255, 255, 255, 0.9) !important;
    border: 1px solid rgba(0, 121, 140, 0.2) !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08) !important;
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
    overflow: visible !important;
}

.notification-item::before,
.notification-item::after {
    display: none !important;
}

.notification-item:hover {
    transform: translateY(-1px) !important;
    background: #ffffff !important;
    border-color: rgba(0, 121, 140, 0.4) !important;
    box-shadow: 0 10px 20px rgba(0, 95, 115, 0.14) !important;
}

.notification-item.status-change {
    border-left: 3px solid #10b981 !important;
}

.notification-item.comment,
.notification-item.comment-added {
    border-left: 3px solid var(--widget-brand-primary) !important;
}

.notification-item.redmine-task {
    border-left: 3px solid var(--widget-brand-accent) !important;
}

.notification-item.redmine-task:hover {
    background: #ffffff !important;
}

.notification-content {
    gap: 10px !important;
}

.notification-icon {
    width: 32px !important;
    height: 32px !important;
    border-radius: 10px !important;
    font-size: 13px !important;
    box-shadow: none !important;
}

.notification-icon.status-change {
    background: linear-gradient(135deg, #10b981, #059669) !important;
}

.notification-icon.comment,
.notification-icon.comment-added {
    background: linear-gradient(135deg, var(--widget-brand-primary), var(--widget-brand-primary-light)) !important;
}

.notification-icon.redmine-task {
    background: linear-gradient(135deg, var(--widget-brand-accent), var(--widget-brand-accent-dark)) !important;
}

.notification-text {
    min-width: 0;
}

.notification-title {
    margin: 0 0 4px 0 !important;
    font-size: 13px !important;
    line-height: 1.4 !important;
    color: #0f172a !important;
    font-weight: 700 !important;
}

.notification-description {
    margin: 0 0 7px 0 !important;
    font-size: 12px !important;
    line-height: 1.45 !important;
    color: #334155 !important;
}

.notification-description .issue-id,
.notification-description b,
.notification-description strong {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(0, 121, 140, 0.14) !important;
    color: var(--widget-brand-primary-dark) !important;
    font-size: 11px !important;
    font-weight: 700 !important;
}

.notification-source,
.modern-notifications-widget .text-muted {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 0 0 7px 0;
    font-size: 11px !important;
    line-height: 1.35 !important;
    color: #64748b !important;
}

.notification-source i {
    color: #64748b !important;
    font-size: 11px !important;
}

.notification-time {
    font-size: 11px !important;
    color: #64748b !important;
    font-weight: 500 !important;
}

.modern-notifications-widget .notification-actions {
    display: grid !important;
    grid-template-columns: max-content minmax(0, 1fr) !important;
    align-items: center !important;
    width: 100% !important;
    margin-top: 10px !important;
    padding-top: 10px !important;
    border-top: 1px solid rgba(148, 163, 184, 0.24) !important;
    gap: 8px !important;
    position: relative;
    z-index: 1;
}

.modern-notifications-widget .notification-action-btn {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-height: 34px !important;
    width: 100% !important;
    min-width: 0 !important;
    padding: 7px 10px !important;
    border-radius: 9px !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    text-decoration: none !important;
    line-height: 1.1 !important;
}

.modern-notifications-widget .notification-action-btn i {
    margin-right: 5px !important;
    font-size: 11px !important;
    flex-shrink: 0 !important;
}

.modern-notifications-widget .mark-read-btn {
    min-width: 108px !important;
    background: #eaf4f7 !important;
    color: #27404c !important;
    border: 1px solid rgba(0, 121, 140, 0.3) !important;
}

.modern-notifications-widget .mark-read-btn i {
    color: #2f5563 !important;
}

.modern-notifications-widget .mark-read-btn:hover {
    background: rgba(0, 121, 140, 0.16) !important;
    border-color: rgba(0, 121, 140, 0.5) !important;
    color: #0f172a !important;
}

.modern-notifications-widget .mark-read-btn:hover i {
    color: #0f172a !important;
}

.modern-notifications-widget .redmine-link-btn {
    background: linear-gradient(135deg, var(--widget-brand-primary), var(--widget-brand-primary-dark)) !important;
    color: #ffffff !important;
    border: 1px solid #004959 !important;
    box-shadow: 0 4px 10px rgba(0, 121, 140, 0.28) !important;
}

.modern-notifications-widget .redmine-link-btn i {
    color: #ffffff !important;
}

.modern-notifications-widget .redmine-link-btn:hover {
    background: linear-gradient(135deg, var(--widget-brand-primary-dark), #004959) !important;
    border-color: #003f4d !important;
    color: #ffffff !important;
}

@media (max-width: 560px) {
    .modern-notifications-widget .notification-actions {
        grid-template-columns: 1fr !important;
    }

    .modern-notifications-widget .mark-read-btn {
        min-width: 0 !important;
    }
}

.empty-state {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 30px 16px !important;
    color: #64748b !important;
}

.empty-icon {
    width: 56px !important;
    height: 56px !important;
    border-radius: 50% !important;
    background: rgba(0, 121, 140, 0.1) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin-bottom: 12px !important;
}

.empty-icon i {
    font-size: 22px !important;
    color: var(--widget-brand-primary) !important;
}

.empty-text {
    margin: 0 0 6px 0 !important;
    color: #334155 !important;
    font-size: 14px !important;
}

.empty-subtitle {
    color: #64748b !important;
    font-size: 12px !important;
}

.notifications-footer {
    padding: 10px 14px !important;
    min-height: 60px !important;
    gap: 8px !important;
    border-top: 1px solid rgba(0, 121, 140, 0.22) !important;
    background: rgba(0, 121, 140, 0.06) !important;
    border-radius: 0 0 18px 18px !important;
}

.footer-btn {
    min-height: 40px !important;
    border-radius: 10px !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    gap: 6px !important;
}

.view-all-btn {
    background: linear-gradient(135deg, var(--widget-brand-primary), var(--widget-brand-primary-dark)) !important;
    color: #ffffff !important;
    box-shadow: 0 6px 14px rgba(0, 121, 140, 0.25) !important;
}

.view-all-btn:hover {
    transform: translateY(-1px) !important;
    box-shadow: 0 8px 18px rgba(0, 95, 115, 0.3) !important;
}

.clear-btn {
    background: #f1f7f8 !important;
    color: #334155 !important;
    border: 1px solid rgba(0, 121, 140, 0.24) !important;
}

.clear-btn:hover {
    background: rgba(0, 121, 140, 0.12) !important;
    color: #0f172a !important;
}

.notifications-restore-btn .restore-button {
    width: 52px !important;
    height: 52px !important;
    background: linear-gradient(135deg, var(--widget-brand-primary), var(--widget-brand-primary-light)) !important;
    box-shadow: 0 10px 22px rgba(0, 121, 140, 0.3) !important;
}

.notifications-restore-btn .restore-button i {
    color: #ffffff !important;
    font-size: 18px !important;
}

@media (max-width: 768px) {
    .modern-notifications-widget {
        top: 82px !important;
        right: 8px !important;
        left: 8px !important;
        width: calc(100vw - 16px) !important;
        min-width: 0 !important;
        max-width: none !important;
        max-height: calc(100vh - 92px) !important;
        resize: none !important;
    }

    .notifications-header {
        padding: 12px 12px 10px !important;
    }

    .notifications-list {
        padding: 10px 10px 16px !important;
    }

    .notifications-footer {
        padding: 8px 10px !important;
        gap: 6px !important;
    }

    .footer-btn {
        min-height: 38px !important;
    }
}
</style>

<script>
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π try-catch –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
try {
    console.log('[ModernWidget] üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');

    class ModernNotificationsWidget {
        constructor() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ –≤–∏–¥–∂–µ—Ç
            if (window.notificationsWidgetInitialized) {
                console.log('[ModernWidget] ‚ö†Ô∏è –í–∏–¥–∂–µ—Ç —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
                return;
            }

            try {
                this.widget = document.getElementById('modern-notifications-widget');
                this.list = document.getElementById('notifications-list');
                this.badge = document.getElementById('notification-count-badge');
                this.subtitle = document.getElementById('notification-subtitle');
                this.notifications = [];
                this.isMinimized = false;

                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                this.audio = null;
                this.lastPlayAttempt = 0;
                this.minPlayInterval = 1500; // 1.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º–∏
                this.audioInitialized = false;

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç
                this.initializeAudio();

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                this.setupAudioUnblockHandler();

                const missingElements = [];
                if (!this.widget) missingElements.push('modern-notifications-widget');
                if (!this.list) missingElements.push('notifications-list');
                if (!this.badge) missingElements.push('notification-count-badge');
                if (!this.subtitle) missingElements.push('notification-subtitle');

                if (missingElements.length > 0) {
                    console.warn('[ModernWidget] ‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã:', missingElements.join(', '));
                    console.warn('[ModernWidget] ‚ö†Ô∏è –í–∏–¥–∂–µ—Ç –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');

                    if (!this.widget) {
                        console.error('[ModernWidget] ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –æ—Å–Ω–æ–≤–Ω–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }
                }

                this.loadWidgetState();
                this.bindEvents();
                this.startPolling();

                console.log('[ModernWidget] ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                window.notificationsWidgetInitialized = true;
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:', error);
                if (this.widget) {
                    this.widget.style.display = 'none';
                }
            }
        }

        bindEvents() {
            try {
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#close-notifications')) {
                        console.log('[ModernWidget] üîò –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∏–¥–∂–µ—Ç–∞');
                        this.closeWidget();
                        return;
                    }

                    if (e.target.closest('#minimize-notifications')) {
                        console.log('[ModernWidget] üìè –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏');
                        this.toggleMinimize();
                        return;
                    }

                    if (e.target.closest('#clear-notifications-modern')) {
                        console.log('[ModernWidget] üßπ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –æ—á–∏—Å—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                        this.clearNotifications();
                        return;
                    }

                    const markReadButton = e.target.closest('.mark-read-btn');
                    if (markReadButton) {
                        e.preventDefault();
                        const notificationId = markReadButton.getAttribute('data-id');
                        if (notificationId && notificationId.startsWith('redmine_')) {
                            const redmineId = notificationId.replace('redmine_', '');
                            console.log(`[ModernWidget] ‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" –¥–ª—è Redmine ID: ${redmineId}`);
                            this.markRedmineNotificationAsRead(redmineId);
                        }
                        return;
                    }

                    if (e.target.closest('#view-all-notifications')) {
                        console.log('[ModernWidget] üìã –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                        window.location.href = '/notifications';
                        return;
                    }

                    if (e.target.closest('#notification-settings')) {
                        console.log('[ModernWidget] ‚öôÔ∏è –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                        this.openNotificationSettings();
                        return;
                    }
                });

                document.addEventListener('dblclick', (e) => {
                    if (e.target.closest('.header-icon')) {
                        console.log('[ModernWidget] üîä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤—É–∫–∞ –ø–æ –¥–≤–æ–π–Ω–æ–º—É –∫–ª–∏–∫—É');
                        this.playNotificationSound();
                    }
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
                this.addResizeHandler();

                console.log('[ModernWidget] ‚úÖ –°–æ–±—ã—Ç–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π:', error);
            }
        }

                addResizeHandler() {
            try {
                if (!this.widget) {
                    console.error('[ModernWidget] ‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è');
                    return;
                }

                let isResizing = false;
                let startX, startWidth, startRight;

                const handleMouseDown = (e) => {
                    console.log('[ModernWidget] üñ±Ô∏è MouseDown event triggered');

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –≤ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–∞ (–æ–±–ª–∞—Å—Ç—å —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è)
                    const rect = this.widget.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;

                    console.log('[ModernWidget] üìç Click position:', clickX, 'Widget width:', rect.width);

                    // –ï—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –≤ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–∞ (–ø–µ—Ä–≤—ã–µ 10px)
                    if (clickX < 10) {
                        console.log('[ModernWidget] üîß Starting resize operation');
                        isResizing = true;
                        startX = e.clientX;
                        startWidth = this.widget.offsetWidth;
                        startRight = rect.right;
                        document.addEventListener('mousemove', handleMouseMove);
                        document.addEventListener('mouseup', handleMouseUp);
                        e.preventDefault();
                        e.stopPropagation();
                        this.widget.style.cursor = 'ew-resize';
                        this.widget.style.userSelect = 'none';
                    }
                };

                const handleMouseMove = (e) => {
                    if (!isResizing) return;

                    console.log('[ModernWidget] üîÑ MouseMove during resize');
                    const deltaX = startX - e.clientX;
                    const newWidth = Math.max(400, Math.min(600, startWidth + deltaX));

                    console.log('[ModernWidget] üìè New width:', newWidth, 'Delta:', deltaX);

                    // –û–±–Ω–æ–≤–ª—è–µ–º —à–∏—Ä–∏–Ω—É –∏ –ø–æ–∑–∏—Ü–∏—é –≤–∏–¥–∂–µ—Ç–∞
                    this.widget.style.width = newWidth + 'px';
                    this.widget.style.right = (window.innerWidth - startRight + deltaX) + 'px';
                };

                const handleMouseUp = () => {
                    console.log('[ModernWidget] üñ±Ô∏è MouseUp - ending resize');
                    isResizing = false;
                    this.widget.style.cursor = 'default';
                    this.widget.style.userSelect = 'auto';
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                const handleMouseMoveOver = (e) => {
                    const rect = this.widget.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;

                    if (mouseX < 10) {
                        this.widget.style.cursor = 'ew-resize';
                        console.log('[ModernWidget] üëÜ Cursor changed to resize');
                    } else {
                        this.widget.style.cursor = 'default';
                    }
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫—É—Ä—Å–æ—Ä–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –º—ã—à–∏
                const handleMouseLeave = () => {
                    this.widget.style.cursor = 'default';
                    console.log('[ModernWidget] üëã Mouse left widget');
                };

                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                this.widget.addEventListener('mousedown', handleMouseDown, true);
                this.widget.addEventListener('mousemove', handleMouseMoveOver, true);
                this.widget.addEventListener('mouseleave', handleMouseLeave, true);

                // –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ —Å–∞–º —ç–ª–µ–º–µ–Ω—Ç resize-handle
                const resizeHandle = this.widget.querySelector('.resize-handle');
                if (resizeHandle) {
                    resizeHandle.addEventListener('mousedown', handleMouseDown, true);
                    resizeHandle.addEventListener('mouseover', () => {
                        this.widget.style.cursor = 'ew-resize';
                        console.log('[ModernWidget] üëÜ Cursor changed to resize (handle)');
                    }, true);
                    console.log('[ModernWidget] ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ resize-handle');
                }

                console.log('[ModernWidget] ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω —Å –æ—Ç–ª–∞–¥–∫–æ–π');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è:', error);
            }
        }

        toggleMinimize() {
            try {
                console.log('[ModernWidget] üìè –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞');

                this.isMinimized = !this.isMinimized;

                if (this.isMinimized) {
                    console.log('[ModernWidget] üìè –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç');
                    this.widget.classList.add('minimized');
                    this.widget.style.maxHeight = '70px';
                } else {
                    console.log('[ModernWidget] üìè –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç');
                    this.widget.classList.remove('minimized');
                    this.widget.style.maxHeight = '600px';
                }

                const icon = document.querySelector('#minimize-notifications i');
                if (icon) {
                    icon.className = this.isMinimized ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
                    console.log('[ModernWidget] üìè –ò–∫–æ–Ω–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞:', icon.className);
                }

                localStorage.setItem('notificationsMinimized', this.isMinimized);
                console.log('[ModernWidget] ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', this.isMinimized);
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ toggleMinimize:', error);
            }
        }

        closeWidget() {
            try {
                console.log('[ModernWidget] üîò –ó–∞–∫—Ä—ã—Ç–∏–µ –≤–∏–¥–∂–µ—Ç–∞...');

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤–∏–¥–∂–µ—Ç—É, –Ω–µ –∫ –∫–Ω–æ–ø–∫–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                this.widget.classList.add('hidden');
                this.widget.style.transform = 'translateX(200%)'; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 200%
                this.widget.style.opacity = '0';
                this.widget.style.pointerEvents = 'none'; // –û—Ç–∫–ª—é—á–∞–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
                this.widget.style.right = '-200px'; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ
                this.widget.style.clipPath = 'inset(0 100% 0 0)'; // –û–±—Ä–µ–∑–∞–µ–º –≤–∏–¥–∂–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

                setTimeout(() => {
                    this.widget.classList.add('closed');
                    this.widget.style.display = 'none';
                    this.widget.style.visibility = 'hidden'; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
                    localStorage.setItem('notificationsWidgetClosed', 'true');
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –±—ã–ª –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
                    localStorage.setItem('notificationsWidgetClosedByUser', 'true');

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                    setTimeout(() => {
                        this.showRestoreButton();
                        console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø–æ–∫–∞–∑–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è');
                    }, 100);

                }, 300);
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ closeWidget:', error);
            }
        }

        showWidget() {
            try {
                console.log('[ModernWidget] üîî –ü–æ–∫–∞–∑ –≤–∏–¥–∂–µ—Ç–∞...');

                // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –ë–î
                const widgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
                if (widgetDisabled) {
                    console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –≤ –ë–î, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º');
                    this.widget.style.display = 'none';
                    this.widget.classList.add('closed', 'initial-hidden');
                    this.widget.style.visibility = 'hidden';
                    this.widget.style.opacity = '0';
                    this.hideRestoreButton();
                    return;
                }

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –¥–∏–∑–∞–π–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è CSS
                this.widget.classList.remove('closed', 'hidden', 'initial-hidden');
                this.widget.classList.add('show');
                this.widget.style.setProperty('display', 'flex', 'important');
                this.widget.style.setProperty('visibility', 'visible', 'important');
                this.widget.style.setProperty('opacity', '1', 'important');
                this.widget.style.setProperty('transform', 'translateX(0)', 'important');
                this.widget.style.setProperty('clip-path', 'none', 'important');
                this.widget.style.setProperty('right', '20px', 'important');
                this.widget.style.setProperty('pointer-events', 'auto', 'important');
                this.widget.style.removeProperty('background');
                this.widget.style.removeProperty('background-image');
                this.widget.style.removeProperty('backdrop-filter');
                this.widget.style.removeProperty('border');
                this.widget.style.removeProperty('box-shadow');
                this.widget.style.removeProperty('font-family');

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º localStorage
                localStorage.setItem('notificationsWidgetClosed', 'false');
                localStorage.removeItem('notificationsWidgetClosedByUser');

                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                this.hideRestoreButton();

                // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                this.updateNotifications();

                console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ showWidget:', error);
            }
        }

        showRestoreButton() {
            try {
                const restoreBtn = document.getElementById('notifications-restore-btn');
                if (restoreBtn) {
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    restoreBtn.style.display = 'block';
                    restoreBtn.style.visibility = 'visible';
                    restoreBtn.style.opacity = '1';
                    restoreBtn.style.transform = 'none';
                    restoreBtn.style.right = '20px';
                    restoreBtn.style.bottom = '20px';
                    restoreBtn.style.position = 'fixed';
                    restoreBtn.style.zIndex = '999999';

                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    setTimeout(() => {
                        if (window.fixRestoreButton) {
                            window.fixRestoreButton();
                        }
                    }, 100);

                    console.log('[ModernWidget] ‚úÖ –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–∞');
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ showRestoreButton:', error);
            }
        }

        hideRestoreButton() {
            try {
                const restoreBtn = document.getElementById('notifications-restore-btn');
                if (restoreBtn) {
                    restoreBtn.style.display = 'none';
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ hideRestoreButton:', error);
            }
        }

        // –ù–û–í–´–ô –ú–ï–¢–û–î: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç–∞
        initializeAudio() {
            try {
                console.log('[ModernWidget] üîä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç–∞...');

                this.audio = new Audio("{{ url_for('static', filename='sounds/notification.mp3') }}");
                this.audio.volume = 0.5;
                this.audio.preload = 'auto';

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∞—É–¥–∏–æ
                this.audio.addEventListener('canplay', () => {
                    this.audioInitialized = true;
                    console.log('[ModernWidget] ‚úÖ –ê—É–¥–∏–æ –æ–±—ä–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
                });

                this.audio.addEventListener('error', (e) => {
                    console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞:', e);
                    this.audioInitialized = false;
                });

                this.audio.addEventListener('ended', () => {
                    console.log('[ModernWidget] ‚èπÔ∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
                });

                console.log('[ModernWidget] ‚úÖ –ê—É–¥–∏–æ –æ–±—ä–µ–∫—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ:', error);
                this.audio = null;
                this.audioInitialized = false;
            }
        }

        loadWidgetState() {
            try {
                const isClosed = localStorage.getItem('notificationsWidgetClosed') === 'true';
                const isMinimized = localStorage.getItem('notificationsMinimized') === 'true';
                const isDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
                const isWidgetClosedByUser = localStorage.getItem('notificationsWidgetClosedByUser') === 'true';

                console.log('[ModernWidget] üîß –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', { isClosed, isMinimized, isDisabled, isWidgetClosedByUser });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                this.checkNotificationStatusFromDB();

                // –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –±—ã–ª –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –∑–∞–∫—Ä—ã—Ç—ã–º –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                if (isWidgetClosedByUser) {
                    console.log('[ModernWidget] üîí –í–∏–¥–∂–µ—Ç –±—ã–ª –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–∫—Ä—ã—Ç—ã–º –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
                    this.widget.classList.add('closed', 'initial-hidden');
                    this.widget.style.display = 'none';
                    this.widget.style.visibility = 'hidden';
                    this.widget.style.opacity = '0';
                    this.showRestoreButton();
                    return;
                }

                if (isDisabled) {
                    console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω, —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∫–ª—é—á–∞—è –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è');
                    this.widget.style.display = 'none';
                    this.widget.classList.add('closed', 'initial-hidden');
                    this.hideRestoreButton();
                    return;
                }

                // –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –±—ã–ª –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
                this.widget.classList.remove('initial-hidden');
                this.widget.style.display = 'flex';
                this.widget.style.visibility = 'visible';
                this.widget.style.opacity = '1';
                this.widget.style.transform = 'translateX(0)';
                this.widget.style.clipPath = 'none';

                console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –ø–æ—è–≤–ª–µ–Ω–∏—é');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ loadWidgetState:', error);
            }
        }

        checkNotificationStatusFromDB() {
            try {
                console.log('[ModernWidget] üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');

                fetch('/api/notifications/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('[ModernWidget] üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ –ë–î:', data.enabled);

                        if (!data.enabled) {
                            console.log('[ModernWidget] üîï –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ –ë–î, —Å–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç');
                            this.widget.style.display = 'none';
                            this.widget.classList.add('closed', 'initial-hidden');
                            this.widget.style.visibility = 'hidden';
                            this.widget.style.opacity = '0';
                            this.hideRestoreButton();
                            localStorage.setItem('notificationsWidgetDisabled', 'true');
                        } else {
                            console.log('[ModernWidget] ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã –≤ –ë–î');
                            localStorage.removeItem('notificationsWidgetDisabled');
                        }
                    } else {
                        console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', data.error);
                    }
                })
                .catch(error => {
                    console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
                });
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ checkNotificationStatusFromDB:', error);
            }
        }

        adjustWidgetPosition() {
            try {
                const header = document.querySelector('nav, header, .navbar, .nav, .header');
                if (header) {
                    const headerHeight = header.offsetHeight;
                    const topOffset = Math.max(headerHeight + 40, 120);
                    this.widget.style.setProperty('top', `${topOffset}px`, 'important');
                    console.log(`[ModernWidget] Adjusted position: ${topOffset}px (header height: ${headerHeight}px)`);
                } else {
                    this.widget.style.setProperty('top', '120px', 'important');
                    console.log(`[ModernWidget] Header not found, using safe offset: 120px`);
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ adjustWidgetPosition:', error);
                this.widget.style.setProperty('top', '120px', 'important');
            }
        }

        forcePosition() {
            try {
                this.widget.style.setProperty('position', 'fixed', 'important');
                this.widget.style.setProperty('z-index', '999999', 'important');
                this.widget.style.setProperty('right', '20px', 'important');

                const rect = this.widget.getBoundingClientRect();
                console.log(`[ModernWidget] Position check:`, {
                    top: rect.top,
                    right: rect.right,
                    bottom: rect.bottom,
                    left: rect.left,
                    visible: rect.top >= 0 && rect.left >= 0
                });

                if (rect.top < 60) {
                    this.widget.style.setProperty('top', '120px', 'important');
                    console.log(`[ModernWidget] Widget was hidden, forced to 120px`);
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ forcePosition:', error);
            }
        }

        async startPolling() {
            try {
                setInterval(() => this.updateNotifications(), 30000);
                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –∏–∑ –ë–î (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥)
                setInterval(() => this.checkNotificationStatusFromDB(), 60000);
                this.updateNotifications();
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
                this.checkNotificationStatusFromDB();
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ startPolling:', error);
            }
        }

        async updateNotifications() {
            try {
                const isWidgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
                if (isWidgetDisabled) {
                    console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                    return;
                }

                console.log('[ModernWidget] üîÑ –ó–∞–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
                const response = await fetch('/api/notifications/poll');
                const data = await response.json();

                if (data.success) {
                    console.log(`[ModernWidget] üì° –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:`, data);

                    this.processNotifications(data.notifications);
                    const localCount = this.notifications.length;
                    const serverCount = data.total_count || 0;
                    const displayCount = Math.max(localCount, serverCount);

                    console.log(`[ModernWidget] üî¢ –°—á–µ—Ç—á–∏–∫–∏: –ª–æ–∫–∞–ª—å–Ω—ã–π=${localCount}, —Å–µ—Ä–≤–µ—Ä=${serverCount}, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º=${displayCount}`);
                    this.updateBadge(displayCount);
                } else {
                    console.warn('[ModernWidget] ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
            }
        }

        processNotifications(notifications) {
            try {
                this.notifications = [];
                const hasNewNotifications = (notifications.status_notifications && notifications.status_notifications.length > 0) ||
                                          (notifications.comment_notifications && notifications.comment_notifications.length > 0) ||
                                          (notifications.redmine_notifications && notifications.redmine_notifications.length > 0);

                const isWidgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
                const isWidgetClosed = localStorage.getItem('notificationsWidgetClosed') === 'true';
                const isWidgetClosedByUser = localStorage.getItem('notificationsWidgetClosedByUser') === 'true';

                // –û–¢–õ–ê–î–ö–ê: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
                console.log('[ModernWidget] üîç –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è:');
                console.log('- hasNewNotifications:', hasNewNotifications);
                console.log('- isWidgetDisabled:', isWidgetDisabled);
                console.log('- isWidgetClosed:', isWidgetClosed);
                console.log('- isWidgetClosedByUser:', isWidgetClosedByUser);
                console.log('- notifications.status_notifications:', notifications.status_notifications?.length || 0);
                console.log('- notifications.comment_notifications:', notifications.comment_notifications?.length || 0);
                console.log('- notifications.redmine_notifications:', notifications.redmine_notifications?.length || 0);

                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                if (hasNewNotifications && !isWidgetDisabled) {
                    console.log('[ModernWidget] üîî –ï—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç');

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –∑–∞–∫—Ä—ã—Ç
                    if (isWidgetClosed || this.widget.classList.contains('initial-hidden')) {
                        console.log('[ModernWidget] üîî –í–∏–¥–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ');
                        this.forceShowWidget();
                    } else {
                        console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç —É–∂–µ –æ—Ç–∫—Ä—ã—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ');
                    }

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ "–∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º" –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                    localStorage.removeItem('notificationsWidgetClosedByUser');

                    // –ú–∏–≥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –≤–∫–ª–∞–¥–∫–∏, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
                    this.blinkTabTitle();

                    // –ú–∏–≥–∞–µ–º –≤–∏–¥–∂–µ—Ç–æ–º –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è
                    this.blinkWidget();
                } else if (!hasNewNotifications) {
                    console.log('[ModernWidget] üì≠ –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');

                    // –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                    if (isWidgetClosed && isWidgetClosedByUser) {
                        console.log('[ModernWidget] üîí –í–∏–¥–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π - –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
                        return;
                    }
                }

                // –û–¢–õ–ê–î–ö–ê: –õ–æ–≥–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
                console.log('[ModernWidget] üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:');
                console.log('- Status notifications:', notifications.status_notifications?.length || 0);
                console.log('- Comment notifications:', notifications.comment_notifications?.length || 0);
                console.log('- Redmine notifications:', notifications.redmine_notifications?.length || 0);

                if (notifications.status_notifications) {
                    notifications.status_notifications.forEach(n => {
                        console.log(`[ModernWidget] üìù Status notification: #${n.issue_id} - ${n.old_status} ‚Üí ${n.new_status} (${n.date_created})`);
                        this.notifications.push({
                            id: `status_${n.id}`,
                            type: 'status-change',
                            title: `–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω: #${n.issue_id}`,
                            description: `–°—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å: ${n.old_status}, –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: ${n.new_status}`,
                            time: this.formatTime(n.date_created),
                            icon: 'fas fa-exchange-alt',
                            issue_id: n.issue_id,
                            raw: n // –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª—è–µ–º raw –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                        });
                    });
                }

                if (notifications.comment_notifications) {
                    notifications.comment_notifications.forEach(n => {
                        console.log(`[ModernWidget] üí¨ Comment notification: #${n.issue_id} - ${n.date_created}`);
                        this.notifications.push({
                            id: `comment_${n.id}`,
                            type: 'comment',
                            title: `–ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: #${n.issue_id}`,
                            description: this.truncate(n.notes, 100),
                            time: this.formatTime(n.date_created),
                            icon: 'fas fa-comment',
                            issue_id: n.issue_id,
                            raw: n
                        });
                    });
                }

                if (notifications.redmine_notifications) {
                    notifications.redmine_notifications.forEach(n => {
                        console.log(`[ModernWidget] üî• Redmine notification: #${n.redmine_issue_id} - ${n.created_at}`);
                        const descriptionDetails = n.issue_description ? ` ‚Äî ${this.truncate(n.issue_description.replace(/<.*?>/g, ''), 70)}` : '';
                        const isGroupNotification = !!n.is_group_notification;
                        let title = '';
                        let description = '';

                        const source = n.easy_email_to ? `–û—Ç: ${n.easy_email_to}` : '';

                        if (isGroupNotification) {
                            title = `–ó–∞–¥–∞—á–∞ –¥–ª—è –≥—Ä—É–ø–ø—ã: ${n.group_name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}`;
                            description = `<b>#${n.redmine_issue_id}</b>: ${n.issue_subject}${descriptionDetails}`;
                        } else {
                            title = '–í–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –∑–∞–¥–∞—á–∞';
                            description = `<b>#${n.redmine_issue_id}</b>: ${n.issue_subject}${descriptionDetails}`;
                        }

                        this.notifications.push({
                            id: `redmine_${n.id}`,
                            type: 'redmine-task',
                            title: title,
                            description: description,
                            time: this.formatTime(n.created_at),
                            icon: 'fas fa-tasks',
                            url: n.issue_url,
                            group_name: n.group_name,
                            source: source,
                            easy_email_to: n.easy_email_to,
                            raw: n // –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª—è–µ–º raw –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                        });
                    });
                }

                console.log(`[ModernWidget] üìã –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ${this.notifications.length}`);
                console.log('[ModernWidget] üìã –ü–æ—Ä—è–¥–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –º–∞—Å—Å–∏–≤–µ:');
                this.notifications.forEach((n, index) => {
                    console.log(`  ${index + 1}. ${n.type} - ${n.title} (${n.time})`);
                });

                                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
                const incomingIds = this.notifications.map(n => n.id);
                let seenIds = JSON.parse(localStorage.getItem('seenNotificationIds')) || [];

                // –ù–û–í–û–ï: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
                const maxHistorySize = 50;
                if (seenIds.length > maxHistorySize) {
                    seenIds = seenIds.slice(-30);
                    localStorage.setItem('seenNotificationIds', JSON.stringify(seenIds));
                    console.log('[ModernWidget] üßπ –û—á–∏—â–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è seen IDs, –æ—Å—Ç–∞–ª–æ—Å—å:', seenIds.length);
                }

                const newNotificationIds = incomingIds.filter(id => !seenIds.includes(id));

                // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–õ–Ø –ü–†–û–î–ê–ö–®–ï–ù–ê
                console.log('[ModernWidget] üêõ –ü–û–î–†–û–ë–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–õ–Ø –û–¢–õ–ê–î–ö–ò:');
                console.log('[ModernWidget] üêõ Incoming IDs –ø–æ–ª–Ω–æ—Å—Ç—å—é:', incomingIds);
                console.log('[ModernWidget] üêõ Seen IDs –ø–æ–ª–Ω–æ—Å—Ç—å—é:', seenIds);
                console.log('[ModernWidget] üêõ New IDs –ø–æ–ª–Ω–æ—Å—Ç—å—é:', newNotificationIds);

                // –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ ID
                incomingIds.forEach(id => {
                    const isSeen = seenIds.includes(id);
                    console.log(`[ModernWidget] üêõ ID ${id}: ${isSeen ? '–£–ñ–ï –í–ò–î–ï–õ–ò' : '–ù–û–í–´–ô'}`);
                });

                const now = Date.now();
                const lastNotificationCheck = parseInt(localStorage.getItem('lastNotificationCheck')) || 0;
                const lastSoundPlay = parseInt(localStorage.getItem('lastSoundPlay')) || 0;
                const minCheckInterval = 2000;
                const minSoundInterval = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –∑–≤—É–∫–∞–º–∏
                const timeSinceLastCheck = now - lastNotificationCheck;
                const timeSinceLastSound = now - lastSoundPlay;

                console.log('[ModernWidget] üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', {
                    incoming: incomingIds.length,
                    seen: seenIds.length,
                    new: newNotificationIds.length,
                    timeSinceLastCheck: timeSinceLastCheck,
                    timeSinceLastSound: timeSinceLastSound,
                    minCheckInterval: minCheckInterval,
                    minSoundInterval: minSoundInterval,
                    timestamp: new Date().toLocaleTimeString()
                });

                // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –ë–î
                const widgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
                if (widgetDisabled) {
                    console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫');
                    this.widget.style.display = 'none';
                    this.widget.classList.add('closed', 'initial-hidden');
                    this.widget.style.visibility = 'hidden';
                    this.widget.style.opacity = '0';
                    this.hideRestoreButton();
                    return; // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –µ—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω
                }

                // –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ë–æ–ª–µ–µ –ª–∏–±–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
                let shouldPlaySound = false;
                let soundReason = '';

                if (newNotificationIds.length > 0) {
                    if (timeSinceLastSound >= minSoundInterval) {
                        shouldPlaySound = true;
                        soundReason = '–ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è + –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–≤—É–∫–∞';
                    } else {
                        soundReason = `–ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–æ –∑–≤—É–∫ —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ (${timeSinceLastSound}–º—Å < ${minSoundInterval}–º—Å)`;
                    }
                } else if (this.notifications.length > 0 && seenIds.length === 0) {
                    // FALLBACK: –ï—Å–ª–∏ –Ω–µ—Ç seen –∑–∞–ø–∏—Å–µ–π –≤–æ–æ–±—â–µ, –Ω–æ –µ—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                    shouldPlaySound = true;
                    soundReason = 'Fallback: –ø–µ—Ä–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ seen)';
                } else if (this.notifications.length > 0 && timeSinceLastCheck > 30000) {
                    // FALLBACK: –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
                    shouldPlaySound = true;
                    soundReason = 'Fallback: –ø—Ä–æ—à–ª–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏';
                } else {
                    soundReason = '–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã';
                }

                console.log(`[ModernWidget] üîç –†–ï–®–ï–ù–ò–ï –û –ó–í–£–ö–ï: ${shouldPlaySound ? '–í–û–°–ü–†–û–ò–ó–í–û–î–ò–¢–¨' : '–ù–ï –í–û–°–ü–†–û–ò–ó–í–û–î–ò–¢–¨'}`);
                console.log(`[ModernWidget] üîç –ü–†–ò–ß–ò–ù–ê: ${soundReason}`);

                if (shouldPlaySound) {
                    console.log('[ModernWidget] üé∂ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∑–≤—É–∫–∞. –î–µ—Ç–∞–ª–∏:', {
                        newIds: newNotificationIds,
                        totalNotifications: this.notifications.length,
                        reason: soundReason
                    });
                    console.log('[ModernWidget] üîä –ò–Ω–∏—Ü–∏–∏—Ä—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞...');

                    this.playNotificationSound();
                    localStorage.setItem('lastSoundPlay', now.toString());

                    // –û–±–Ω–æ–≤–ª—è–µ–º seen IDs —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ
                    if (newNotificationIds.length > 0) {
                        const updatedSeenIds = [...seenIds, ...newNotificationIds];
                        localStorage.setItem('seenNotificationIds', JSON.stringify(updatedSeenIds));
                        console.log('[ModernWidget] üíæ –û–±–Ω–æ–≤–ª–µ–Ω—ã seen IDs (–≤—Å–µ–≥–æ:', updatedSeenIds.length, ')');
                    }

                    localStorage.setItem('lastNotificationCheck', now.toString());
                } else {
                    console.log(`[ModernWidget] üîá –ó–≤—É–∫ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è: ${soundReason}`);

                    // –í—Å—ë —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ ID –∫–∞–∫ seen
                    if (newNotificationIds.length > 0) {
                        const updatedSeenIds = [...seenIds, ...newNotificationIds];
                        localStorage.setItem('seenNotificationIds', JSON.stringify(updatedSeenIds));
                        console.log('[ModernWidget] üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–æ–≤—ã–µ seen IDs –±–µ–∑ –∑–≤—É–∫–∞');
                    }
                }

                this.renderNotifications();
                this.updateBadge(this.notifications.length);
                console.log(`[ModernWidget] üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ${this.notifications.length}`);
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
            this.initActionButtons();
        }

        renderNotifications() {
            try {
                console.log('[ModernWidget] üé® –ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
                console.log('[ModernWidget] üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:', this.notifications.length);

                if (this.notifications.length === 0) {
                    console.log('[ModernWidget] üì≠ –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ');
                    this.list.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-inbox"></i></div>
                            <p class="empty-text">–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω—ã</p>
                            <small class="empty-subtitle">–ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</small>
                        </div>
                    `;
                    return;
                }

                console.log('[ModernWidget] üìã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:');
                this.notifications.forEach((n, index) => {
                    console.log(`  ${index + 1}. ${n.type} - ${n.title} (${n.time})`);
                });

                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ –≤–≤–µ—Ä—Ö—É)
                const sortedNotifications = [...this.notifications].sort((a, b) => {
                    // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–∞ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                    const getTimestamp = (notification) => {
                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ï—Å–ª–∏ –µ—Å—Ç—å raw –¥–∞–Ω–Ω—ã–µ —Å date_created
                        if (notification.raw && notification.raw.date_created) {
                            const timestamp = new Date(notification.raw.date_created).getTime();
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º date_created –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }

                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ï—Å–ª–∏ –µ—Å—Ç—å raw –¥–∞–Ω–Ω—ã–µ —Å created_at (–¥–ª—è Redmine)
                        if (notification.raw && notification.raw.created_at) {
                            const timestamp = new Date(notification.raw.created_at).getTime();
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º created_at –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }

                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ü–∞—Ä—Å–∏–º –≤—Ä–µ–º—è –∏–∑ —Å—Ç—Ä–æ–∫–∏ "X –º–∏–Ω –Ω–∞–∑–∞–¥" –∏–ª–∏ "X —á –Ω–∞–∑–∞–¥"
                        const timeStr = notification.time;
                        if (timeStr === '–¢–æ–ª—å–∫–æ —á—Ç–æ') {
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º "–¢–æ–ª—å–∫–æ —á—Ç–æ" –¥–ª—è ${notification.title}: ${Date.now()}`);
                            return Date.now();
                        }
                        if (timeStr.includes('–º–∏–Ω –Ω–∞–∑–∞–¥')) {
                            const minutes = parseInt(timeStr.match(/\d+/)[0]);
                            const timestamp = Date.now() - (minutes * 60 * 1000);
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º "–º–∏–Ω –Ω–∞–∑–∞–¥" –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }
                        if (timeStr.includes('—á –Ω–∞–∑–∞–¥')) {
                            const hours = parseInt(timeStr.match(/\d+/)[0]);
                            const timestamp = Date.now() - (hours * 60 * 60 * 1000);
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º "—á –Ω–∞–∑–∞–¥" –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }
                        if (timeStr.includes('–¥ –Ω–∞–∑–∞–¥')) {
                            const days = parseInt(timeStr.match(/\d+/)[0]);
                            const timestamp = Date.now() - (days * 24 * 60 * 60 * 1000);
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º "–¥ –Ω–∞–∑–∞–¥" –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }

                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY
                        const dateParts = timeStr.match(/(\d{2})\.(\d{2})\.(\d{4})/);
                        if (dateParts) {
                            const timestamp = new Date(dateParts[3], dateParts[2] - 1, dateParts[1]).getTime();
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º DD.MM.YYYY –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }

                        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO (YYYY-MM-DDTHH:MM:SS)
                        if (timeStr.includes('T') && timeStr.includes('-')) {
                            const timestamp = new Date(timeStr).getTime();
                            console.log(`[ModernWidget] üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º ISO —Ñ–æ—Ä–º–∞—Ç –¥–ª—è ${notification.title}: ${timestamp}`);
                            return timestamp;
                        }

                        console.log(`[ModernWidget] ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –¥–ª—è ${notification.title}, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è`);
                        return Date.now(); // Fallback
                    };

                    const timestampA = getTimestamp(a);
                    const timestampB = getTimestamp(b);

                    console.log(`[ModernWidget] üîÑ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: ${a.title} (${a.time}) = ${timestampA}, ${b.title} (${b.time}) = ${timestampB}`);

                    return timestampB - timestampA; // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
                });

                console.log('[ModernWidget] üîÑ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)');
                console.log('[ModernWidget] üìã –ü–æ—Ä—è–¥–æ–∫ –ø–æ—Å–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:');
                sortedNotifications.forEach((n, index) => {
                    console.log(`  ${index + 1}. ${n.type} - ${n.title} (${n.time})`);
                });

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏—è —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–¥–∞—á
                const formatDescription = (description) => {
                    if (!description) return '';
                    // –ó–∞–º–µ–Ω—è–µ–º #—á–∏—Å–ª–æ –Ω–∞ span —Å –∫–ª–∞—Å—Å–æ–º issue-id
                    return description.replace(/(#\d+)/g, '<span class="issue-id">$1</span>');
                };

                this.list.innerHTML = sortedNotifications.map(notification => {
                    console.log('[ModernWidget] Notification data:', notification); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    const formattedDescription = formatDescription(notification.description);
                    return `
                    <div class="notification-item ${notification.type}" data-id="${notification.id}">
                        <div class="notification-content">
                            <div class="notification-icon ${notification.type}"><i class="${notification.icon}"></i></div>
                            <div class="notification-text">
                                <div class="notification-title">${notification.title}</div>
                                <div class="notification-description">${formattedDescription}</div>
                                ${notification.source ? `
                                <div class="notification-source">
                                    <i class="far fa-envelope"></i>
                                    <span>${notification.source}</span>
                                </div>
                                ` : ''}
                                <div class="notification-time">${notification.time}</div>
                                ${notification.type === 'redmine-task' ? `
                                <div class="notification-actions">
                                    <button class="notification-action-btn mark-read-btn" data-id="${notification.id}" data-type="redmine-task">
                                        <i class="fas fa-check-circle"></i>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ
                                    </button>
                                    <a href="${notification.url}" target="_blank" class="notification-action-btn redmine-link-btn">
                                        <i class="fas fa-external-link-alt"></i>–û—Ç–∫—Ä—ã—Ç—å –≤ Redmine
                                    </a>
                                </div>
                                ` : ''}
                                ${(notification.type === 'status-change' || notification.type === 'comment') && notification.issue_id ? `
                                <div class="notification-actions">
                                    <button class="notification-action-btn mark-read-btn" data-id="${notification.id}" data-type="${notification.type}">
                                        <i class="fas fa-check-circle"></i>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ
                                    </button>
                                    <a href="http://helpdesk.teztour.com/issues/${notification.issue_id}" target="_blank" class="notification-action-btn redmine-link-btn">
                                        <i class="fas fa-external-link-alt"></i>–û—Ç–∫—Ä—ã—Ç—å –≤ Redmine
                                    </a>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `}).join('');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
                if (this.list) {
                    this.list.innerHTML = '<div class="error-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>';
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
            this.initActionButtons();
        }

        initActionButtons() {
            try {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const oldButtons = this.list.querySelectorAll('.mark-read-btn');
                oldButtons.forEach(btn => {
                    btn.replaceWith(btn.cloneNode(true));
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const markReadButtons = this.list.querySelectorAll('.mark-read-btn');
                markReadButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        const notificationId = button.getAttribute('data-id');
                        const notificationType = button.getAttribute('data-type');
                        const notificationItem = button.closest('.notification-item');

                        console.log(`[ModernWidget] –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" –Ω–∞–∂–∞—Ç–∞ –¥–ª—è: ${notificationId}, —Ç–∏–ø: ${notificationType}`);

                        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                        const originalContent = button.innerHTML;
                        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>–û—Ç–º–µ—á–∞–µ–º...';
                        button.disabled = true;

                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º API –∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞
                        let apiUrl;
                        let requestData;

                        if (notificationType === 'redmine-task') {
                            apiUrl = '/api/notifications/redmine/mark-read';
                            requestData = { notification_id: notificationId.replace('redmine_', '') };
                        } else {
                            apiUrl = '/api/notifications/mark-read';
                            requestData = { notification_id: notificationId, notification_type: notificationType };
                        }

                        console.log(`[ModernWidget] –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ ${apiUrl} —Å –¥–∞–Ω–Ω—ã–º–∏:`, requestData);

                        fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.content || ''
                            },
                            body: JSON.stringify(requestData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                console.log(`[ModernWidget] ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ${notificationId} –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ`);

                                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ–± —É—Å–ø–µ—Ö–µ
                                button.innerHTML = '<i class="fas fa-check"></i>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ';
                                button.style.background = '#10b981';
                                button.style.color = 'white';
                                button.style.borderColor = '#10b981';

                                setTimeout(() => {
                                    if (notificationItem) {
                                        notificationItem.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                                        notificationItem.style.opacity = '0';
                                        notificationItem.style.transform = 'scale(0.95)';

                                        setTimeout(() => {
                                                                        // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–∑ –º–∞—Å—Å–∏–≤–∞
                            this.notifications = this.notifications.filter(n => n.id !== notificationId);
                            this.renderNotifications();
                            this.updateBadge(this.notifications.length);

                            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –í–∏–¥–∂–µ—Ç –±–æ–ª—å—à–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
                            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ –∏ –≤–∏–¥–∂–µ—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
                                        }, 400);
                                    }
                                }, 1000);
                            } else {
                                console.error(`[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${data.error}`);
                                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                                button.innerHTML = originalContent;
                                button.disabled = false;
                                alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ: ${data.error}`);
                            }
                        })
                        .catch(error => {
                            console.error(`[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç–º–µ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:`, error);
                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                            button.innerHTML = originalContent;
                            button.disabled = false;
                            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
                        });
                    });
                });

                console.log(`[ModernWidget] ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è ${markReadButtons.length} –∫–Ω–æ–ø–æ–∫ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ"`);
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫:', error);
            }
        }

        updateBadge(count) {
            try {
                console.log(`[ModernWidget] üî¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞: ${count}`);

                if (!this.badge) this.badge = document.getElementById('notification-count-badge');
                if (!this.subtitle) this.subtitle = document.getElementById('notification-subtitle');

                if (this.badge) {
                    this.badge.textContent = count;
                    this.badge.style.display = count > 0 ? 'flex' : 'none';
                    console.log(`[ModernWidget] ‚úÖ Badge –æ–±–Ω–æ–≤–ª–µ–Ω: ${count}, –≤–∏–¥–∏–º–æ—Å—Ç—å: ${count > 0 ? '–ø–æ–∫–∞–∑–∞–Ω' : '—Å–∫—Ä—ã—Ç'}`);
                } else {
                    console.warn('[ModernWidget] ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç badge (notification-count-badge) –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                if (this.subtitle) {
                    // –õ–æ–≥–∏–∫–∞ —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
                    // 1 - "1 –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
                    // 2-4 - "2 –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
                    // 5-20 - "5 –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
                    const text = count > 0 ? this.declension(count) : '–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π';
                    this.subtitle.textContent = text;
                    console.log(`[ModernWidget] ‚úÖ Subtitle –æ–±–Ω–æ–≤–ª–µ–Ω: "${text}"`);
                } else {
                    console.warn('[ModernWidget] ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç subtitle (notification-subtitle) –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                const bellIcon = document.getElementById('notification-bell-icon');
                if (bellIcon) {
                    if (count > 0) {
                        bellIcon.classList.add('has-notifications');
                        bellIcon.style.animation = 'bellShake 0.5s ease-in-out';
                        setTimeout(() => {
                            bellIcon.style.animation = '';
                        }, 500);
                    } else {
                        bellIcon.classList.remove('has-notifications');
                    }
                }

                /* === –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –±–µ–π–¥–∂ –≤ —à–∞–ø–∫–µ === */
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è badge:', error);
            }
        }

        formatTime(dateString) {
            try {
                if (!dateString) return '–¢–æ–ª—å–∫–æ —á—Ç–æ';
                const date = new Date(dateString);
                const now = new Date();
                const diff = now - date;

                if (diff < 60000) return '–¢–æ–ª—å–∫–æ —á—Ç–æ';
                if (diff < 3600000) return `${Math.floor(diff / 60000)} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)} —á –Ω–∞–∑–∞–¥`;

                return date.toLocaleDateString('ru-RU');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', error);
                return '–¢–æ–ª—å–∫–æ —á—Ç–æ';
            }
        }

        truncate(text, length) {
            if (!text || typeof text !== 'string') {
                return '';
            }
            if (text.length <= length) {
                return text;
            }
            return text.substring(0, length).trim() + '...';
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        declension(count) {
            // –§–æ—Ä–º–∞—Ç—ã: one - 1, few - 2-4, many - 5-20
            const cases = [2, 0, 1, 1, 1, 2];
            const titles = ['–Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ', '–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', '–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π'];
            
            if (count % 100 > 4 && count % 100 < 21) {
                return `${count} ${titles[2]}`;
            }
            
            return `${count} ${titles[cases[count % 10 < 5 ? count % 10 : 5]]}`;
        }

        playNotificationSound() {
            try {
                console.log('[ModernWidget] üîä –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...');

                // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ –ë–î
                const widgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
                if (widgetDisabled) {
                    console.log('[ModernWidget] üîá –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –≤ –ë–î, –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫');
                    return;
                }

                // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –º–µ–∂–¥—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º–∏
                const now = Date.now();
                if (now - this.lastPlayAttempt < this.minPlayInterval) {
                    console.log(`[ModernWidget] üîá –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (–∏–Ω—Ç–µ—Ä–≤–∞–ª: ${now - this.lastPlayAttempt}–º—Å < ${this.minPlayInterval}–º—Å), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);
                    return;
                }
                this.lastPlayAttempt = now;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
                const soundDisabled = localStorage.getItem('notificationSoundDisabled') === 'true';
                if (soundDisabled) {
                    console.log('[ModernWidget] üîá –ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ');
                    return;
                }

                // –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç–∞
                if (!this.audio) {
                    console.warn('[ModernWidget] ‚ö†Ô∏è –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback');
                    this.fallbackNotificationSound();
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                const isVisible = document.visibilityState === 'visible';
                const hasFocus = document.hasFocus();
                console.log('[ModernWidget] üìä –°—Ç–∞—Ç—É—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', {
                    visibility: document.visibilityState,
                    hasFocus: hasFocus,
                    audioInitialized: this.audioInitialized,
                    timestamp: new Date().toLocaleTimeString()
                });

                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç
                try {
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                    this.audio.currentTime = 0;

                    const playPromise = this.audio.play();

                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('[ModernWidget] ‚úÖ –ó–≤—É–∫ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç');
                        }).catch(e => {
                            this.handleAudioError(e);
                        });
                    } else {
                        console.warn('[ModernWidget] ‚ö†Ô∏è audio.play() –Ω–µ –≤–µ—Ä–Ω—É–ª Promise');
                    }

                    console.log('[ModernWidget] üîä –ö–æ–º–∞–Ω–¥–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç)');
                } catch (playError) {
                    console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç:', playError);
                    this.fallbackNotificationSound();
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ playNotificationSound:', error);
                this.fallbackNotificationSound();
            }
        }

        // –ù–û–í–´–ô –ú–ï–¢–û–î: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É–¥–∏–æ
        handleAudioError(error) {
            switch (error.name) {
                case 'NotAllowedError':
                    console.log('[ModernWidget] üîí –ó–≤—É–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º - —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    sessionStorage.setItem('audioBlocked', 'true');
                    break;
                case 'NotSupportedError':
                    console.error('[ModernWidget] ‚ùå –§–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', error);
                    break;
                case 'AbortError':
                    console.log('[ModernWidget] ‚èπÔ∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:', error);
                    break;
                default:
                    console.error('[ModernWidget] ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error.name, error.message);
            }
        }

        // –ù–æ–≤—ã–π fallback –º–µ—Ç–æ–¥ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π
        fallbackNotificationSound() {
            try {
                console.log('[ModernWidget] üîÑ –ü–æ–ø—ã—Ç–∫–∞ fallback –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞...');
                // –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–ø–æ—Å–æ–± –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                const simpleAudio = new Audio('/static/sounds/notification.mp3');
                simpleAudio.volume = 0.3; // –ú–µ–Ω—å—à–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è fallback
                simpleAudio.play().catch(() => {
                    console.log('[ModernWidget] üîá Fallback –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç–∞–∫–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ');
                });
            } catch (fallbackError) {
                console.error('[ModernWidget] ‚ùå –î–∞–∂–µ fallback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', fallbackError);
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ
        setupAudioUnblockHandler() {
            try {
                console.log('[ModernWidget] üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ...');

                const unlockAudio = () => {
                    const audioBlocked = sessionStorage.getItem('audioBlocked') === 'true';
                    if (audioBlocked) {
                        console.log('[ModernWidget] üîì –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');

                        try {
                            // –¢–∏—Ö–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤—É–∫ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                            const testAudio = new Audio("{{ url_for('static', filename='sounds/notification.mp3') }}");
                            testAudio.volume = 0.01; // –û—á–µ–Ω—å —Ç–∏—Ö–æ
                            testAudio.play().then(() => {
                                console.log('[ModernWidget] ‚úÖ –ê—É–¥–∏–æ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!');
                                sessionStorage.removeItem('audioBlocked');
                                // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                                document.removeEventListener('click', unlockAudio);
                                document.removeEventListener('keydown', unlockAudio);
                                document.removeEventListener('touchstart', unlockAudio);
                            }).catch((e) => {
                                if (e.name !== 'NotAllowedError') {
                                    console.log('[ModernWidget] üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –Ω–æ —ç—Ç–æ –Ω–µ NotAllowedError');
                                    sessionStorage.removeItem('audioBlocked');
                                }
                            });
                        } catch (error) {
                            console.warn('[ModernWidget] ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
                        }
                    }
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
                document.addEventListener('click', unlockAudio, { once: false });
                document.addEventListener('keydown', unlockAudio, { once: false });
                document.addEventListener('touchstart', unlockAudio, { once: false });

                console.log('[ModernWidget] ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
            }
        }

        openNotificationSettings() {
            try {
                console.log('[ModernWidget] ‚öôÔ∏è –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
                const settingsUrl = '/notifications-polling';
                const settingsBtn = document.getElementById('notification-settings');
                if (settingsBtn) {
                    settingsBtn.style.transform = 'scale(0.95)';
                    settingsBtn.style.opacity = '0.7';
                    setTimeout(() => {
                        settingsBtn.style.transform = 'scale(1)';
                        settingsBtn.style.opacity = '1';
                    }, 150);
                }
                window.location.href = settingsUrl;
                console.log('[ModernWidget] ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ /notifications-polling –≤—Ä—É—á–Ω—É—é.');
            }
        }

                async clearNotifications() {
            try {
                if (!confirm('–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ? –û–Ω–∏ –∏—Å—á–µ–∑–Ω—É—Ç –∏–∑ –≤–∏–¥–∂–µ—Ç–∞.')) return;

                console.log('[ModernWidget] üßπ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö...');

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
                const response = await fetch('/api/notifications/mark-all-read', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.content || ''
                    }
                });

                const data = await response.json();

                if (data.success) {
                    console.log('[ModernWidget] ‚úÖ –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ');

                    // –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–º–µ—Ç–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    this.notifications = [];
                    this.renderNotifications();
                    this.updateBadge(0);
                    localStorage.removeItem('seenNotificationIds');

                    console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç –æ—á–∏—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ—Å–ª–µ –æ—Ç–º–µ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö.');

                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    this.widget.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        this.widget.style.transform = 'scale(1)';
                    }, 200);
                } else {
                    console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:', data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ: ${data.error || '–°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }

            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Ç–º–µ—Ç–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö.');
            }
        }

        async markRedmineNotificationAsRead(notificationId) {
            try {
                const response = await fetch('/api/notifications/redmine/mark-read', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.content || ''
                    },
                    body: JSON.stringify({ notification_id: notificationId })
                });
                const data = await response.json();

                if (data.success) {
                    console.log(`[ModernWidget] ‚úÖ Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ${notificationId} –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ`);
                    const itemToRemove = this.list.querySelector(`.notification-item[data-id="redmine_${notificationId}"]`);
                    if (itemToRemove) {
                        itemToRemove.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                        itemToRemove.style.opacity = '0';
                        itemToRemove.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.notifications = this.notifications.filter(n => n.id !== `redmine_${notificationId}`);
                            this.renderNotifications();
                            this.updateBadge(this.notifications.length);
                        }, 400);
                    } else {
                        this.notifications = this.notifications.filter(n => n.id !== `redmine_${notificationId}`);
                        this.renderNotifications();
                        this.updateBadge(this.notifications.length);
                    }
                } else {
                    console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ:', data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ: ${data.error || '–°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ Redmine —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ.');
            }
        }

        blinkTabTitle() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –≤–∫–ª–∞–¥–∫–∞
                if (document.hidden) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –º–∏–≥–∞–µ—Ç –ª–∏ —É–∂–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    if (document.title.includes('üÜï –ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è!')) {
                        console.log('[ModernWidget] ‚ÑπÔ∏è –ú–∏–≥–∞–Ω–∏–µ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
                        return;
                    }

                    console.log('[ModernWidget] üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –º–∏–≥–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤–∫–ª–∞–¥–∫–∏');

                    const originalTitle = document.title;

                    const blinkInterval = setInterval(() => {
                        if (document.title === originalTitle) {
                            document.title = 'üÜï –ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è! - ' + originalTitle;
                        } else {
                            document.title = originalTitle;
                        }
                    }, 800); // –ú–∏–≥–∞–µ–º –∫–∞–∂–¥—ã–µ 800–º—Å

                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–≥–∞–Ω–∏–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∫–ª–∞–¥–∫–∏
                    const stopBlinking = () => {
                        if (!document.hidden) {
                            clearInterval(blinkInterval);
                            document.title = originalTitle;
                            document.removeEventListener('visibilitychange', stopBlinking);
                            console.log('[ModernWidget] ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –º–∏–≥–∞–Ω–∏–µ - –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                        }
                    };

                    document.addEventListener('visibilitychange', stopBlinking);
                } else {
                    console.log('[ModernWidget] ‚ÑπÔ∏è –í–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –º–∏–≥–∞–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ');
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –º–∏–≥–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤–∫–ª–∞–¥–∫–∏:', error);
            }
        }

        blinkWidget() {
            try {
                console.log('[ModernWidget] üîÑ –ú–∏–≥–∞–µ–º –≤–∏–¥–∂–µ—Ç–æ–º –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è');

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –º–∏–≥–∞–Ω–∏—è
                this.widget.classList.add('blink');

                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å —á–µ—Ä–µ–∑ 500–º—Å
                setTimeout(() => {
                    this.widget.classList.remove('blink');
                }, 500);

            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –º–∏–≥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', error);
            }
        }

        forceShowWidget() {
            try {
                console.log('[ModernWidget] üîî –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞');

                // –û–¢–õ–ê–î–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                console.log('[ModernWidget] üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –î–û forceShowWidget:');
                console.log('- display:', this.widget.style.display);
                console.log('- visibility:', this.widget.style.visibility);
                console.log('- opacity:', this.widget.style.opacity);
                console.log('- transform:', this.widget.style.transform);
                console.log('- classes:', this.widget.className);

                // –£–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å—ã/—Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∫—Ä—ã—Ç–∏—è, –≤–∏–∑—É–∞–ª—å–Ω—É—é —Ç–µ–º—É –æ—Å—Ç–∞–≤–ª—è–µ–º –≤ CSS
                this.widget.classList.remove('initial-hidden', 'hidden', 'closed');
                this.widget.classList.add('show');
                this.widget.style.setProperty('display', 'flex', 'important');
                this.widget.style.setProperty('visibility', 'visible', 'important');
                this.widget.style.setProperty('opacity', '1', 'important');
                this.widget.style.setProperty('position', 'fixed', 'important');
                this.widget.style.setProperty('top', '102px', 'important');
                this.widget.style.setProperty('right', '20px', 'important');
                this.widget.style.setProperty('z-index', '999999', 'important');
                this.widget.style.setProperty('transform', 'translateX(0)', 'important');
                this.widget.style.setProperty('clip-path', 'none', 'important');
                this.widget.style.setProperty('pointer-events', 'auto', 'important');
                this.widget.style.removeProperty('background');
                this.widget.style.removeProperty('background-image');
                this.widget.style.removeProperty('background-color');
                this.widget.style.removeProperty('backdrop-filter');
                this.widget.style.removeProperty('border');
                this.widget.style.removeProperty('box-shadow');
                this.widget.style.removeProperty('font-family');

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º localStorage
                localStorage.setItem('notificationsWidgetClosed', 'false');
                localStorage.removeItem('notificationsWidgetClosedByUser');

                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                this.hideRestoreButton();

                // –û–¢–õ–ê–î–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                console.log('[ModernWidget] üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –ü–û–°–õ–ï forceShowWidget:');
                console.log('- display:', this.widget.style.display);
                console.log('- visibility:', this.widget.style.visibility);
                console.log('- opacity:', this.widget.style.opacity);
                console.log('- transform:', this.widget.style.transform);
                console.log('- classes:', this.widget.className);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∏–¥–∏–º
                const rect = this.widget.getBoundingClientRect();
                console.log('[ModernWidget] üìç –ü–æ–∑–∏—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞:', rect);
                console.log('[ModernWidget] üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å:', this.widget.offsetParent !== null ? '–í–∏–¥–∏–º—ã–π' : '–°–∫—Ä—ã—Ç—ã–π');

                // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                this.updateNotifications();

                console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –≤–∏–¥–∂–µ—Ç–∞:', error);
            }
        }

        // –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∫–∞–∑ –≤–∏–¥–∂–µ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        testShowWidget() {
            console.log('[ModernWidget] üß™ –¢–ï–°–¢: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∫–∞–∑ –≤–∏–¥–∂–µ—Ç–∞');
            this.forceShowWidget();
        }

        // –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π –≤–∏–¥–∂–µ—Ç–∞
        resetWidgetStyles() {
            console.log('[ModernWidget] üß™ –¢–ï–°–¢: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –≤–∏–¥–∂–µ—Ç–∞');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞
            const widgetElement = document.getElementById('modern-notifications-widget');
            if (!widgetElement) {
                console.error('[ModernWidget] ‚ùå –≠–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM');
                return;
            }

            console.log('[ModernWidget] üîç –ù–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞:', widgetElement);
            console.log('[ModernWidget] üîç –¢–µ–∫—É—â–∏–µ –∫–ª–∞—Å—Å—ã:', widgetElement.className);
            console.log('[ModernWidget] üîç –¢–µ–∫—É—â–∏–µ —Å—Ç–∏–ª–∏:', widgetElement.style.cssText);

            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –í–°–ï –∫–ª–∞—Å—Å—ã, –≤–∫–ª—é—á–∞—è initial-hidden
            widgetElement.className = 'modern-notifications-widget';

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –ø–æ–º–æ—â—å—é !important
            widgetElement.style.cssText = `
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
                position: fixed !important;
                top: 120px !important;
                right: 20px !important;
                width: 480px !important;
                min-width: 400px !important;
                max-width: 600px !important;
                max-height: 600px !important;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
                backdrop-filter: blur(20px) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                border-radius: 24px !important;
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 12px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
                flex-direction: column !important;
                pointer-events: auto !important;
                font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
                transform: none !important;
                clip-path: none !important;
                z-index: 999999 !important;
            `;

            console.log('[ModernWidget] ‚úÖ –°—Ç–∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–æ—à–µ–Ω—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
            console.log('[ModernWidget] üîç –ù–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã:', widgetElement.className);
            console.log('[ModernWidget] üîç –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏:', widgetElement.style.cssText);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∏–¥–∏–º
            const rect = widgetElement.getBoundingClientRect();
            console.log('[ModernWidget] üìç –ü–æ–∑–∏—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞:', rect);
            console.log('[ModernWidget] üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å:', widgetElement.offsetParent !== null ? '–í–∏–¥–∏–º—ã–π' : '–°–∫—Ä—ã—Ç—ã–π');

            if (notificationsWidget) {
                notificationsWidget.resetWidgetStyles();
            }
        }
    }

    let notificationsWidget = null;

    // –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
    window.testNotificationsWidget = function() {
        console.log('[ModernWidget] üß™ –¢–ï–°–¢: –í—ã–∑–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞');
        if (notificationsWidget) {
            notificationsWidget.testShowWidget();
        } else {
            console.error('[ModernWidget] ‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        try {
            if (document.body.classList.contains('logged-in')) {
                initializeWidgetWithUserPreferences();
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ DOMContentLoaded:', error);
        }
    });

    async function initializeWidgetWithUserPreferences() {
        try {
            const localWidgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
            console.log('[ModernWidget] üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage –Ω–∞—Å—Ç—Ä–æ–µ–∫:', { widgetDisabled: localWidgetDisabled });

            if (localWidgetDisabled) {
                console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –≤ localStorage, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
                const widget = document.getElementById('modern-notifications-widget');
                if (widget) {
                    widget.style.display = 'none';
                    widget.classList.add('closed');
                }
                const restoreBtn = document.getElementById('notifications-restore-btn');
                if (restoreBtn) {
                    restoreBtn.style.display = 'none';
                    console.log('[ModernWidget] üîï –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º –≤–∏–¥–∂–µ—Ç–µ');
                }
                return;
            }

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
            const response = await fetch('/api/notifications/status');
            const data = await response.json();

            if (data.success) {
                if (!data.enabled) {
                    console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
                    localStorage.setItem('notificationsWidgetDisabled', 'true');
                    const widget = document.getElementById('modern-notifications-widget');
                    if (widget) {
                        widget.style.display = 'none';
                        widget.classList.add('closed', 'initial-hidden');
                        widget.style.visibility = 'hidden';
                        widget.style.opacity = '0';
                    }
                    const restoreBtn = document.getElementById('notifications-restore-btn');
                    if (restoreBtn) {
                        restoreBtn.style.display = 'none';
                    }
                    return;
                } else {
                    console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç –≤–∫–ª—é—á–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    localStorage.removeItem('notificationsWidgetDisabled');
                }
            } else {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞:', data.error);
            }

            localStorage.setItem('notificationsWidgetDisabled', 'false');
            initializeWidget();

        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            const localWidgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
            if (localWidgetDisabled) {
                console.log('[ModernWidget] üîï –í–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ä–≤–µ—Ä–∞');
                const widget = document.getElementById('modern-notifications-widget');
                if (widget) widget.style.display = 'none';
                const restoreBtn = document.getElementById('notifications-restore-btn');
                if (restoreBtn) {
                    restoreBtn.style.display = 'none';
                    console.log('[ModernWidget] üîï –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ (–≤–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω)');
                }
                return;
            }

            localStorage.setItem('notificationsWidgetDisabled', 'false');
            initializeWidget();
        }
    }

    function initializeWidget() {
        try {
                try {
                    const widget = document.getElementById('modern-notifications-widget');
                    const list = document.getElementById('notifications-list');
                    const badge = document.getElementById('notification-count-badge');

                    if (!widget || !list || !badge) {
                        console.warn('[ModernWidget] ‚ö†Ô∏è –ù–µ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É');
                        if (widget) {
                            widget.classList.remove('initial-hidden');
                            widget.style.display = 'flex';
                        }
                        setTimeout(initializeWidget, 1000);
                        return;
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–æ–∑–¥–∞–Ω –ª–∏ —É–∂–µ –≤–∏–¥–∂–µ—Ç
                    if (!notificationsWidget) {
                        notificationsWidget = new ModernNotificationsWidget();
                        window.notificationsWidget = notificationsWidget;
                    }
                    window.testNotificationSound = () => {
                        console.log('üîä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤—É–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...');
                        notificationsWidget.playNotificationSound();
                    };

                    console.log('üéµ –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–≤—É–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: testNotificationSound() –∏–ª–∏ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –∏–∫–æ–Ω–∫–µ –≤–∏–¥–∂–µ—Ç–∞');
                    console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π');

                } catch (error) {
                    console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    const widget = document.getElementById('modern-notifications-widget');
                    if (widget) {
                        widget.classList.remove('initial-hidden');
                        widget.style.display = 'flex';
                    }
                }

        } catch (error) {
            console.error('[ModernWidget] ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–∂–µ—Ç–∞:', error);
            const widget = document.getElementById('modern-notifications-widget');
            if (widget) {
                widget.classList.remove('initial-hidden');
                widget.style.display = 'flex';
            }
        }
    }

    window.showNotificationsWidget = () => {
        try {
            if (notificationsWidget) notificationsWidget.showWidget();
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ showNotificationsWidget:', error);
        }
    };

    window.hideNotificationsWidget = () => {
        try {
            if (notificationsWidget) notificationsWidget.closeWidget();
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ hideNotificationsWidget:', error);
        }
    };

    window.playNotificationSound = () => {
        try {
            console.log('[Global] üîä –ì–ª–æ–±–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ playNotificationSound...');

            const soundDisabled = localStorage.getItem('notificationSoundDisabled') === 'true';
            if (soundDisabled) {
                console.log('[Global] üîá –ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ');
                return;
            }

            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
            const audioBlocked = sessionStorage.getItem('audioBlocked') === 'true';
            if (audioBlocked) {
                console.log('[Global] üîá –ê—É–¥–∏–æ —Ä–∞–Ω–µ–µ –±—ã–ª–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º');
            }

            if (notificationsWidget) {
                console.log('[Global] ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ –≤–∏–¥–∂–µ—Ç–∞');
                notificationsWidget.playNotificationSound();
            } else {
                console.log('[Global] üîÑ –í–∏–¥–∂–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π fallback');
                try {
                    const audio = new Audio("{{ url_for('static', filename='sounds/notification.mp3') }}");
                    audio.volume = 0.5;

                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('[Global] ‚úÖ Fallback –∑–≤—É–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                        }).catch(e => {
                            if (e.name === 'NotAllowedError') {
                                console.log('[Global] üîá Fallback –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º');
                                sessionStorage.setItem('audioBlocked', 'true');
                            } else {
                                console.warn('[Global] ‚ö†Ô∏è –û—à–∏–±–∫–∞ fallback –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e.name, e.message);
                            }
                        });
                    }

                    console.log('[Global] üîä –ö–æ–º–∞–Ω–¥–∞ fallback –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
                } catch (error) {
                    console.error('[Global] ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è fallback –∞—É–¥–∏–æ:', error);
                }
            }
        } catch (error) {
            console.error('[Global] ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ playNotificationSound:', error);
        }
    };

    window.modernNotificationsWidget = {
        refreshNotifications: () => {
            try {
                if (notificationsWidget) notificationsWidget.updateNotifications();
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ refreshNotifications:', error);
            }
        },
        showWidget: () => {
            try {
                if (notificationsWidget) notificationsWidget.showWidget();
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –≤ showWidget:', error);
            }
        },
        testSound: () => {
            try {
                console.log('[ModernWidget] üîä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤—É–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
                if (notificationsWidget) {
                    notificationsWidget.playNotificationSound();
                } else {
                    // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    window.playNotificationSound();
                }
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–≤—É–∫–∞:', error);
            }
        },
                resetSeenNotifications: () => {
            try {
                console.log('[ModernWidget] üîÑ –ü–û–õ–ù–´–ô –°–ë–†–û–° –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞...');
                localStorage.removeItem('seenNotificationIds');
                localStorage.removeItem('lastNotificationCheck');
                localStorage.removeItem('lastSoundPlay'); // –ù–û–í–û–ï: –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–≤—É–∫–∞
                sessionStorage.removeItem('audioBlocked');

                // –ù–û–í–û–ï: –°–±—Ä–∞—Å—ã–≤–∞–µ–º internal —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞
                if (notificationsWidget) {
                    notificationsWidget.lastPlayAttempt = 0;
                    console.log('[ModernWidget] üîÑ –°–±—Ä–æ—à–µ–Ω–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞');
                }

                console.log('[ModernWidget] ‚úÖ –ü–û–õ–ù–´–ô –°–ë–†–û–° –∑–∞–≤–µ—Ä—à–µ–Ω - –í–°–ï —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –Ω–æ–≤—ã–º–∏');
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞:', error);
            }
        },
        getDiagnostics: () => {
            try {
                const widget = notificationsWidget;
                const seenIds = JSON.parse(localStorage.getItem('seenNotificationIds')) || [];
                const lastNotificationCheck = parseInt(localStorage.getItem('lastNotificationCheck')) || 0;
                const lastSoundPlay = parseInt(localStorage.getItem('lastSoundPlay')) || 0;
                const now = Date.now();

                const diagnostics = {
                    // –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞
                    soundDisabled: localStorage.getItem('notificationSoundDisabled') === 'true',
                    audioBlocked: sessionStorage.getItem('audioBlocked') === 'true',
                    widgetClosed: localStorage.getItem('notificationsWidgetClosed') === 'true',

                    // –ê—É–¥–∏–æ –æ–±—ä–µ–∫—Ç
                    audioInitialized: widget?.audioInitialized || false,
                    audioObjectExists: !!(widget?.audio),
                    audioReadyState: widget?.audio?.readyState || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ',

                    // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–ù–û–í–û–ï –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
                    lastPlayAttempt: widget?.lastPlayAttempt ? new Date(widget.lastPlayAttempt).toLocaleTimeString() : '–Ω–∏–∫–æ–≥–¥–∞',
                    lastSoundPlay: lastSoundPlay ? new Date(lastSoundPlay).toLocaleTimeString() : '–Ω–∏–∫–æ–≥–¥–∞',
                    lastNotificationCheck: lastNotificationCheck ? new Date(lastNotificationCheck).toLocaleTimeString() : '–Ω–∏–∫–æ–≥–¥–∞',
                    timeSinceLastPlay: widget?.lastPlayAttempt ? now - widget.lastPlayAttempt : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ',
                    timeSinceLastSoundPlay: lastSoundPlay ? now - lastSoundPlay : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ',
                    timeSinceLastCheck: lastNotificationCheck ? now - lastNotificationCheck : '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ',

                    // –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã
                    minPlayInterval: widget?.minPlayInterval || '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',

                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê)
                    seenNotificationsCount: seenIds.length,
                    seenNotificationsRecent: seenIds.slice(-5), // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 seen ID
                    currentNotificationsCount: widget?.notifications?.length || 0,

                    // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    documentVisibility: document.visibilityState,
                    hasFocus: document.hasFocus(),
                    userAgent: navigator.userAgent.substring(0, 100) + '...',
                    timestamp: new Date().toLocaleString()
                };

                console.log('[ModernWidget] üìä –ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–õ–Ø –û–¢–õ–ê–î–ö–ò –ü–†–û–î–ê–ö–®–ï–ù–ê:', diagnostics);
                console.table(diagnostics);
                return diagnostics;
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', error);
                return null;
            }
        }
    };

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
    window.emergencyFixSound = () => {
        try {
            console.log('[ModernWidget] üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–í–£–ö–ê –ù–ê –ü–†–û–î–ê–ö–®–ï–ù–ï...');

            // –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
            localStorage.removeItem('seenNotificationIds');
            localStorage.removeItem('lastNotificationCheck');
            localStorage.removeItem('lastSoundPlay');
            localStorage.removeItem('notificationSoundDisabled');
            sessionStorage.removeItem('audioBlocked');

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
            if (notificationsWidget) {
                notificationsWidget.lastPlayAttempt = 0;

                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
                if (notificationsWidget.initializeAudio) {
                    notificationsWidget.initializeAudio();
                }
            }

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∑–≤—É–∫–∞
            setTimeout(() => {
                if (typeof window.playNotificationSound === 'function') {
                    console.log('[ModernWidget] üîä –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –¢–ï–°–¢ –ó–í–£–ö–ê...');
                    window.playNotificationSound();
                } else if (notificationsWidget && notificationsWidget.playNotificationSound) {
                    console.log('[ModernWidget] üîä –¢–ï–°–¢ –ó–í–£–ö–ê –ß–ï–†–ï–ó –í–ò–î–ñ–ï–¢...');
                    notificationsWidget.playNotificationSound();
                }
            }, 1000);

            console.log('[ModernWidget] ‚úÖ –≠–ö–°–¢–†–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û');
            console.log('[ModernWidget] ‚úÖ –°–ª–µ–¥—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –î–û–õ–ñ–ù–´ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫');

            return {
                status: 'success',
                message: '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ',
                cleared: ['seenNotificationIds', 'lastNotificationCheck', 'lastSoundPlay', 'notificationSoundDisabled', 'audioBlocked']
            };
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', error);
            return {
                status: 'error',
                message: error.message
            };
        }
    };

    window.emergencyShowWidget = () => {
        try {
            console.log('[ModernWidget] üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –í–ò–î–ñ–ï–¢–ê...');
            const widget = document.getElementById('modern-notifications-widget');
            if (widget) {
                // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏ –∏ –∫–ª–∞—Å—Å—ã
                widget.className = 'modern-notifications-widget show';
                widget.style.cssText = `
                    position: fixed !important;
                    top: 120px !important;
                    right: 20px !important;
                    width: 480px !important;
                    min-width: 400px !important;
                    max-width: 600px !important;
                    max-height: 600px !important;
                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
                    backdrop-filter: blur(20px) !important;
                    border: 1px solid rgba(255, 255, 255, 0.1) !important;
                    border-radius: 24px !important;
                    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 12px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
                    z-index: 999999 !important;
                    display: flex !important;
                    flex-direction: column !important;
                    pointer-events: auto !important;
                    font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
                    resize: horizontal !important;
                    overflow: hidden !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    transform: translateX(0) !important;
                    clip-path: none !important;
                `;

                localStorage.setItem('notificationsWidgetClosed', 'false');
                localStorage.removeItem('notificationsWidgetClosedByUser');

                if (window.hideRestoreButton) {
                    window.hideRestoreButton();
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—Å–ª–∏ –≤–∏–¥–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (notificationsWidget) {
                    notificationsWidget.updateNotifications();
                }

                console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
        }
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π
    window.fixWidgetStyles = () => {
        try {
            console.log('[ModernWidget] üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –≤–∏–¥–∂–µ—Ç–∞...');

            const widget = document.getElementById('modern-notifications-widget');
            const bellIcon = document.getElementById('notification-bell-icon');
            const closeBtn = document.getElementById('close-notifications');
            const minimizeBtn = document.getElementById('minimize-notifications');
            const settingsBtn = document.getElementById('notification-settings');
            const widgetDisabled = localStorage.getItem('notificationsWidgetDisabled') === 'true';
            const closedByUser = localStorage.getItem('notificationsWidgetClosedByUser') === 'true';

            if (widgetDisabled || closedByUser) {
                console.log('[ModernWidget] ‚ÑπÔ∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º fixWidgetStyles: –≤–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                return;
            }

            if (widget) {
                // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ inline-—Ü–≤–µ—Ç–∞
                widget.classList.remove('closed', 'hidden', 'initial-hidden');
                widget.classList.add('show');
                widget.style.setProperty('display', 'flex', 'important');
                widget.style.setProperty('visibility', 'visible', 'important');
                widget.style.setProperty('opacity', '1', 'important');
                widget.style.setProperty('position', 'fixed', 'important');
                widget.style.setProperty('top', '102px', 'important');
                widget.style.setProperty('right', '20px', 'important');
                widget.style.setProperty('z-index', '999999', 'important');
                widget.style.setProperty('transform', 'translateX(0)', 'important');
                widget.style.setProperty('clip-path', 'none', 'important');
                widget.style.setProperty('pointer-events', 'auto', 'important');

                widget.style.removeProperty('background');
                widget.style.removeProperty('background-image');
                widget.style.removeProperty('background-color');
                widget.style.removeProperty('backdrop-filter');
                widget.style.removeProperty('border');
                widget.style.removeProperty('border-radius');
                widget.style.removeProperty('box-shadow');
                widget.style.removeProperty('font-family');
            }

            if (bellIcon) {
                bellIcon.removeAttribute('style');
            }

            [closeBtn, minimizeBtn, settingsBtn].forEach(btn => {
                if (btn) {
                    btn.removeAttribute('style');
                    const icon = btn.querySelector('i');
                    if (icon) {
                        icon.removeAttribute('style');
                    }
                }
            });

            const restoreBtn = document.getElementById('notifications-restore-btn');
            if (restoreBtn) {
                const restoreButton = restoreBtn.querySelector('.restore-button');
                if (restoreButton) {
                    restoreButton.removeAttribute('style');
                    const restoreIcon = restoreButton.querySelector('i');
                    if (restoreIcon) {
                        restoreIcon.removeAttribute('style');
                    }
                }
            }

            console.log('[ModernWidget] ‚úÖ –°—Ç–∏–ª–∏ –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã');
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π:', error);
        }
    };

    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: emergencyShowWidget()');
    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: fixWidgetStyles()');
    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: fixRestoreButton()');
    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è —Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: hideRestoreButton()');
    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è –ø–æ–∫–∞–∑–∞ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: showRestoreButton()');
    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è –ø–æ–∫–∞–∑–∞ –≤–∏–¥–∂–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: showNotificationsWidget()');
    console.log('[ModernWidget] üõ†Ô∏è –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ —Å—Ç–∏–ª–µ–π –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: resetRestoreButton()');

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            try {
                fixWidgetStyles();
                fixRestoreButton();
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π:', error);
            }
        }, 2000);

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            try {
                fixRestoreButton();
            } catch (error) {
                console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏:', error);
            }
        }, 5000);

                // –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∏–ª–µ–π —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        // setTimeout(() => {
        //     try {
        //         const restoreBtn = document.getElementById('notifications-restore-btn');
        //         if (restoreBtn) {
        //             const button = restoreBtn.querySelector('.restore-button');
        //             if (button) {
        //                 // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏
        //                 button.style.cssText = `
        //                     width: 56px !important;
        //                     height: 56px !important;
        //                     border-radius: 50% !important;
        //                     background: linear-gradient(135deg, #6366f1, #a855f7) !important;
        //                     cursor: pointer !important;
        //                     box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4) !important;
        //                     transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        //                     display: flex !important;
        //                     align-items: center !important;
        //                     justify-content: center !important;
        //                     position: relative !important;
        //                     overflow: hidden !important;
        //                     text-decoration: none !important;
        //                     border: none !important;
        //                     outline: none !important;
        //                     padding: 0 !important;
        //                     margin: 0 !important;
        //                     background-color: transparent !important;
        //                     background-image: linear-gradient(135deg, #6366f1, #a855f7) !important;
        //                     background-repeat: no-repeat !important;
        //                     background-position: center !important;
        //                     background-size: cover !important;
        //                     font-family: inherit !important;
        //                     font-size: inherit !important;
        //                     font-weight: inherit !important;
        //                     line-height: inherit !important;
        //                     color: inherit !important;
        //                     text-align: inherit !important;
        //                     vertical-align: inherit !important;
        //                     list-style: none !important;
        //                     list-style-type: none !important;
        //                     list-style-image: none !important;
        //                     list-style-position: outside !important;
        //                     background-attachment: scroll !important;
        //                     background-clip: border-box !important;
        //                     background-origin: padding-box !important;
        //                     border-width: 0 !important;
        //                     border-style: none !important;
        //                     border-color: transparent !important;
        //                     padding-top: 0 !important;
        //                     padding-right: 0 !important;
        //                     padding-bottom: 0 !important;
        //                     padding-left: 0 !important;
        //                     margin-top: 0 !important;
        //                     margin-right: 0 !important;
        //                     margin-bottom: 0 !important;
        //                     margin-left: 0 !important;
        //                 `;

        //                 const icon = button.querySelector('i');
        //                 if (icon) {
        //                     icon.style.cssText = `
        //                     color: white !important;
        //                     font-size: 20px !important;
        //                     display: block !important;
        //                     margin: 0 !important;
        //                     padding: 0 !important;
        //                     line-height: 1 !important;
        //                     position: relative !important;
        //                     z-index: 2 !important;
        //                     background: transparent !important;
        //                     border: none !important;
        //                     outline: none !important;
        //                 `;
        //             }
        //         }
        //     }
        //     console.log('[ModernWidget] ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∏–ª–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
        // } catch (error) {
        //     console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∏–ª–µ–π:', error);
        // }
        // }, 10000);
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    window.fixRestoreButton = () => {
        try {
            console.log('[ModernWidget] üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...');

            const restoreBtn = document.getElementById('notifications-restore-btn');
            if (restoreBtn) {
                // –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                restoreBtn.innerHTML = `
                    <button onclick="showNotificationsWidget()" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–∂–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" class="restore-button">
                        <i class="fas fa-bell"></i>
                    </button>
                `;

                console.log('[ModernWidget] ‚úÖ –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞');
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
        }
    };

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    window.hideRestoreButton = () => {
        try {
            console.log('[ModernWidget] üîß –°–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...');
            const restoreBtn = document.getElementById('notifications-restore-btn');
            if (restoreBtn) {
                restoreBtn.style.display = 'none';
                console.log('[ModernWidget] ‚úÖ –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç–∞');
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
        }
    };

    window.showRestoreButton = () => {
        try {
            console.log('[ModernWidget] üîß –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...');
            const restoreBtn = document.getElementById('notifications-restore-btn');
            if (restoreBtn) {
                restoreBtn.style.display = 'block';
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    if (window.fixRestoreButton) {
                        window.fixRestoreButton();
                    }
                }, 100);
                console.log('[ModernWidget] ‚úÖ –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–∞');
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
        }
    };

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤–∏–¥–∂–µ—Ç–∞
    window.showNotificationsWidget = () => {
        try {
            console.log('[ModernWidget] üîî –ü–æ–∫–∞–∑ –≤–∏–¥–∂–µ—Ç–∞ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é...');
            if (notificationsWidget && typeof notificationsWidget.showWidget === 'function') {
                notificationsWidget.showWidget();
                return;
            }

            const widget = document.getElementById('modern-notifications-widget');
            if (widget) {
                widget.classList.remove('closed', 'hidden', 'initial-hidden');
                widget.classList.add('show');
                widget.style.setProperty('display', 'flex', 'important');
                widget.style.setProperty('visibility', 'visible', 'important');
                widget.style.setProperty('opacity', '1', 'important');
                widget.style.setProperty('transform', 'translateX(0)', 'important');
                widget.style.setProperty('clip-path', 'none', 'important');
                widget.style.setProperty('right', '20px', 'important');
                widget.style.removeProperty('background');
                widget.style.removeProperty('background-image');
                widget.style.removeProperty('background-color');
                widget.style.removeProperty('box-shadow');
                widget.style.removeProperty('border');
                widget.style.removeProperty('backdrop-filter');
                localStorage.setItem('notificationsWidgetClosed', 'false');
                localStorage.removeItem('notificationsWidgetClosedByUser');
                if (window.hideRestoreButton) window.hideRestoreButton();
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –≤–∏–¥–∂–µ—Ç–∞:', error);
        }
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
    window.emergencyShowWidget = () => {
        try {
            console.log('[ModernWidget] üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –í–ò–î–ñ–ï–¢–ê...');
            window.showNotificationsWidget();
            if (notificationsWidget && typeof notificationsWidget.updateNotifications === 'function') {
                notificationsWidget.updateNotifications();
            }
            console.log('[ModernWidget] ‚úÖ –í–∏–¥–∂–µ—Ç —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
        }
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    window.resetRestoreButton = () => {
        try {
            console.log('[ModernWidget] üîß –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –∫–Ω–æ–ø–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...');

            const restoreBtn = document.getElementById('notifications-restore-btn');
            if (restoreBtn) {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏
                const styleSheets = document.styleSheets;
                for (let i = 0; i < styleSheets.length; i++) {
                    try {
                        const rules = styleSheets[i].cssRules || styleSheets[i].rules;
                        for (let j = 0; j < rules.length; j++) {
                            const rule = rules[j];
                            if (rule.selectorText && rule.selectorText.includes('restore-button')) {
                                console.log('[ModernWidget] üîç –ù–∞–π–¥–µ–Ω —Å—Ç–∏–ª—å –¥–ª—è restore-button:', rule.selectorText);
                            }
                        }
                    } catch (e) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∏–ª—è–º
                    }
                }

                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
                restoreBtn.innerHTML = `
                    <button onclick="showNotificationsWidget()" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–∂–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" class="restore-button">
                        <i class="fas fa-bell"></i>
                    </button>
                `;

                console.log('[ModernWidget] ‚úÖ –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω');
            }
        } catch (error) {
            console.error('[ModernWidget] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ —Å—Ç–∏–ª–µ–π:', error);
        }
    };

    // –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å—Ç–∏–ª–µ–π –≤–∏–¥–∂–µ—Ç–∞
    window.resetWidgetStyles = function() {
        console.log('[ModernWidget] üß™ –¢–ï–°–¢: –í—ã–∑–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–±—Ä–æ—Å–∞ —Å—Ç–∏–ª–µ–π –≤–∏–¥–∂–µ—Ç–∞');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞
        const widgetElement = document.getElementById('modern-notifications-widget');
        if (!widgetElement) {
            console.error('[ModernWidget] ‚ùå –≠–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM');
            return;
        }

        console.log('[ModernWidget] üîç –ù–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞:', widgetElement);
        console.log('[ModernWidget] üîç –¢–µ–∫—É—â–∏–µ –∫–ª–∞—Å—Å—ã:', widgetElement.className);
        console.log('[ModernWidget] üîç –¢–µ–∫—É—â–∏–µ —Å—Ç–∏–ª–∏:', widgetElement.style.cssText);

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –í–°–ï –∫–ª–∞—Å—Å—ã, –≤–∫–ª—é—á–∞—è initial-hidden
        widgetElement.className = 'modern-notifications-widget';

        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –ø–æ–º–æ—â—å—é !important
        widgetElement.style.cssText = `
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: fixed !important;
            top: 120px !important;
            right: 20px !important;
            width: 480px !important;
            min-width: 400px !important;
            max-width: 600px !important;
            max-height: 600px !important;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 24px !important;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 12px 24px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
            flex-direction: column !important;
            pointer-events: auto !important;
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
            transform: none !important;
            clip-path: none !important;
            z-index: 999999 !important;
        `;

        console.log('[ModernWidget] ‚úÖ –°—Ç–∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–æ—à–µ–Ω—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
        console.log('[ModernWidget] üîç –ù–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã:', widgetElement.className);
        console.log('[ModernWidget] üîç –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏:', widgetElement.style.cssText);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∏–¥–∏–º
        const rect = widgetElement.getBoundingClientRect();
        console.log('[ModernWidget] üìç –ü–æ–∑–∏—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞:', rect);
        console.log('[ModernWidget] üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å:', widgetElement.offsetParent !== null ? '–í–∏–¥–∏–º—ã–π' : '–°–∫—Ä—ã—Ç—ã–π');

        if (notificationsWidget) {
            notificationsWidget.resetWidgetStyles();
        }
    };

    // –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞ –≤ DOM
    window.checkWidgetDOM = function() {
        console.log('[ModernWidget] üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –≤ DOM...');

        const widgetElement = document.getElementById('modern-notifications-widget');
        if (widgetElement) {
            console.log('[ModernWidget] ‚úÖ –≠–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞–π–¥–µ–Ω:', widgetElement);
            console.log('[ModernWidget] üìç –ü–æ–∑–∏—Ü–∏—è:', widgetElement.getBoundingClientRect());
            console.log('[ModernWidget] üé® –°—Ç–∏–ª–∏:', widgetElement.style.cssText);
            console.log('[ModernWidget] üè∑Ô∏è –ö–ª–∞—Å—Å—ã:', widgetElement.className);
            console.log('[ModernWidget] üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å:', widgetElement.offsetParent !== null ? '–í–∏–¥–∏–º—ã–π' : '–°–∫—Ä—ã—Ç—ã–π');
        } else {
            console.error('[ModernWidget] ‚ùå –≠–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ –ù–ï –Ω–∞–π–¥–µ–Ω –≤ DOM');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–æ–º modern-notifications-widget
        const allWidgets = document.querySelectorAll('.modern-notifications-widget');
        console.log('[ModernWidget] üìä –ù–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –∫–ª–∞—Å—Å–æ–º modern-notifications-widget:', allWidgets.length);
        allWidgets.forEach((widget, index) => {
            console.log(`[ModernWidget] üìã –í–∏–¥–∂–µ—Ç ${index + 1}:`, widget);
        });
    };

    // –¢–ï–°–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∫–∞–∑ –≤–∏–¥–∂–µ—Ç–∞
    window.showWidgetSimple = function() {
        console.log('[ModernWidget] üß™ –¢–ï–°–¢: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∫–∞–∑ –≤–∏–¥–∂–µ—Ç–∞');

        const widgetElement = document.getElementById('modern-notifications-widget');
        if (!widgetElement) {
            console.error('[ModernWidget] ‚ùå –≠–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        // –ü—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å initial-hidden
        widgetElement.classList.remove('initial-hidden');
        widgetElement.style.display = 'flex';
        widgetElement.style.visibility = 'visible';
        widgetElement.style.opacity = '1';

        console.log('[ModernWidget] ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω');
        console.log('[ModernWidget] üîç –ù–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã:', widgetElement.className);
    };
} catch (globalError) {
    console.error('[ModernWidget] üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –í–ò–î–ñ–ï–¢–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô:', globalError);

    const widget = document.getElementById('modern-notifications-widget');
    if (widget) {
        widget.classList.remove('initial-hidden');
        widget.style.display = 'none';
    }

    console.log('[ModernWidget] ‚ö†Ô∏è –í–∏–¥–∂–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏. –û—Å—Ç–∞–ª—å–Ω–æ–π —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.');
}

// üöÄ –°–û–í–†–ï–ú–ï–ù–ù–´–ï UX –£–õ–£–ß–®–ï–ù–ò–Ø
class ModernNotificationsUX {
    constructor() {
        this.widget = null;
        this.notificationsList = null;
        this.isRefreshing = false;
        this.swipeThreshold = 100;
        this.pullThreshold = 80;
        this.init();
    }

    init() {
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.initializeUX());
        } else {
            this.initializeUX();
        }
    }

    initializeUX() {
        this.widget = document.getElementById('modern-notifications-widget');
        this.notificationsList = document.getElementById('notifications-list');

        if (this.widget && this.notificationsList) {
            this.setupSwipeGestures();
            this.setupPullToRefresh();
            this.setupHapticFeedback();
            this.setupImprovedAnimations();
            console.log('[ModernUX] üéâ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ UX —É–ª—É—á—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã!');
        } else {
            // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => this.initializeUX(), 1000);
        }
    }

    // üëÜ SWIPE –ñ–ï–°–¢–´ –î–õ–Ø –ó–ê–ö–†–´–¢–ò–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
    setupSwipeGestures() {
        let startX = 0;
        let startY = 0;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let draggedElement = null;

        this.notificationsList.addEventListener('touchstart', (e) => {
            const notificationItem = e.target.closest('.notification-item');
            if (!notificationItem) return;

            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isDragging = true;
            draggedElement = notificationItem;

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            draggedElement.style.transition = 'none';
            draggedElement.style.zIndex = '1000';

            this.hapticFeedback('light');
        }, { passive: true });

        this.notificationsList.addEventListener('touchmove', (e) => {
            if (!isDragging || !draggedElement) return;

            currentX = e.touches[0].clientX;
            currentY = e.touches[0].clientY;

            const deltaX = currentX - startX;
            const deltaY = currentY - startY;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π swipe
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {
                e.preventDefault();

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ñ–∏–∑–∏–∫–æ–π
                const progress = Math.min(Math.abs(deltaX) / this.swipeThreshold, 1);
                const opacity = Math.max(0.3, 1 - progress * 0.7);
                const rotation = deltaX * 0.05; // –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞
                const scale = 1 - progress * 0.05; // –ù–µ–±–æ–ª—å—à–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–∏ swipe

                draggedElement.style.transform = `translateX(${deltaX}px) rotate(${rotation}deg) scale(${scale})`;
                draggedElement.style.opacity = opacity;

                // –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                if (deltaX > 30) {
                    draggedElement.style.backgroundColor = 'rgba(34, 197, 94, 0.15)';
                    draggedElement.style.borderColor = 'rgba(34, 197, 94, 0.3)';
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É "–ø—Ä–æ—á–∏—Ç–∞–Ω–æ"
                    this.showSwipeIcon(draggedElement, 'check', 'right');
                } else if (deltaX < -30) {
                    draggedElement.style.backgroundColor = 'rgba(239, 68, 68, 0.15)';
                    draggedElement.style.borderColor = 'rgba(239, 68, 68, 0.3)';
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É "—É–¥–∞–ª–∏—Ç—å"
                    this.showSwipeIcon(draggedElement, 'trash', 'left');
                } else {
                    draggedElement.style.backgroundColor = '';
                    draggedElement.style.borderColor = '';
                    this.hideSwipeIcon(draggedElement);
                }

                // Haptic feedback –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞
                if (Math.abs(deltaX) > this.swipeThreshold * 0.8 && !draggedElement.dataset.hapticTriggered) {
                    this.hapticFeedback('light');
                    draggedElement.dataset.hapticTriggered = 'true';
                }
            }
        }, { passive: false });

        this.notificationsList.addEventListener('touchend', (e) => {
            if (!isDragging || !draggedElement) return;

            const deltaX = currentX - startX;
            const shouldDismiss = Math.abs(deltaX) > this.swipeThreshold;

            if (shouldDismiss) {
                // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
                draggedElement.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                draggedElement.style.transform = `translateX(${deltaX > 0 ? '100%' : '-100%'}) rotate(${deltaX > 0 ? '10deg' : '-10deg'})`;
                draggedElement.style.opacity = '0';

                this.hapticFeedback('medium');

                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    if (draggedElement && draggedElement.parentNode) {
                        draggedElement.remove();
                        this.showSwipeToast(deltaX > 0 ? '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ' : '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                    }
                }, 300);
            } else {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –º–µ—Å—Ç–æ
                draggedElement.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                draggedElement.style.transform = 'translateX(0) rotate(0)';
                draggedElement.style.opacity = '1';
                draggedElement.style.backgroundColor = '';
            }

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            setTimeout(() => {
                if (draggedElement) {
                    draggedElement.style.transition = '';
                    draggedElement.style.zIndex = '';
                    draggedElement.style.backgroundColor = '';
                    draggedElement.style.borderColor = '';
                    draggedElement.dataset.hapticTriggered = '';
                    this.hideSwipeIcon(draggedElement);
                }
            }, 300);

            isDragging = false;
            draggedElement = null;
        }, { passive: true });
    }

    // üéØ –ü–û–ö–ê–ó –ò–ö–û–ù–û–ö –ü–†–ò SWIPE
    showSwipeIcon(element, iconType, side) {
        let icon = element.querySelector('.swipe-icon');
        if (!icon) {
            icon = document.createElement('div');
            icon.className = 'swipe-icon';
            icon.style.cssText = `
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                z-index: 10;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            `;
            element.appendChild(icon);
        }

        const icons = {
            check: '<i class="fas fa-check" style="color: white;"></i>',
            trash: '<i class="fas fa-trash" style="color: white;"></i>'
        };

        const colors = {
            check: 'background: linear-gradient(135deg, #22c55e, #16a34a);',
            trash: 'background: linear-gradient(135deg, #ef4444, #dc2626);'
        };

        icon.innerHTML = icons[iconType] || icons.check;
        icon.style.cssText += colors[iconType] || colors.check;
        icon.style[side] = '20px';
        icon.style.opacity = '1';
        icon.style.transform = 'translateY(-50%) scale(1)';
    }

    hideSwipeIcon(element) {
        const icon = element.querySelector('.swipe-icon');
        if (icon) {
            icon.style.opacity = '0';
            icon.style.transform = 'translateY(-50%) scale(0.8)';
        }
    }

    // üîÑ PULL-TO-REFRESH –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ü–ò–°–ö–ê
    setupPullToRefresh() {
        let startY = 0;
        let currentY = 0;
        let isPulling = false;
        let pullIndicator = null;

        // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä pull-to-refresh
        this.createPullIndicator();

        this.notificationsList.addEventListener('touchstart', (e) => {
            if (this.notificationsList.scrollTop === 0) {
                startY = e.touches[0].clientY;
                isPulling = true;
            }
        }, { passive: true });

        this.notificationsList.addEventListener('touchmove', (e) => {
            if (!isPulling || this.isRefreshing) return;

            currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;

            if (deltaY > 0 && this.notificationsList.scrollTop === 0) {
                e.preventDefault();

                const pullDistance = Math.min(deltaY, 120);
                const pullIndicator = document.getElementById('pull-refresh-indicator');

                if (pullIndicator) {
                    pullIndicator.style.transform = `translateY(${pullDistance}px)`;
                    pullIndicator.style.opacity = Math.min(pullDistance / this.pullThreshold, 1);

                    if (pullDistance > this.pullThreshold) {
                        pullIndicator.innerHTML = '<i class="fas fa-arrow-up" style="color: #22c55e;"></i>';
                        this.hapticFeedback('light');
                    } else {
                        pullIndicator.innerHTML = '<i class="fas fa-arrow-down" style="color: #6b7280;"></i>';
                    }
                }
            }
        }, { passive: false });

        this.notificationsList.addEventListener('touchend', (e) => {
            if (!isPulling) return;

            const deltaY = currentY - startY;
            const pullIndicator = document.getElementById('pull-refresh-indicator');

            if (deltaY > this.pullThreshold && !this.isRefreshing) {
                this.triggerRefresh();
            } else if (pullIndicator) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                pullIndicator.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                pullIndicator.style.transform = 'translateY(-50px)';
                pullIndicator.style.opacity = '0';
            }

            isPulling = false;
        }, { passive: true });
    }

    createPullIndicator() {
        const indicator = document.createElement('div');
        indicator.id = 'pull-refresh-indicator';
        indicator.style.cssText = `
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%) translateY(-50px);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            opacity: 0;
            z-index: 1000;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        `;
        indicator.innerHTML = '<i class="fas fa-arrow-down" style="color: #6b7280;"></i>';

        this.notificationsList.style.position = 'relative';
        this.notificationsList.appendChild(indicator);
    }

    async triggerRefresh() {
        if (this.isRefreshing) return;

        this.isRefreshing = true;
        const pullIndicator = document.getElementById('pull-refresh-indicator');

        if (pullIndicator) {
            pullIndicator.innerHTML = '<i class="fas fa-spinner fa-spin" style="color: #3b82f6;"></i>';
            pullIndicator.style.transform = 'translateX(-50%) translateY(20px)';
            pullIndicator.style.opacity = '1';
        }

        this.hapticFeedback('medium');

        // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã API –≤—ã–∑–æ–≤)
        await new Promise(resolve => setTimeout(resolve, 1500));

        // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
        if (pullIndicator) {
            pullIndicator.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            pullIndicator.style.transform = 'translateX(-50%) translateY(-50px)';
            pullIndicator.style.opacity = '0';
        }

        this.isRefreshing = false;
        this.hapticFeedback('light');
        this.showRefreshToast('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
    }

    // üì≥ HAPTIC FEEDBACK
    setupHapticFeedback() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Vibration API
        this.supportsVibration = 'vibrate' in navigator;
        console.log(`[ModernUX] üì≥ Haptic feedback: ${this.supportsVibration ? '–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}`);
    }

    hapticFeedback(type = 'light') {
        if (!this.supportsVibration) return;

        const patterns = {
            light: [10],
            medium: [20],
            heavy: [30],
            success: [10, 50, 10],
            error: [50, 100, 50]
        };

        navigator.vibrate(patterns[type] || patterns.light);
    }

    // ‚ú® –£–õ–£–ß–®–ï–ù–ù–´–ï –ê–ù–ò–ú–ê–¶–ò–ò
    setupImprovedAnimations() {
        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π
        const style = document.createElement('style');
        style.textContent = `
            /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
            .notification-item {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            .notification-item:hover {
                transform: translateY(-1px) scale(1.005) !important;
                box-shadow: 0 12px 24px rgba(15, 23, 42, 0.16) !important;
            }

            .notification-item:active {
                transform: translateY(0) scale(0.98) !important;
                transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
            @keyframes slideInFromTop {
                from {
                    transform: translateY(-100px) scale(0.9);
                    opacity: 0;
                }
                50% {
                    transform: translateY(10px) scale(1.05);
                    opacity: 0.8;
                }
                to {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
            }

            .notification-item.new-notification {
                animation: slideInFromTop 0.6s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ */
            .action-btn, .footer-btn {
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            .action-btn:active, .footer-btn:active {
                transform: scale(0.95) !important;
            }

            /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ */
            .modern-notifications-widget {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            /* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
            .ux-toast {
                position: fixed;
                bottom: 100px;
                right: 20px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 20px;
                border-radius: 12px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000000;
                -webkit-backdrop-filter: blur(10px);
                backdrop-filter: blur(10px);
                animation: toastSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            @keyframes toastSlideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes toastSlideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    }

    // üçû TOAST –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
    showSwipeToast(message) {
        this.showToast(message, 'success');
    }

    showRefreshToast(message) {
        this.showToast(message, 'info');
    }

    showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = 'ux-toast';
        toast.textContent = message;

        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        const icons = {
            success: '‚úÖ',
            info: '‚ÑπÔ∏è',
            warning: '‚ö†Ô∏è',
            error: '‚ùå'
        };

        toast.innerHTML = `${icons[type] || icons.info} ${message}`;

        document.body.appendChild(toast);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            toast.style.animation = 'toastSlideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 300);
        }, 3000);
    }

    // üéØ –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–´–• –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –° –ê–ù–ò–ú–ê–¶–ò–ï–ô
    addNotificationWithAnimation(notificationHTML) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = notificationHTML;
        const newNotification = tempDiv.firstElementChild;

        if (newNotification) {
            newNotification.classList.add('new-notification');
            this.notificationsList.insertBefore(newNotification, this.notificationsList.firstChild);
            this.hapticFeedback('light');

            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            setTimeout(() => {
                newNotification.classList.remove('new-notification');
            }, 600);
        }
    }
}

// üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–û–í–†–ï–ú–ï–ù–ù–´–• UX –£–õ–£–ß–®–ï–ù–ò–ô
try {
    window.modernNotificationsUX = new ModernNotificationsUX();
    console.log('[ModernUX] üéâ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ UX —É–ª—É—á—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!');

    // üß™ –¢–ï–°–¢–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò
    window.testSwipeGesture = function() {
        if (window.modernNotificationsUX) {
            window.modernNotificationsUX.showSwipeToast('Swipe –≤–ª–µ–≤–æ –∏–ª–∏ –≤–ø—Ä–∞–≤–æ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
        }
    };

    window.testPullToRefresh = function() {
        if (window.modernNotificationsUX) {
            window.modernNotificationsUX.showRefreshToast('–ü–æ—Ç—è–Ω–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤–Ω–∏–∑ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
        }
    };

    window.testHapticFeedback = function() {
        if (window.modernNotificationsUX) {
            window.modernNotificationsUX.hapticFeedback('success');
            window.modernNotificationsUX.showToast('Haptic feedback –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', 'success');
        }
    };

    window.addTestNotification = function() {
        if (window.modernNotificationsUX) {
            const testHTML = `
                <div class="notification-item redmine-task">
                    <div class="notification-content">
                        <div class="notification-icon redmine-task">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="notification-text">
                            <div class="notification-title">–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>
                            <div class="notification-description">–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</div>
                            <div class="notification-time">–¢–æ–ª—å–∫–æ —á—Ç–æ</div>
                        </div>
                    </div>
                </div>
            `;
            window.modernNotificationsUX.addNotificationWithAnimation(testHTML);
        }
    };

    console.log('[ModernUX] üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:');
    console.log('[ModernUX] üõ†Ô∏è testSwipeGesture() - —Ç–µ—Å—Ç swipe –∂–µ—Å—Ç–æ–≤');
    console.log('[ModernUX] üõ†Ô∏è testPullToRefresh() - —Ç–µ—Å—Ç pull-to-refresh');
    console.log('[ModernUX] üõ†Ô∏è testHapticFeedback() - —Ç–µ—Å—Ç haptic feedback');
    console.log('[ModernUX] üõ†Ô∏è addTestNotification() - –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');

} catch (error) {
    console.error('[ModernUX] ‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ UX —É–ª—É—á—à–µ–Ω–∏–π:', error);
}

</script>
