# Исправление Kanban Drag & Drop: Предотвращение ложных уведомлений

## Проблема
При попытке перетащить задачу в ту же колонку (статус) на Kanban доске появлялись ложные информационные сообщения об изменении статуса, хотя реально статус задачи не менялся.

## Решение

### 1. Проверка в методе handleDrop()
Добавлена проверка в `blog/static/js/pages/tasks/components/KanbanManager.js`:

```javascript
// Проверяем, не перетаскивается ли задача в ту же колонку
const taskCard = document.querySelector(`[data-task-id="${taskId}"]`);
if (taskCard) {
    const currentColumn = taskCard.closest('[data-status-id]');
    const currentStatusId = currentColumn ? currentColumn.getAttribute('data-status-id') : null;

    if (currentStatusId === newStatusId) {
        console.log('[KanbanManager] ⚠️ Попытка перетащить задачу в ту же колонку - отменяем операцию');

        // Убираем визуальные эффекты
        dropZone.classList.remove('drag-over');
        taskCard.classList.remove('dragging');

        // Показываем информационное сообщение
        this.showNotification(`Задача #${taskId} уже находится в этом статусе`, 'info');
        return;
    }
}
```

### 2. Визуальная обратная связь
Обновлены методы `handleDragOver()` и `handleDragEnter()` для показа визуального индикатора "недоступно" при попытке перетащить в ту же колонку:

```javascript
if (currentStatusId === newStatusId) {
    // Если это та же колонка, показываем визуальный индикатор "недоступно"
    dropZone.classList.add('drag-same-column');
    dropZone.classList.remove('drag-over');
} else {
    // Если это другая колонка, показываем обычный индикатор
    dropZone.classList.add('drag-over');
    dropZone.classList.remove('drag-same-column');
}
```

### 3. CSS стили
Добавлены новые CSS стили в `blog/static/css/pages/tasks/tasks.css`:

```css
/* Стиль для попытки перетащить в ту же колонку */
.kanban-column-content.drag-same-column {
  background: rgba(239, 68, 68, 0.1);
  border: 2px dashed #ef4444;
  border-radius: 6px;
  position: relative;
}

.kanban-column-content.drag-same-column::before {
  content: '⚠️ Задача уже в этом статусе';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(239, 68, 68, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
  z-index: 10;
  pointer-events: none;
}
```

## Как это работает

### До исправления:
1. Пользователь перетаскивает задачу в ту же колонку
2. Система отправляет запрос на сервер для "изменения" статуса
3. Сервер возвращает успешный ответ (так как технически запрос корректен)
4. Показывается уведомление "Статус изменен", хотя ничего не изменилось
5. Создается путаница для пользователя

### После исправления:
1. Пользователь начинает перетаскивать задачу
2. При наведении на ту же колонку показывается красный индикатор с текстом "⚠️ Задача уже в этом статусе"
3. При попытке сброса в ту же колонку операция отменяется на клиенте
4. Показывается информационное сообщение "Задача #X уже находится в этом статусе"
5. Запрос на сервер НЕ отправляется

## Преимущества

1. **Предотвращение ложных уведомлений** - больше нет сообщений об изменении статуса, когда статус не меняется
2. **Улучшенная UX** - пользователь сразу видит, что перетаскивание в ту же колонку недоступно
3. **Снижение нагрузки на сервер** - исключены ненужные API запросы
4. **Четкая обратная связь** - визуальные индикаторы помогают понять, что происходит

## Тестирование

### Проверьте следующие сценарии:

1. **Перетаскивание в другую колонку:**
   - Должно работать как обычно
   - Показывается синий индикатор при наведении
   - Статус успешно изменяется
   - Показывается уведомление об успешном изменении

2. **Перетаскивание в ту же колонку:**
   - При наведении показывается красный индикатор с предупреждением
   - При попытке сброса операция отменяется
   - Показывается информационное сообщение
   - Запрос на сервер НЕ отправляется (проверить в DevTools)

3. **Быстрое движение мыши:**
   - Индикаторы должны правильно переключаться
   - Не должно быть "залипших" состояний

## Файлы изменений

- `blog/static/js/pages/tasks/components/KanbanManager.js` - основная логика
- `blog/static/css/pages/tasks/tasks.css` - визуальные стили
- `KANBAN_DRAG_DROP_FIX_README.md` - документация

## Совместимость

Исправление полностью обратно совместимо и не влияет на существующую функциональность. Все существующие drag&drop операции между разными колонками работают как прежде.
