name: SSH Connection Test

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  ssh-test:
    runs-on: ubuntu-latest
    steps:
      - name: Test SSH connection
        env:
          DEPLOY_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          DEPLOY_HOST: ${{ secrets.SSH_HOST }}
          DEPLOY_USER: ${{ secrets.SSH_USER }}
          DEPLOY_PORT: ${{ secrets.SSH_PORT || 22 }}
        run: |
          mkdir -p ~/.ssh
          echo "$DEPLOY_KEY" > ~/.ssh/deploy_key
          chmod 600 ~/.ssh/deploy_key
          ssh-keyscan -p $DEPLOY_PORT -H $DEPLOY_HOST >> ~/.ssh/known_hosts 2>/dev/null || true
          
          echo "üîç Testing SSH connection..."
          ssh -i ~/.ssh/deploy_key -p $DEPLOY_PORT $DEPLOY_USER@$DEPLOY_HOST "echo '‚úÖ SSH connection successful!'; whoami; pwd"
