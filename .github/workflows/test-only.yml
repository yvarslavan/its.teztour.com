name: Test Only (No Deploy)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-dependencies:
    runs-on: ubuntu-latest
    name: Test Dependencies Compatibility

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Create virtual environment
      run: |
        python -m venv venv
        source venv/bin/activate
        echo "VIRTUAL_ENV=$VIRTUAL_ENV" >> $GITHUB_ENV
        echo "$VIRTUAL_ENV/bin" >> $GITHUB_PATH

    - name: Upgrade pip and install build tools
      run: |
        python -m pip install --upgrade pip setuptools wheel

    - name: Test dependency resolution
      run: |
        echo "ğŸ” Testing dependency resolution..."
        python -m pip install --dry-run -r requirements.txt
        echo "âœ… Dependencies are compatible"

    - name: Install dependencies
      run: |
        echo "ğŸ“¦ Installing dependencies..."
        python -m pip install -r requirements.txt
        echo "âœ… Dependencies installed successfully"

    - name: Test Flask import
      run: |
        echo "ğŸ§ª Testing Flask application..."
        python -c "
        import flask
        import werkzeug
        from blog import create_app

        print(f'Flask version: {flask.__version__}')
        print(f'Werkzeug version: {werkzeug.__version__}')

        app = create_app()
        print('âœ… Flask app created successfully')
        "

    - name: Run basic application tests
      run: |
        echo "ğŸ§ª Running basic application tests..."
        python -c "
        from blog import create_app
        import os

        # Test app creation
        app = create_app()

        # Test app configuration
        with app.app_context():
            print('âœ… App context works')

        # Test basic route (if exists)
        with app.test_client() as client:
            # This will work if you have a basic route
            try:
                response = client.get('/')
                print(f'âœ… Basic route test: Status {response.status_code}')
            except Exception as e:
                print(f'âš ï¸ Route test skipped: {e}')

        print('ğŸ‰ All tests passed!')
        "
